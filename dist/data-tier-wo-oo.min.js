(()=>{"use strict";function e(e){if(void 0===e||null===e)return e;if("object"!=typeof e)throw new Error(e+" is not of type Observable and not an object");if("function"==typeof e.observe&&"function"==typeof e.unobserve&&"function"==typeof e.revoke)return e;if(t.Observable){if("function"==typeof e.observe||"function"==typeof e.unobserve||"function"==typeof e.revoke)throw new Error(e+" is not of type Observable and can not be transformed into Observable (some of its functions already implemented?)");return t.Observable.from(e)}throw new Error(e+" is not of type Observable and no embedded Observable implementation found")}(()=>{let e=window,t=Symbol.for("data-tier");for(;e.parent!==e;)e=e.parent;if(e[t])throw new Error("data-tier found to already being running within this application, cancelling current execution");e[t]=!0})();const t=this||window,n={};Reflect.defineProperty(t,"DataTier",{value:{}}),Reflect.defineProperty(t.DataTier,"ties",{value:{get get(){return function(e){return n[e]}},get create(){return function(a,r,o){if(function(e){if(!e||"string"!=typeof e)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(e))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}(a),n[a])throw new Error("existing tie ("+a+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new function(a,r,o){let i;Reflect.defineProperty(this,"name",{value:a}),Reflect.defineProperty(this,"data",{get:function(){return i},set:function(n){let r=i,o=e(n);i&&i.revoke(),(i=o)&&i.observe(function(e){t.DataTier.views.processChanges(a,e)}),t.DataTier.views.processChanges(a,[{type:"update",value:i,oldValue:r,path:[]}])}}),n[a]=this,this.data=r,Object.seal(this)}(a,e(r),o)}},get remove(){return function(e){e&&n[e]&&(n[e].observable.revoke(),delete n[e])}}}})})(),(()=>{"use strict";function e(e,a){Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"toView",{value:a.toView}),Reflect.defineProperty(this,"toData",{value:"function"==typeof a.toData?a.toData:function(e){!function(e,t,n){let a;if(!e)return;for(a=0;a<t.length-1;a++)e=e[t[a]]&&"object"==typeof e[t[a]]?e[t[a]]:e[t[a]]={};e[t[a]]=n}(e.data,e.path,e.view.value)}}),Reflect.defineProperty(this,"changeDOMEventType",{value:"string"==typeof a.changeDOMEventType?a.changeDOMEventType:null}),Reflect.defineProperty(this,"parseParam",{value:"function"==typeof a.parseParam?a.parseParam:t}),Reflect.defineProperty(this,"isChangedPathRelevant",{value:"function"==typeof a.isChangedPathRelevant?a.isChangedPathRelevant:n})}function t(e){let t="",n=[];return e&&(t=(n=e.trim().split(".")).shift()),{tieName:t,dataPath:n}}function n(e,t){return t.startsWith(e)}const a=this||window,r={};if(!a.DataTier)throw new Error("data-tier framework was not properly initialized");Reflect.defineProperty(e.prototype,"parseParam",{value:t}),Reflect.defineProperty(e.prototype,"isChangedPathRelevant",{value:n}),Reflect.defineProperty(a.DataTier,"processors",{value:{get get(){return function(e){return r[e]}},get add(){return function(t,n){if("string"!=typeof t||!t)throw new Error("name MUST be a non-empty string");if(r[t])throw new Error('data processor "'+t+'" already exists; you may want to reconfigure the existing one');if("object"!=typeof n||!n)throw new Error("configuration MUST be a non-null object");if("function"!=typeof n.toView)throw new Error('configuration MUST have a "toView" function defined');r[t]=new e(t,n),a.DataTier.views.applyProcessor(r[t])}},get remove(){return function(e){if("string"!=typeof e||!e)throw new Error("controller name MUST be a non-empty string");return delete r[e]}},get getApplicable(){return function(e){let t=[];return e&&e.dataset&&Object.keys(e.dataset).filter(e=>e in r).map(e=>r[e]).forEach(e=>t.push(e)),t}}}})})(),(()=>{"use strict";function e(e){l.getApplicable(e.target).forEach(t=>{if(e.type===t.changeDOMEventType){let n=t.parseParam(e.target.dataset[t.name]),a=s.get(n.tieName);if(!n.dataPath)return void console.error("path to data not available");if(!a)return void console.error('tie "'+n.tieName+'" not found');t.toData({data:a.data,path:n.dataPath,view:e.target})}})}function t(t){if("IFRAME"===t.nodeName)o(t.contentDocument),t.addEventListener("load",function(){o(this.contentDocument),a(this.contentDocument)}),a(t.contentDocument);else if(t.dataset){let a,r=Object.keys(t.dataset);for(a=0;a<r.length;a++){if(!r[a].startsWith("tie"))continue;let o=l.get(r[a]);if(o){let a,r,i,s=o.parseParam(t.dataset[o.name]),l=s.dataPath.join(".");c[s.tieName]||(c[s.tieName]={}),(a=c[s.tieName])[o.name]||(a[o.name]={}),(r=a[o.name])[l]||(r[l]=[]),(i=r[l]).indexOf(t)<0&&(i.push(t),n(t,o.name),o.changeDOMEventType&&function(t,n){t.addEventListener(n,e)}(t,o.changeDOMEventType))}else f[r[a]]||(f[r[a]]=[]),f[r[a]].push(t)}}}function n(e,t){let n,a,r,o;a=(n=l.get(t)).parseParam(e.dataset[t]),(r=s.get(a.tieName))&&(o=function(e,t){if(e){for(let n=0;n<t.length;n++){if(!(t[n]in e))return;e=e[t[n]]}return e}}(r.data,a.dataPath),n.toView(o,e))}function a(e){if(e&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.ELEMENT_NODE)){let n;(n="IFRAME"===e.nodeName?Array.from(e.contentDocument.getElementsByTagName("*")):Array.from(e.getElementsByTagName("*"))).push(e),n.forEach(t)}}function r(t){let n,a,r,o;t&&t.getElementsByTagName&&((n=Array.from(t.getElementsByTagName("*"))).push(t),n.forEach(t=>{l.getApplicable(t).forEach(n=>{a=n.parseParam(t.dataset[n.name]),r=c[a.tieName][n.name][a.dataPath.join(".")],(o=r.indexOf(t))>=0&&(r.splice(o,1),n.changeDOMEventType&&function(t,n){t.removeEventListener(n,e)}(t,n.changeDOMEventType))})}))}function o(e){new MutationObserver(function(e){let t,i,s,f,u,d,p,h,m,g;for(t=0;t<e.length;t++)if(d=e[t],"attributes"===(p=d.type)){let e=d.target,t=d.attributeName;0===t.indexOf("data-tie")?function(e,t,a,r){let o,i,s=-1;o=l.get(t).parseParam(a),c[o.tieName]&&c[o.tieName][t]&&((i=c[o.tieName][t][o.dataPath])&&(s=i.indexOf(e)),s>=0&&i.splice(s,1)),o=l.get(t).parseParam(r),c[o.tieName]||(c[o.tieName]={}),c[o.tieName][t]||(c[o.tieName][t]={}),c[o.tieName][t][o.dataPath]||(c[o.tieName][t][o.dataPath]=[]),c[o.tieName][t][o.dataPath].push(e),n(e,t)}(e,function(e){let n,a=2,r=t.split("-");for(n=r[1];a<r.length;)n+=r[a][0].toUpperCase()+r[a++].substr(1);return n}(),d.oldValue,e.getAttribute(t)):"src"===t&&"IFRAME"===e.nodeName&&r(e.contentDocument)}else if("childList"===p){for(i=0,f=(h=d.addedNodes).length;i<f;i++)"IFRAME"===(g=h[i]).nodeName?(g.contentDocument&&(o(g.contentDocument),a(g.contentDocument)),g.addEventListener("load",function(){o(this.contentDocument),a(this.contentDocument)})):a(g);for(s=0,u=(m=d.removedNodes).length;s<u;s++)r("IFRAME"===(g=m[s]).nodeName?g.contentDocument:g)}}).observe(e,{childList:!0,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!0,characterDataOldValue:!1})}const i=this||window;if(!i.DataTier)throw new Error("data-tier framework was not properly initialized");const s=i.DataTier.ties,l=i.DataTier.processors,c={},f={};Reflect.defineProperty(i.DataTier,"views",{value:{get processChanges(){return function(e,t){let a,r,o,i=c[e];i&&t.forEach(e=>{o=e.path.join("."),Object.keys(i).forEach(e=>{(r=i[e])&&(a=l.get(e),Object.keys(r).forEach(t=>{a.isChangedPathRelevant(o,t)&&r[t].forEach(t=>{n(t,e)})}))})})}},get applyProcessor(){return function(e){f[e.name]&&(f[e.name].forEach(t),delete f[e.name])}}}}),o(document),a(document)})(),(()=>{"use strict";const e=this||window,t=e.DataTier.processors.add;if(!e.DataTier)throw new Error("data-tier framework was not properly initialized");t("tieValue",{toView:function(e,t){"checkbox"===t.type?t.checked=e:t.value=void 0!==e&&null!==e?e:""},changeDOMEventType:"change"}),t("tieText",{toView:function(e,t){t.textContent=void 0!==e&&null!==e?e:""}}),t("tiePlaceholder",{toView:function(e,t){t.placeholder=void 0!==e&&null!==e?e:""}}),t("tieTooltip",{toView:function(e,t){t.title=void 0!==e&&null!==e?e:""}}),t("tieSrc",{toView:function(e,t){t.src=void 0!==e&&null!==e?e:""}}),t("tieHRef",{toView:function(e,t){t.href=void 0!==e&&null!==e?e:""}}),t("tieDateValue",{toView:function(e,t){t.value=void 0!==e&&null!==e?e.toLocaleString():""}}),t("tieDateText",{toView:function(e,t){t.textContent=void 0!==e&&null!==e?e.toLocaleString():""}}),t("tieClasses",{isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},toView:function(e,t){e&&"object"==typeof e&&Object.keys(e).forEach(function(n){e[n]?t.classList.add(n):t.classList.remove(n)})}}),t("tieList",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},toView:function(e,t){if(!Array.isArray(e)||!t)return;let n,a,r,o,i,s,l,c=t.parentNode,f=e.length;if("TEMPLATE"!==t.nodeName)throw new Error("tieList may be defined on template elements only");t.dataset.listSourceAid||(t.dataset.listSourceAid=(new Date).getTime());let u=c.querySelectorAll('[data-list-item-aid="'+t.dataset.listSourceAid+'"]');for(l=u.length;l>f;)c.removeChild(u[--l]);if(l<f)if((a=t.dataset.tieList.trim().split(/\s+/))&&3===a.length&&"=>"===a[1]){r=a[2],i=(o=t.ownerDocument).createDocumentFragment();let e,u,d,p,h,m,g,y,v,w,E,b=[],P=a[0]+".";for(;l++<f;){if(n=o.importNode(t.content,!0),e=n.querySelectorAll("*"),u||(u=e.length),!b.length)for(d=0;d<u;d++){for(p=Object.keys(e[d].dataset),h=[],m=0;m<p.length;m++)h.push([p[m],e[d].dataset[p[m]]]);b.push(h)}for(g=0;y=b[g];g++)for(w=0,v=y.length;w<v;w++)(E=y[w])[1].startsWith(r)&&(e[g].dataset[E[0]]=E[1].replace(r,P+l));for(i.appendChild(n),s=i.lastChild;s.nodeType!==Node.ELEMENT_NODE&&null!==s.previousSibling;)s=s.previousSibling;s.dataset.listItemAid=t.dataset.listSourceAid}c.appendChild(i)}else console.error('invalid parameter for "tieList" rule specified')}})})();