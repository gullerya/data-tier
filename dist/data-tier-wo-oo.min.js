(()=>{"use strict";function e(e){return r[e]}function t(e,t,n){if(function(e){if(!e||"string"!=typeof e)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(e))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}(e),r[e])throw new Error("existing tie ("+e+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new function(e,t,n){function i(t){o.DataTier.views.processChanges(e,t)}let s;Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"data",{get:function(){return s},set:function(t){let n=s,r=a(t);s&&s.revoke(),(s=r)&&s.observe(i),o.DataTier.views.processChanges(e,[{type:"update",value:s,oldValue:n,path:[]}])}}),r[e]=this,this.data=t,Object.seal(this)}(e,a(t),n)}function n(e){e&&r[e]&&(r[e].observable.revoke(),delete r[e])}function a(e){if(void 0===e||null===e)return e;if("object"!=typeof e)throw new Error(e+" is not of type Observable and not an object");if("function"==typeof e.observe&&"function"==typeof e.unobserve&&"function"==typeof e.revoke)return e;if(o.Observable){if("function"==typeof e.observe||"function"==typeof e.unobserve||"function"==typeof e.revoke)throw new Error(e+" is not of type Observable and can not be transformed into Observable (some of its functions already implemented?)");return o.Observable.from(e)}throw new Error(e+" is not of type Observable and no embedded Observable implementation found")}(()=>{let e=window,t=Symbol.for("data-tier");for(;e.parent!==e;)e=e.parent;if(e[t])throw new Error("data-tier found to already being running within this application, cancelling current execution");e[t]=!0})();const o=this||window,r={};Reflect.defineProperty(o,"DataTier",{value:{}}),Reflect.defineProperty(o.DataTier,"ties",{value:{get get(){return e},get create(){return t},get remove(){return n}}})})(),(()=>{"use strict";function e(e,a){Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"toView",{value:a.toView}),Reflect.defineProperty(this,"toData",{value:"function"==typeof a.toData?a.toData:function(e){!function(e,t,n){let a;if(!e)return;for(a=0;a<t.length-1;a++)e=e[t[a]]&&"object"==typeof e[t[a]]?e[t[a]]:e[t[a]]={};e[t[a]]=n}(e.data,e.path,e.view.value)}}),Reflect.defineProperty(this,"changeDOMEventType",{value:"string"==typeof a.changeDOMEventType?a.changeDOMEventType:null}),Reflect.defineProperty(this,"parseParam",{value:"function"==typeof a.parseParam?a.parseParam:t}),Reflect.defineProperty(this,"isChangedPathRelevant",{value:"function"==typeof a.isChangedPathRelevant?a.isChangedPathRelevant:n})}function t(e){let t="",n=[];return e&&(t=(n=e.trim().split(".")).shift()),{tieName:t,dataPath:n}}function n(e,t){return t.startsWith(e)}function a(t,n){if("string"!=typeof t||!t)throw new Error("name MUST be a non-empty string");if(l[t])throw new Error('data processor "'+t+'" already exists; you may want to reconfigure the existing one');if("object"!=typeof n||!n)throw new Error("configuration MUST be a non-null object");if("function"!=typeof n.toView)throw new Error('configuration MUST have a "toView" function defined');l[t]=new e(t,n),s.DataTier.views.applyProcessor(l[t])}function o(e){return l[e]}function r(e){if("string"!=typeof e||!e)throw new Error("controller name MUST be a non-empty string");return delete l[e]}function i(e){let t=[];return e&&e.dataset&&Object.keys(e.dataset).filter(e=>e in l).map(e=>l[e]).forEach(e=>t.push(e)),t}const s=this||window,l={};if(!s.DataTier)throw new Error("data-tier framework was not properly initialized");Reflect.defineProperty(e.prototype,"parseParam",{value:t}),Reflect.defineProperty(e.prototype,"isChangedPathRelevant",{value:n}),Reflect.defineProperty(s.DataTier,"processors",{value:{get get(){return o},get add(){return a},get remove(){return r},get getApplicable(){return i}}})})(),(()=>{"use strict";function e(e){let t,n,a,o=e.target,r=h.getApplicable(o);for(let i=0,s=r.length;i<s;i++)if(t=r[i],e.type===t.changeDOMEventType){if(n=t.parseParam(o.dataset[t.name]),a=p.get(n.tieName),!n.dataPath)return void console.error("path to data not available");if(!a)return void console.error('tie "'+n.tieName+'" not found');t.toData({data:a.data,path:n.dataPath,view:o})}}function t(t,n){t.addEventListener(n,e)}function n(t,n){t.removeEventListener(n,e)}function a(e){if("IFRAME"===e.nodeName)d(e.contentDocument),e.addEventListener("load",function(){d(this.contentDocument),r(this.contentDocument)}),r(e.contentDocument);else if(e.dataset){let n,a,r,i,s,l,c,f=Object.keys(e.dataset);let d=0;for(f.length;n=f[d];d++)n.startsWith("tie")&&((a=h.get(n))?(i=(r=a.parseParam(e.dataset[a.name])).dataPath.join("."),(c=(l=(s=m[r.tieName]||(m[r.tieName]={}))[a.name]||(s[a.name]={}))[i]||(l[i]=[])).indexOf(e)<0&&(c.push(e),o(e,a.name),a.changeDOMEventType&&t(e,a.changeDOMEventType))):(g[n]||(g[n]=[]),g[n].push(e)))}}function o(e,t){let n,a,o,r;a=(n=h.get(t)).parseParam(e.dataset[t]),(o=p.get(a.tieName))&&(r=function(e,t){if(e){for(let n=0,a=t.length;n<a;n++){if(!(t[n]in e))return;e=e[t[n]]}return e}}(o.data,a.dataPath),n.toView(r,e))}function r(e){if(e&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.ELEMENT_NODE)){let t;t="IFRAME"===e.nodeName?e.contentDocument.getElementsByTagName("*"):e.getElementsByTagName("*"),a(e);for(let e=0,n=t.length;e<n;e++)a(t[e])}}function i(e){if(e&&e.getElementsByTagName){let t,a,o,r,i,s,l=e.getElementsByTagName("*");for(let c=0,f=l.length;c<=f;c++)if((t=c<f?l[c]:e).dataset&&t.dataset.length)for(let e=0,l=(a=h.getApplicable(t)).length;e<l;e++)r=(o=a[e]).parseParam(t.dataset[o.name]),(s=(i=m[r.tieName][o.name][r.dataPath.join(".")]).indexOf(t))>=0&&(i.splice(s,1),o.changeDOMEventType&&n(t,o.changeDOMEventType))}}function s(e,t,n,a){let r,i,s=-1;r=h.get(t).parseParam(n),m[r.tieName]&&m[r.tieName][t]&&((i=m[r.tieName][t][r.dataPath])&&(s=i.indexOf(e)),s>=0&&i.splice(s,1)),r=h.get(t).parseParam(a),m[r.tieName]||(m[r.tieName]={}),m[r.tieName][t]||(m[r.tieName][t]={}),m[r.tieName][t][r.dataPath]||(m[r.tieName][t][r.dataPath]=[]),m[r.tieName][t][r.dataPath].push(e),o(e,t)}function l(e,t){let n,a,r,i,s,l,c,f,d,u,p,g,y,v,w,E,N,T=m[e];if(T)for(u=0,p=t.length;u<p;u++)for(a=(n=t[u]).path.join("."),g=0,y=(r=Object.keys(T)).length;g<y;g++)if(i=r[g],f=T[i])for(s=h.get(i),v=0,w=(l=Object.keys(f)).length;v<w;v++)if(c=l[v],s.isChangedPathRelevant(a,c))for(E=0,N=(d=f[c]).length;E<N;E++)o(d[E],i)}function c(e){g[e.name]&&(g[e.name].forEach(a),delete g[e.name])}function f(e){let t,n=2,a=e.split("-");for(t=a[1];n<a.length;)t+=a[n][0].toUpperCase()+a[n++].substr(1);return t}function d(e){new MutationObserver(function(e){let t,n,a,o,l,c,u,p,h,m;for(t=0;t<e.length;t++)if(c=e[t],"attributes"===(u=c.type)){let e=c.target,t=c.attributeName;if(e.nodeType!==Node.DOCUMENT_NODE&&e.nodeType!==Node.ELEMENT_NODE)continue;0===t.indexOf("data-tie")?s(e,f(t),c.oldValue,e.getAttribute(t)):"src"===t&&"IFRAME"===e.nodeName&&i(e.contentDocument)}else if("childList"===u){for(n=0,o=(p=c.addedNodes).length;n<o;n++)(m=p[n]).nodeType!==Node.DOCUMENT_NODE&&m.nodeType!==Node.ELEMENT_NODE||(y.has(m)?y.delete(m):"IFRAME"===m.nodeName?(m.contentDocument&&(d(m.contentDocument),r(m.contentDocument)),m.addEventListener("load",function(){d(this.contentDocument),r(this.contentDocument)})):r(m));for(a=0,l=(h=c.removedNodes).length;a<l;a++)(m=h[a]).nodeType!==Node.DOCUMENT_NODE&&m.nodeType!==Node.ELEMENT_NODE||(y.has(m)?y.delete(m):i("IFRAME"===m.nodeName?m.contentDocument:m))}}).observe(e,{childList:!0,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!0,characterDataOldValue:!1})}const u=this||window;if(!u.DataTier)throw new Error("data-tier framework was not properly initialized");const p=u.DataTier.ties,h=u.DataTier.processors,m={},g={};let y=new Map;Reflect.defineProperty(u.DataTier,"views",{value:{get processChanges(){return l},get applyProcessor(){return c},get updateView(){return o},get viewsToSkip(){return y}}}),d(document),r(document)})(),(()=>{"use strict";const e=this||window,t=e.DataTier.processors.add;if(!e.DataTier)throw new Error("data-tier framework was not properly initialized");t("tieValue",{toView:function(e,t){"checkbox"===t.type?t.checked=e:t.value=void 0!==e&&null!==e?e:""},changeDOMEventType:"change"}),t("tieText",{toView:function(e,t){t.textContent=void 0!==e&&null!==e?e:""}}),t("tiePlaceholder",{toView:function(e,t){t.placeholder=void 0!==e&&null!==e?e:""}}),t("tieTooltip",{toView:function(e,t){t.title=void 0!==e&&null!==e?e:""}}),t("tieSrc",{toView:function(e,t){t.src=void 0!==e&&null!==e?e:""}}),t("tieHRef",{toView:function(e,t){t.href=void 0!==e&&null!==e?e:""}}),t("tieDateValue",{toView:function(e,t){t.value=void 0!==e&&null!==e?e.toLocaleString():""}}),t("tieDateText",{toView:function(e,t){t.textContent=void 0!==e&&null!==e?e.toLocaleString():""}}),t("tieClasses",{isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},toView:function(e,t){e&&"object"==typeof e&&Object.keys(e).forEach(function(n){e[n]?t.classList.add(n):t.classList.remove(n)})}})})(),(()=>{"use strict";const e=this||window,t=e.DataTier.processors.add;if(!e.DataTier)throw new Error("data-tier framework was not properly initialized");t("tieList",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},toView:function(t,n){if(!Array.isArray(t)||!n)return;let a,o,r,i,s,l,c,f=n.parentNode,d=t.length;if("TEMPLATE"!==n.nodeName)throw new Error("tieList may be defined on template elements only");n.dataset.tieListSourceAid||(n.dataset.tieListSourceAid=(new Date).getTime());let u=f.querySelectorAll('[data-tie-list-item-aid="'+n.dataset.tieListSourceAid+'"]');for(c=u.length;c>d;)f.removeChild(u[--c]);if(c<d)if((o=n.dataset.tieList.trim().split(/\s+/))&&3===o.length&&"=>"===o[1]){r=o[2],s=(i=n.ownerDocument).createDocumentFragment();let e,t,u,p,h,m,g,y,v,w,E,N=[],T=o[0]+".";for(;c<d;c++){if(a=i.importNode(n.content,!0),e=a.querySelectorAll("*"),t||(t=e.length),!N.length)for(u=0;u<t;u++){for(p=Object.keys(e[u].dataset),h=[],m=0;m<p.length;m++)h.push([p[m],e[u].dataset[p[m]]]);N[u]=h}for(g=0;y=N[g];g++)for(w=0,v=y.length;w<v;w++)(E=y[w])[1].startsWith(r)&&(e[g].dataset[E[0]]=E[1].replace(r,T+c));for(s.appendChild(a),l=s.lastChild;l.nodeType!==Node.ELEMENT_NODE&&null!==l.previousSibling;)l=l.previousSibling;l.dataset.tieListItemAid=n.dataset.tieListSourceAid}f.appendChild(s)}else console.error('invalid parameter for "tieList" rule specified');let p,h=n.content.querySelectorAll("*"),m=[];for(let e=0,t=h.length;e<t;e++)m[e]=Object.keys(h[e].dataset);let g,y,v,w,E;for(let t,a=0,o=f.childNodes.length;a<o;a++)if((t=f.childNodes[a])!==n&&(t.nodeType===Node.DOCUMENT_NODE||t.nodeType===Node.ELEMENT_NODE)&&t.dataset.tieListItemAid)for((E=Array.from(t.querySelectorAll("*"))).unshift(t),g=0,y=m.length;g<y;g++)if((p=m[g]).length)for(e.DataTier.views.viewsToSkip.set(E[g],null),v=0,w=p.length;v<w;v++)e.DataTier.views.updateView(E[g],p[v])}})})();