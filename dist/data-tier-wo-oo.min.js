!function(e){"use strict";function t(t,n,a){function o(n){e.DataTier.views.processChanges(t,n)}let i;Reflect.defineProperty(this,"name",{value:t}),Reflect.defineProperty(this,"data",{get:function(){return i},set:function(n){n&&(r(n),i&&i.revoke());let a=i;(i=n)&&i.observe(o),e.DataTier.views.processChanges(t,[{type:"update",value:i,oldValue:a,path:[]}])}}),c[t]=this,this.data=n}function n(e,n,a){if(o(e),n&&r(n),c[e])throw new Error("existing tie ("+e+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new t(e,n,a)}function a(e){e&&c[e]&&(c[e].observable.revoke(),delete c[e])}function o(e){if(!e||"string"!=typeof e)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(e))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}function r(e){if(!e||"object"!=typeof e||"function"!=typeof e.observe||"function"!=typeof e.unobserve||"function"!=typeof e.revoke)throw new Error(e+" is not a valid Observable")}function i(e,t,n){let a;if(e){for(a=0;a<t.length-1;a++)e=e[t[a]]||{};e[t[a]]=n}}const c={};t.prototype.viewToDataProcessor=function(e){i(e.data,e.path,e.view.value)},Reflect.defineProperty(e,"DataTier",{value:{}}),Reflect.defineProperty(e.DataTier,"ties",{value:{}}),Reflect.defineProperty(e.DataTier.ties,"get",{value:function(e){return c[e]}}),Reflect.defineProperty(e.DataTier.ties,"create",{value:n}),Reflect.defineProperty(e.DataTier.ties,"remove",{value:a})}(this),function(e){"use strict";function t(e,t){Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"dataToView",{value:t.dataToView}),"function"==typeof t.inputToData&&Reflect.defineProperty(this,"inputToData",{value:t.inputToData}),"function"==typeof t.parseParam&&Reflect.defineProperty(this,"parseParam",{value:t.parseParam}),"function"==typeof t.isChangedPathRelevant&&Reflect.defineProperty(this,"isChangedPathRelevant",{value:t.isChangedPathRelevant})}function n(n,a){if("string"!=typeof n||!n)throw new Error("name MUST be a non-empty string");if(i[n])throw new Error('controller "'+n+'" already exists; you may want to reconfigure the existing controller');if("object"!=typeof a||!a)throw new Error("configuration MUST be a non-null object");if("function"!=typeof a.dataToView)throw new Error('configuration MUST have a "dataToView" function defined');i[n]=new t(n,a),e.DataTier.views.applyController(i[n])}function a(e){return i[e]}function o(e){if("string"!=typeof e||!e)throw new Error("controller name MUST be a non-empty string");return delete i[e]}function r(e){let t=[];return e&&e.nodeType===Node.ELEMENT_NODE&&e.dataset&&Object.keys(e.dataset).forEach(function(e){i[e]&&t.push(i[e])}),t}const i={};t.prototype.parseParam=function(e){let t="",n=[];return e&&(t=(n=e.trim().split(".")).shift()),{tieName:t,dataPath:n}},t.prototype.isChangedPathRelevant=function(e,t){return 0===t.indexOf(e)},Reflect.defineProperty(e.DataTier,"controllers",{value:{get get(){return a},get add(){return n},get remove(){return o},get getApplicable(){return r}}})}(this),function(e){"use strict";function t(e,t){let n;if(e){for(n=0;n<t.length;n++)if(!(e=e[t[n]]))return;return e}}function n(t){e.DataTier.controllers.getApplicable(t.target).forEach(function(n){if("tieValue"===n.name){let a=n.parseParam(t.target.dataset[n.name]),o=e.DataTier.ties.get(a.tieName);if(!a.dataPath)return void console.error("path to data not available");if(!o)return void console.error('tie "'+a.tieName+'" not found');o.viewToDataProcessor({data:o.data,path:a.dataPath,view:t.target})}})}function a(e){"INPUT"!==e.nodeName&&"SELECT"!==e.nodeName||e.addEventListener("change",n)}function o(e){e.removeEventListener("change",n)}function r(t){"IFRAME"===t.nodeName?(h(t.contentDocument),t.addEventListener("load",function(){h(this.contentDocument),c(this.contentDocument)}),c(t.contentDocument)):(e.DataTier.controllers.getApplicable(t).forEach(function(e){let n,o,r,c=e.parseParam(t.dataset[e.name]),s=c.dataPath.join(".");p[c.tieName]||(p[c.tieName]={}),(n=p[c.tieName])[e.name]||(n[e.name]={}),(o=n[e.name])[s]||(o[s]=[]),(r=o[s]).indexOf(t)<0&&(r.push(t),i(t,e.name),a(t))}),t.dataset&&Object.keys(t.dataset).forEach(function(n){0!==n.indexOf("tie")||e.DataTier.controllers.get(n)||(m[n]||(m[n]=[]),m[n].push(t))}))}function i(n,a){let o,r,i,c;r=(o=e.DataTier.controllers.get(a)).parseParam(n.dataset[a]),(i=e.DataTier.ties.get(r.tieName))&&(c=t(i.data,r.dataPath),o.dataToView(c,n))}function c(e){let t;e&&e.nodeType&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.ELEMENT_NODE)&&((t=t="IFRAME"===e.nodeName?Array.from(e.contentDocument.getElementsByTagName("*")):Array.from(e.getElementsByTagName("*"))).push(e),t.forEach(r))}function s(t){let n,a,r,i;t&&t.getElementsByTagName&&((n=Array.from(t.getElementsByTagName("*"))).push(t),n.forEach(function(t){e.DataTier.controllers.getApplicable(t).forEach(function(e){a=e.parseParam(t.dataset[e.name]),r=p[a.tieName][e.name][a.dataPath.join(".")],(i=r.indexOf(t))>=0&&(r.splice(i,1),o(t))})}))}function u(t,n,a,o){let r,c,s=-1;r=e.DataTier.controllers.get(n).parseParam(a),p[r.tieName]&&p[r.tieName][n]&&((c=p[r.tieName][n][r.dataPath])&&(s=c.indexOf(t)),s>=0&&c.splice(s,1)),r=e.DataTier.controllers.get(n).parseParam(o),p[r.tieName]||(p[r.tieName]={}),p[r.tieName][n]||(p[r.tieName][n]={}),p[r.tieName][n][r.dataPath]||(p[r.tieName][n][r.dataPath]=[]),p[r.tieName][n][r.dataPath].push(t),i(t,n)}function f(t,n){let a,o,r,c=p[t];c&&n.forEach(function(t){r=t.path.join("."),Object.keys(c).forEach(function(t){(o=c[t])&&(a=e.DataTier.controllers.get(t),Object.keys(o).forEach(function(e){a.isChangedPathRelevant(r,e)&&o[e].forEach(function(e){i(e,t)})}))})})}function l(e){m[e.name]&&(m[e.name].forEach(function(e){r(e)}),delete m[e.name])}function d(e){let t,n=2,a=e.split("-");for(t=a[1];n<a.length;)t+=a[n][0].toUpperCase()+a[n++].substr(1);return t}function h(e){function t(e){e.forEach(function(e){let t=e.target,n=e.attributeName;"attributes"===e.type&&0===n.indexOf("data-tie")?u(t,d(n),e.oldValue,t.getAttribute(n)):"attributes"===e.type&&"src"===n&&"IFRAME"===t.nodeName?s(t.contentDocument):"childList"===e.type&&(Array.from(e.addedNodes).forEach(function(e){"IFRAME"===e.nodeName?(e.contentDocument&&(h(e.contentDocument),c(e.contentDocument)),e.addEventListener("load",function(){h(this.contentDocument),c(this.contentDocument)})):c(e)}),Array.from(e.removedNodes).forEach(function(e){s("IFRAME"===e.nodeName?e.contentDocument:e)}))})}new MutationObserver(t).observe(e,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!1,characterDataOldValue:!1})}const p={},m={};Reflect.defineProperty(e.DataTier,"views",{value:{get processChanges(){return f},get applyController(){return l}}}),h(document),c(document)}(this),function(e){"use strict";const t=e.DataTier.controllers.add;t("tieValue",{dataToView:function(e,t){"checkbox"===t.type?t.checked=e:t.value=e||""}}),t("tieText",{dataToView:function(e,t){t.textContent=e?e.toString():""}}),t("tiePlaceholder",{dataToView:function(e,t){t.placeholder=e||""}}),t("tieTooltip",{dataToView:function(e,t){t.title=e||""}}),t("tieSrc",{dataToView:function(e,t){t.src=e||""}}),t("tieHRef",{dataToView:function(e,t){t.href=e||""}}),t("tieDateValue",{dataToView:function(e,t){t.value=e?e.toLocaleString():""}}),t("tieDateText",{dataToView:function(e,t){t.textContent=e?e.toLocaleString():""}}),t("tieClasses",{isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},dataToView:function(e,t){e&&"object"==typeof e&&Object.keys(e).forEach(function(n){e[n]?t.classList.add(n):t.classList.remove(n)})}}),t("tieList",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},dataToView:function(e,t){let n,a,o,r,i,c,s,u,f=t.parentNode;if("TEMPLATE"!==t.nodeName)throw new Error("tieList may be defined on template elements only");if(t.dataset.listSourceAid||(t.dataset.listSourceAid=(new Date).getTime()),n=function(e,t){let n=Array.from(f.querySelectorAll('[data-list-item-aid="'+t+'"]'));for(;n.length>e;)f.removeChild(n.pop());return n.length}(e?e.length:0,t.dataset.listSourceAid),e&&n<e.length)if((o=t.dataset.tieList.trim().split(/\s+/))&&3===o.length&&"=>"===o[1]){for(r=o[2],s=(c=t.ownerDocument).createDocumentFragment();n<e.length;n++){for(a=c.importNode(t.content,!0),(i=Array.prototype.slice.call(a.querySelectorAll("*"),0)).forEach(function(e){Object.keys(e.dataset).forEach(function(t){0===e.dataset[t].indexOf(r)&&(e.dataset[t]=e.dataset[t].replace(r,o[0]+"."+n))})}),s.appendChild(a),u=s.lastChild;u.nodeType!==Node.ELEMENT_NODE&&null!==u.previousSibling;)u=u.previousSibling;u.dataset.listItemAid=t.dataset.listSourceAid}f.appendChild(s)}else console.error('invalid parameter for "tieList" rule specified')}})}(this);