(()=>{"use strict";console.warn("The usage of DataTier as a script is deprecated in favor of ES6-style module, see the relevant info on library's NPM/GitHib pages. Development of this flavor distribution is stopped and only critical defects will be fixed in a short term. At the first quarter of 2019 new version of DataTier will be released having only ES6 module distribution."),(()=>{let e=window,t=Symbol.for("data-tier");for(;e.parent!==e;)e=e.parent;if(e[t])throw new Error("data-tier found to already being running within this application, cancelling current execution");e[t]=!0})();const e=this||window,t={};function n(e){return t[e]}function o(n,o,r){if(function(e){if(!e||"string"!=typeof e)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(e))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}(n),t[n])throw new Error("existing tie ("+n+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new function(n,o,r){let a;function l(t){e.DataTier.views.processChanges(n,t)}Reflect.defineProperty(this,"name",{value:n}),Reflect.defineProperty(this,"data",{get:function(){return a},set:function(t){if(t!==a){let o=a;(a=i(t))&&a.observe(l),e.DataTier.views.processChanges(n,[{path:[]}]),o&&o.revoke()}}}),t[n]=this,this.data=o,Object.seal(this)}(n,i(o),r)}function r(e){e&&t[e]&&(t[e].observable.revoke(),delete t[e])}function i(t){if(void 0===t||null===t)return t;if("object"!=typeof t)throw new Error(t+" is not of type Observable and not an object");if("function"==typeof t.observe&&"function"==typeof t.unobserve&&"function"==typeof t.revoke)return t;if(e.Observable){if("function"==typeof t.observe||"function"==typeof t.unobserve||"function"==typeof t.revoke)throw new Error(t+" is not of type Observable and can not be transformed into Observable (some of its functions already implemented?)");return e.Observable.from(t)}throw new Error(t+" is not of type Observable and no embedded Observable implementation found")}Reflect.defineProperty(e,"DataTier",{value:{}}),Reflect.defineProperty(e.DataTier,"ties",{value:{get get(){return n},get create(){return o},get remove(){return r}}})})(),(()=>{"use strict";const e=this||window,t={};function n(e,t){Reflect.defineProperty(this,"name",{value:e}),Object.assign(this,t)}function o(o,r){if("string"!=typeof o||!o)throw new Error("name MUST be a non-empty string");if(t[o])throw new Error('data controller "'+o+'" already exists; you may want to reconfigure the existing one');if("object"!=typeof r||!r)throw new Error("configuration MUST be a non-null object");if("function"!=typeof r.toView)throw new Error('configuration MUST have a "toView" function defined');t[o]=new n(o,r),e.DataTier.views.applyController(t[o])}function r(e){return t[e]}function i(e){if("string"!=typeof e||!e)throw new Error("controller name MUST be a non-empty string");return delete t[e]}function a(e){let n=[];return e&&e.dataset&&Object.keys(e.dataset).filter(e=>e in t).map(e=>t[e]).forEach(e=>n.push(e)),n}function l(e){let t="",n=[];return e&&(t=(n=e.trim().split(".")).shift()),{tieName:t,dataPath:n}}function s(e,t){return 0===t.indexOf(e)}n.prototype.toData=function(e){!function(e,t,n){let o;if(!e)return;for(o=0;o<t.length-1;o++)e=e[t[o]]&&"object"==typeof e[t[o]]?e[t[o]]:e[t[o]]={};e[t[o]]=n}(e.data,e.path,e.view.value)},n.prototype.parseParam=l,n.prototype.isChangedPathRelevant=s,Reflect.defineProperty(n.prototype,"parseParam",{value:l}),Reflect.defineProperty(n.prototype,"isChangedPathRelevant",{value:s}),Reflect.defineProperty(e.DataTier,"controllers",{value:{get get(){return r},get add(){return o},get remove(){return i},get getApplicable(){return a}}})})(),(()=>{"use strict";const e=this||window;if(!e.DataTier)throw new Error("data-tier framework was not properly initialized");const t=e.DataTier.ties,n=e.DataTier.controllers,o={},r={};function i(e){let o,r,i,a,l=e.target,s=n.getApplicable(l);for(a=s.length;a--;)if(o=s[a],e.type===o.changeDOMEventType){if(r=o.parseParam(l.dataset[o.name]),i=t.get(r.tieName),!r.dataPath)return void console.error("path to data not available");if(!i)return void console.error('tie "'+r.tieName+'" not found');o.toData({data:i.data,path:r.dataPath,view:l})}}function a(e){e.length||(e=[e]);for(let t=0,n=e.length;t<n;t++){let n=e[t];"IFRAME"===n.nodeName?(m(n.contentDocument),n.addEventListener("load",function(){m(this.contentDocument),c(this.contentDocument)}),c(n.contentDocument)):Node.ELEMENT_NODE===n.nodeType&&(n.localName.indexOf("-")<0&&!n.hasAttribute("is")?l(n):customElements.whenDefined(n.getAttribute("is")||n.localName).then(()=>l(n)))}}function l(e){let t=e.dataset,a=Object.keys(t),l=a.length;for(;l--;){let u=a[l];if(0!==u.indexOf("tie"))continue;let d=n.get(u);if(d){let n=d.parseParam(t[d.name]),r=n.dataPath.join("."),a=o[n.tieName]||(o[n.tieName]={}),l=a[d.name]||(a[d.name]={}),u=l[r]||(l[r]=[]);u.indexOf(e)<0&&(u.push(e),s(e,d.name),d.changeDOMEventType&&(c=e,f=d.changeDOMEventType,c.addEventListener(f,i)))}else r[u]||(r[u]=[]),r[u].push(e)}var c,f}function s(e,o){let r,i,a,l;i=(r=n.get(o)).parseParam(e.dataset[o]),(a=t.get(i.tieName))&&(l=function(e,t){if(e){for(let n,o=0,r=t.length;o<r;o++){if(n=t[o],!e||!e.hasOwnProperty(n))return;e=e[n]}return e}}(a.data,i.dataPath),r.toView(l,e))}function c(e){if(e&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.ELEMENT_NODE)){let t;t="IFRAME"===e.nodeName?e.contentDocument.getElementsByTagName("*"):e.getElementsByTagName("*"),a(e),a(t)}}function f(e){if(e&&e.getElementsByTagName){let a,l,s,c,f,u,d,h,p,m=e.getElementsByTagName("*");for(c=0,f=m.length;c<=f;c++)if((a=c<f?m[c]:e).dataset&&Object.keys(a.dataset).length)for(u=(l=n.getApplicable(a)).length;u--;)d=(s=l[u]).parseParam(a.dataset[s.name]),(p=(h=o[d.tieName][s.name][d.dataPath.join(".")]).indexOf(a))>=0&&(h.splice(p,1),s.changeDOMEventType&&(t=a,r=s.changeDOMEventType,t.removeEventListener(r,i)))}var t,r}function u(e,t,r,i){let a;if(a=n.get(t)){if(r){let i=n.get(t).parseParam(r);if(o[i.tieName]&&o[i.tieName][t]){let n=o[i.tieName][t][i.dataPath],r=-1;n&&(r=n.indexOf(e)),r>=0&&n.splice(r,1)}}if(i){let r=n.get(t).parseParam(i);o[r.tieName]||(o[r.tieName]={}),o[r.tieName][t]||(o[r.tieName][t]={}),o[r.tieName][t][r.dataPath]||(o[r.tieName][t][r.dataPath]=[]),o[r.tieName][t][r.dataPath].push(e),s(e,t)}}}function d(e,t){let r,i,a,l,c,f,u,d,h,p,m,g,y,w=o[e];if(w)for(p=t.length;p--;)for(i=(r=t[p]).path?r.path.join("."):null,m=(a=Object.keys(w)).length;m--;)if(d=w[l=a[m]])for(c=n.get(l),g=(f=Object.keys(d)).length;g--;)if(u=f[g],c.isChangedPathRelevant(i,u))for(y=(h=d[u]).length;y--;)s(h[y],l)}function h(e){r[e.name]&&(r[e.name].forEach(a),delete r[e.name])}function p(e){let t,n=2,o=e.split("-");for(t=o[1];n<o.length;)t+=o[n][0].toUpperCase()+o[n++].substr(1);return t}function m(e){new MutationObserver(function(e){let t,n,o,r,i,a,l,s;for(t=e.length;t--;)if("attributes"===(i=(r=e[t]).type)){let e=r.target,t=r.attributeName;if(e.nodeType!==Node.DOCUMENT_NODE&&e.nodeType!==Node.ELEMENT_NODE)continue;0===t.indexOf("data-tie")?u(e,p(t),r.oldValue,e.getAttribute(t)):"src"===t&&"IFRAME"===e.nodeName&&f(e.contentDocument)}else if("childList"===i){for(n=(a=r.addedNodes).length;n--;)(s=a[n]).nodeType!==Node.DOCUMENT_NODE&&s.nodeType!==Node.ELEMENT_NODE||("IFRAME"===s.nodeName?(s.contentDocument&&(m(s.contentDocument),c(s.contentDocument)),s.addEventListener("load",function(){m(this.contentDocument),c(this.contentDocument)})):c(s));for(o=(l=r.removedNodes).length;o--;)(s=l[o]).nodeType!==Node.DOCUMENT_NODE&&s.nodeType!==Node.ELEMENT_NODE||("IFRAME"===s.nodeName?f(s.contentDocument):f(s))}}).observe(e,{childList:!0,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!0,characterDataOldValue:!1})}Reflect.defineProperty(e.DataTier,"views",{value:{get processChanges(){return d},get applyController(){return h},get updateView(){return s}}}),m(document),c(document)})(),(()=>{"use strict";const e=(this||window).DataTier.controllers.add;e("tieProperty",{parseParam:function(e){return this.constructor.prototype.parseParam(e?e.split("=>").shift().trim():null)},toView:(e,t)=>{t[t.dataset.tieProperty.split("=>").pop().trim()]=e}}),e("tieValue",{toView:function(e,t){"checkbox"===t.type?t.checked=e:t.value=void 0!==e&&null!==e?e:""},changeDOMEventType:"change"}),e("tieInput",{toView:function(e,t){t.value=void 0!==e&&null!==e?e:""},changeDOMEventType:"input"}),e("tieText",{toView:function(e,t){t.textContent=void 0!==e&&null!==e?e:""}}),e("tiePlaceholder",{toView:function(e,t){t.placeholder=void 0!==e&&null!==e?e:""}}),e("tieTooltip",{toView:function(e,t){t.title=void 0!==e&&null!==e?e:""}}),e("tieSrc",{toView:function(e,t){t.src=void 0!==e&&null!==e?e:""}}),e("tieHref",{toView:function(e,t){t.href=void 0!==e&&null!==e?e:""}}),e("tieClasses",{isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},toView:function(e,t){e&&"object"==typeof e&&Object.keys(e).forEach(function(n){e[n]?t.classList.add(n):t.classList.remove(n)})}})})(),(()=>{"use strict";const e=(this||window).DataTier.controllers.add;function t(e){let t=e||"textContent";this.format="dd/MM/yyyy hh:mm:ss",this.toView=function(e,n){let o=e;if(e)if(e instanceof Date)o=r(e,this.format);else try{let t=new Date(e);t instanceof Date&&(o=r(t,this.format))}catch(t){console.error('failed to parse "'+e+'" as date',t)}else o="";n[t]=o}}function n(){t.call(this,"value"),this.toData=function(e){console.warn("yet to be implemented, react on "+e)}}e("tieDateValue",{toView:function(e,t){t.value=void 0!==e&&null!==e?e.toLocaleString():""}}),e("tieDateText",{toView:function(e,t){t.textContent=void 0!==e&&null!==e?e.toLocaleString():""}}),e("tieDatetimeText",new t),e("tieDatetimeValue",new n),n.prototype=Object.create(t.prototype),n.prototype.constructor=n;let o={d:function(e,t){return e.getDate().toString().padStart(t,"0")},M:function(e,t){return(e.getMonth()+1).toString().padStart(t,"0")},y:function(e,t){let n=e.getFullYear().toString();return n.length>t?n.substr(n.length-t):n.padStart(t,"0")},h:function(e,t){return e.getHours().toString().padStart(t,"0")},m:function(e,t){return e.getMinutes().toString().padStart(t,"0")},s:function(e,t){return e.getSeconds().toString().padStart(t,"0")},f:function(e,t){return e.getMilliseconds().toString().padStart(t,"0")}};function r(e,t){let n="";if(t){let r,i;for(let a=0,l=t.length;a<l;a++)if(r=t.charAt(a),o[r]){for(i=1;a<l-1&&t.charAt(a+1)===r;)i++,a++;n+=o[r](e,i)}else n+=r}else n=e.toLocaleString();return n}})(),(()=>{"use strict";const e=this||window,t=e.DataTier.controllers.add,n=e.DataTier.views;function o(e,t,n,o,r){let i,a,l,s,c,f,u,d,h,p,m,g=null,y=o,w=n[0]+".";for(a=t.content,u=(i=function(e,t){let n,o,r,i,a,l,s={index:[]},c=e.content.querySelectorAll("*"),f=c.length;for(;f--;)if((n=c[f]).nodeType===Node.DOCUMENT_NODE||n.nodeType===Node.ELEMENT_NODE){for(r=(o=Object.keys(n.dataset)).length,l=[];r--;)i=o[r],a=n.dataset[i],i.startsWith("tie")&&a.startsWith(t)&&l.push([i,a.replace(t,"")]);l.length&&(s[f]=l,s.index.push(f))}return s}(t,n[2])).index;y<r;y++){for(d=(l=a.cloneNode(!0)).querySelectorAll("*"),s=u.length;s--;)for(h=d[f=u[s]],c=(p=i[f]).length;c--;)m=p[c][0],h.dataset[m]=w+y+p[c][1];y===o?g=l:g.appendChild(l)}e.appendChild(g)}t("tieList",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(e,t){if(!e)return!0;let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},toView:function(e,t){if(!Array.isArray(e)||!t)return;let r,i,a,l=t.parentNode,s=e.length;if("TEMPLATE"!==t.nodeName)throw new Error("tieList may be defined on template elements only");if(1!==t.content.childElementCount)throw new Error("tieList's TEMPLATE element MUST HAVE exactly one direct child element");(a=(i=t.content.firstElementChild.dataset).dtListItemAid)||(a=(new Date).getTime(),i.dtListItemAid=a);let c=l.querySelectorAll('[data-dt-list-item-aid="'+a+'"]'),f=c.length;if(f>s)for(;f>s;)l.removeChild(c[--f]);!function(e,t,o){let r,i=e.content.querySelectorAll("*"),a=[];for(r=i.length;r--;)a[r]=Object.keys(i[r].dataset).filter(e=>e.startsWith("tie"));let l,s,c,f,u,d,h=0;for(r=0;h<o;)if((c=t.childNodes[r++])!==e&&(c.nodeType===Node.DOCUMENT_NODE||c.nodeType===Node.ELEMENT_NODE)&&c.dataset.dtListItemAid){for(f=c.querySelectorAll("*"),l=a.length;l--;)for(u=l?f[l-1]:c,s=(d=a[l]).length;s--;)n.updateView(u,d[s]);h++}}(t,l,f),f<s&&o(l,t,r=function(e){let t;if(e&&(!(t=e.trim().split(/\s+/))||3!==t.length||"=>"!==t[1]))throw new Error('invalid parameter for "tieList" rule specified');return t}(t.dataset.tieList),f,s)}})})();