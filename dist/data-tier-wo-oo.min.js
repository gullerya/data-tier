(()=>{"use strict";function e(e,r,o){let i;Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"data",{get:function(){return i},set:function(a){let r=i,o=t(a);i&&i.revoke(),(i=o)&&i.observe(function(t){n.DataTier.views.processChanges(e,t)}),n.DataTier.views.processChanges(e,[{type:"update",value:i,oldValue:r,path:[]}])}}),a[e]=this,this.data=r}function t(e){if(void 0===e||null===e)return e;if("object"!=typeof e)throw new Error(e+" is not of type Observable and not an object");if("function"==typeof e.observe&&"function"==typeof e.unobserve&&"function"==typeof e.revoke)return e;if(n.Observable){if("function"==typeof e.observe||"function"==typeof e.unobserve||"function"==typeof e.revoke)throw new Error(e+" is not of type Observable and can not be transformed into Observable (some of its functions already implemented?)");return n.Observable.from(e)}throw new Error(e+" is not of type Observable and no embedded Observable implementation found")}const n=this||window,a={};e.prototype.viewToDataProcessor=function(e){!function(e,t,n){let a;if(e){for(a=0;a<t.length-1;a++)e=t[a]in e?e[t[a]]:{};e[t[a]]=n}}(e.data,e.path,e.view.value)},Reflect.defineProperty(n,"DataTier",{value:{}}),Reflect.defineProperty(n.DataTier,"ties",{value:{get get(){return function(e){return a[e]}},get create(){return function(n,r,o){if(function(e){if(!e||"string"!=typeof e)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(e))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}(n),a[n])throw new Error("existing tie ("+n+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new e(n,t(r),o)}},get remove(){return function(e){e&&a[e]&&(a[e].observable.revoke(),delete a[e])}}}})})(),(()=>{"use strict";function e(e,t){Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"toView",{value:t.toView}),"function"==typeof t.toData&&Reflect.defineProperty(this,"toData",{value:t.toData}),"function"==typeof t.parseParam&&Reflect.defineProperty(this,"parseParam",{value:t.parseParam}),"function"==typeof t.isChangedPathRelevant&&Reflect.defineProperty(this,"isChangedPathRelevant",{value:t.isChangedPathRelevant})}const t=this||window,n={};if(!t.DataTier)throw new Error("DataTier framework was not properly initialized");e.prototype.parseParam=function(e){let t="",n=[];return e&&(t=(n=e.trim().split(".")).shift()),{tieName:t,dataPath:n}},e.prototype.isChangedPathRelevant=function(e,t){return t.startsWith(e)},Reflect.defineProperty(t.DataTier,"processors",{value:{get get(){return function(e){return n[e]}},get add(){return function(a,r){if("string"!=typeof a||!a)throw new Error("name MUST be a non-empty string");if(n[a])throw new Error('data processor "'+a+'" already exists; you may want to reconfigure the existing one');if("object"!=typeof r||!r)throw new Error("configuration MUST be a non-null object");if("function"!=typeof r.toView)throw new Error('configuration MUST have a "toView" function defined');n[a]=new e(a,r),t.DataTier.views.applyProcessor(n[a])}},get remove(){return function(e){if("string"!=typeof e||!e)throw new Error("controller name MUST be a non-empty string");return delete n[e]}},get getApplicable(){return function(e){let t=[];return e&&e.dataset&&Object.keys(e.dataset).filter(e=>e in n).map(e=>n[e]).forEach(t.push),t}}}})})(),(()=>{"use strict";function e(e){c.getApplicable(e.target).forEach(t=>{if("tieValue"===t.name){let n=t.parseParam(e.target.dataset[t.name]),a=s.get(n.tieName);if(!n.dataPath)return void console.error("path to data not available");if(!a)return void console.error('tie "'+n.tieName+'" not found');a.viewToDataProcessor({data:a.data,path:n.dataPath,view:e.target})}})}function t(t){"IFRAME"===t.nodeName?(o(t.contentDocument),t.addEventListener("load",function(){o(this.contentDocument),a(this.contentDocument)}),a(t.contentDocument)):t.dataset&&Object.keys(t.dataset).forEach(a=>{if(a.startsWith("tie")){let r=c.get(a);if(r){let a,o,i,s=r.parseParam(t.dataset[r.name]),c=s.dataPath.join(".");l[s.tieName]||(l[s.tieName]={}),(a=l[s.tieName])[r.name]||(a[r.name]={}),(o=a[r.name])[c]||(o[c]=[]),(i=o[c]).indexOf(t)<0&&(i.push(t),n(t,r.name),function(t){"INPUT"!==t.nodeName&&"SELECT"!==t.nodeName||t.addEventListener("change",e)}(t))}else f[a]||(f[a]=[]),f[a].push(t)}})}function n(e,t){let n,a,r,o;a=(n=c.get(t)).parseParam(e.dataset[t]),(r=s.get(a.tieName))&&(o=function(e,t){let n;if(e){for(n=0;n<t.length;n++){if(!(t[n]in e))return;e=e[t[n]]}return e}}(r.data,a.dataPath),n.toView(o,e))}function a(e){if(e&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.ELEMENT_NODE)){let n;(n="IFRAME"===e.nodeName?Array.from(e.contentDocument.getElementsByTagName("*")):Array.from(e.getElementsByTagName("*"))).push(e),n.forEach(t)}}function r(t){let n,a,r,o;t&&t.getElementsByTagName&&((n=Array.from(t.getElementsByTagName("*"))).push(t),n.forEach(t=>{c.getApplicable(t).forEach(n=>{a=n.parseParam(t.dataset[n.name]),r=l[a.tieName][n.name][a.dataPath.join(".")],(o=r.indexOf(t))>=0&&(r.splice(o,1),function(t){t.removeEventListener("change",e)}(t))})}))}function o(e){new MutationObserver(function(e){e.forEach(e=>{if("attributes"===e.type){let t=e.target,a=e.attributeName;0===a.indexOf("data-tie")?function(e,t,a,r){let o,i,s=-1;o=c.get(t).parseParam(a),l[o.tieName]&&l[o.tieName][t]&&((i=l[o.tieName][t][o.dataPath])&&(s=i.indexOf(e)),s>=0&&i.splice(s,1)),o=c.get(t).parseParam(r),l[o.tieName]||(l[o.tieName]={}),l[o.tieName][t]||(l[o.tieName][t]={}),l[o.tieName][t][o.dataPath]||(l[o.tieName][t][o.dataPath]=[]),l[o.tieName][t][o.dataPath].push(e),n(e,t)}(t,function(e){let t,n=2,r=a.split("-");for(t=r[1];n<r.length;)t+=r[n][0].toUpperCase()+r[n++].substr(1);return t}(),e.oldValue,t.getAttribute(a)):"src"===a&&"IFRAME"===t.nodeName&&r(t.contentDocument)}else"childList"===e.type&&(Array.from(e.addedNodes).forEach(e=>{"IFRAME"===e.nodeName?(e.contentDocument&&(o(e.contentDocument),a(e.contentDocument)),e.addEventListener("load",function(){o(this.contentDocument),a(this.contentDocument)})):a(e)}),Array.from(e.removedNodes).forEach(e=>{r("IFRAME"===e.nodeName?e.contentDocument:e)}))})}).observe(e,{childList:!0,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!0,characterDataOldValue:!1})}const i=this||window;if(!i.DataTier)throw new Error("DataTier framework was not properly initialized");const s=i.DataTier.ties,c=i.DataTier.processors,l={},f={};Reflect.defineProperty(i.DataTier,"views",{value:{get processChanges(){return function(e,t){let a,r,o,i=l[e];i&&t.forEach(e=>{o=e.path.join("."),Object.keys(i).forEach(e=>{(r=i[e])&&(a=c.get(e),Object.keys(r).forEach(t=>{a.isChangedPathRelevant(o,t)&&r[t].forEach(t=>{n(t,e)})}))})})}},get applyProcessor(){return function(e){f[e.name]&&(f[e.name].forEach(t),delete f[e.name])}}}}),o(document),a(document)})(),(()=>{"use strict";const e=this||window,t=e.DataTier.processors.add;if(!e.DataTier)throw new Error("DataTier framework was not properly initialized");t("tieValue",{toView:function(e,t){"checkbox"===t.type?t.checked=e:t.value=void 0!==e&&null!==e?e:""}}),t("tieText",{toView:function(e,t){t.textContent=void 0!==e&&null!==e?e:""}}),t("tiePlaceholder",{toView:function(e,t){t.placeholder=void 0!==e&&null!==e?e:""}}),t("tieTooltip",{toView:function(e,t){t.title=void 0!==e&&null!==e?e:""}}),t("tieSrc",{toView:function(e,t){t.src=void 0!==e&&null!==e?e:""}}),t("tieHRef",{toView:function(e,t){t.href=void 0!==e&&null!==e?e:""}}),t("tieDateValue",{toView:function(e,t){t.value=void 0!==e&&null!==e?e.toLocaleString():""}}),t("tieDateText",{toView:function(e,t){t.textContent=void 0!==e&&null!==e?e.toLocaleString():""}}),t("tieClasses",{isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},toView:function(e,t){e&&"object"==typeof e&&Object.keys(e).forEach(function(n){e[n]?t.classList.add(n):t.classList.remove(n)})}}),t("tieList",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},toView:function(e,t){let n,a,r,o,i,s,c,l=t.parentNode;if("TEMPLATE"!==t.nodeName)throw new Error("tieList may be defined on template elements only");if(t.dataset.listSourceAid||(t.dataset.listSourceAid=(new Date).getTime()),n=function(e,t){let n=Array.from(l.querySelectorAll('[data-list-item-aid="'+t+'"]'));for(;n.length>e;)l.removeChild(n.pop());return n.length}(e?e.length:0,t.dataset.listSourceAid),e&&n<e.length)if((r=t.dataset.tieList.trim().split(/\s+/))&&3===r.length&&"=>"===r[1]){for(o=r[2],s=(i=t.ownerDocument).createDocumentFragment();n<e.length;n++){for(a=i.importNode(t.content,!0),Array.from(a.querySelectorAll("*")).forEach(e=>{Object.keys(e.dataset).forEach(t=>{let a=e.dataset[t];a.startsWith(o)&&(e.dataset[t]=a.replace(o,r[0]+"."+n))})}),s.appendChild(a),c=s.lastChild;c.nodeType!==Node.ELEMENT_NODE&&null!==c.previousSibling;)c=c.previousSibling;c.dataset.listItemAid=t.dataset.listSourceAid}l.appendChild(s)}else console.error('invalid parameter for "tieList" rule specified')}})})();