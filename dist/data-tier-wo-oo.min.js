(()=>{"use strict";function e(e){return i[e]}function t(e,t,n){if(function(e){if(!e||"string"!=typeof e)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(e))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}(e),i[e])throw new Error("existing tie ("+e+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new function(e,t,n){function a(t){r.DataTier.views.processChanges(e,t)}let l;Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"data",{get:function(){return l},set:function(t){let n=l,i=o(t);l&&l.revoke(),(l=i)&&l.observe(a),r.DataTier.views.processChanges(e,[{type:"update",value:l,oldValue:n,path:[]}])}}),i[e]=this,this.data=t,Object.seal(this)}(e,o(t),n)}function n(e){e&&i[e]&&(i[e].observable.revoke(),delete i[e])}function o(e){if(void 0===e||null===e)return e;if("object"!=typeof e)throw new Error(e+" is not of type Observable and not an object");if("function"==typeof e.observe&&"function"==typeof e.unobserve&&"function"==typeof e.revoke)return e;if(r.Observable){if("function"==typeof e.observe||"function"==typeof e.unobserve||"function"==typeof e.revoke)throw new Error(e+" is not of type Observable and can not be transformed into Observable (some of its functions already implemented?)");return r.Observable.from(e)}throw new Error(e+" is not of type Observable and no embedded Observable implementation found")}(()=>{let e=window,t=Symbol.for("data-tier");for(;e.parent!==e;)e=e.parent;if(e[t])throw new Error("data-tier found to already being running within this application, cancelling current execution");e[t]=!0})();const r=this||window,i={};Reflect.defineProperty(r,"DataTier",{value:{}}),Reflect.defineProperty(r.DataTier,"ties",{value:{get get(){return e},get create(){return t},get remove(){return n}}})})(),(()=>{"use strict";function e(e,t){Reflect.defineProperty(this,"name",{value:e}),Object.assign(this,t)}function t(t,n){if("string"!=typeof t||!t)throw new Error("name MUST be a non-empty string");if(s[t])throw new Error('data controller "'+t+'" already exists; you may want to reconfigure the existing one');if("object"!=typeof n||!n)throw new Error("configuration MUST be a non-null object");if("function"!=typeof n.toView)throw new Error('configuration MUST have a "toView" function defined');s[t]=new e(t,n),l.DataTier.views.applyController(s[t])}function n(e){return s[e]}function o(e){if("string"!=typeof e||!e)throw new Error("controller name MUST be a non-empty string");return delete s[e]}function r(e){let t=[];return e&&e.dataset&&Object.keys(e.dataset).filter(e=>e in s).map(e=>s[e]).forEach(e=>t.push(e)),t}function i(e){let t="",n=[];return e&&(t=(n=e.trim().split(".")).shift()),{tieName:t,dataPath:n}}function a(e,t){return t.startsWith(e)}const l=this||window,s={};e.prototype.toData=function(e){!function(e,t,n){let o;if(e){for(o=0;o<t.length-1;o++)e=e[t[o]]&&"object"==typeof e[t[o]]?e[t[o]]:e[t[o]]={};e[t[o]]=n}}(e.data,e.path,e.view.value)},e.prototype.parseParam=i,e.prototype.isChangedPathRelevant=a,Reflect.defineProperty(e.prototype,"parseParam",{value:i}),Reflect.defineProperty(e.prototype,"isChangedPathRelevant",{value:a}),Reflect.defineProperty(l.DataTier,"controllers",{value:{get get(){return n},get add(){return t},get remove(){return o},get getApplicable(){return r}}})})(),(()=>{"use strict";function e(e){let t,n,o,r,i=e.target,a=h.getApplicable(i);for(r=a.length;r--;)if(t=a[r],e.type===t.changeDOMEventType){if(n=t.parseParam(i.dataset[t.name]),o=p.get(n.tieName),!n.dataPath)return void console.error("path to data not available");if(!o)return void console.error('tie "'+n.tieName+'" not found');t.toData({data:o.data,path:n.dataPath,view:i})}}function t(t,n){t.addEventListener(n,e)}function n(t,n){t.removeEventListener(n,e)}function o(e){if("IFRAME"===e.nodeName)f(e.contentDocument),e.addEventListener("load",function(){f(this.contentDocument),i(this.contentDocument)}),i(e.contentDocument);else if(e.dataset){let n,o,i,a,l,s,c,u,f=Object.keys(e.dataset);for(u=f.length;u--;)(n=f[u]).startsWith("tie")&&((o=h.get(n))?(a=(i=o.parseParam(e.dataset[o.name])).dataPath.join("."),(c=(s=(l=m[i.tieName]||(m[i.tieName]={}))[o.name]||(l[o.name]={}))[a]||(s[a]=[])).indexOf(e)<0&&(c.push(e),r(e,o.name),o.changeDOMEventType&&t(e,o.changeDOMEventType))):(g[n]||(g[n]=[]),g[n].push(e)))}}function r(e,t){let n,o,r,i;o=(n=h.get(t)).parseParam(e.dataset[t]),(r=p.get(o.tieName))&&(i=function(e,t){if(e){for(let n=0,o=t.length;n<o;n++){if(!(e&&t[n]in e))return;e=e[t[n]]}return e}}(r.data,o.dataPath),n.toView(i,e))}function i(e){if(e&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.ELEMENT_NODE)){let t,n;for(t="IFRAME"===e.nodeName?e.contentDocument.getElementsByTagName("*"):e.getElementsByTagName("*"),o(e),n=t.length;n--;)o(t[n])}}function a(e){if(e&&e.getElementsByTagName){let t,o,r,i,a,l,s,c,u,f=e.getElementsByTagName("*");for(i=0,a=f.length;i<=a;i++)if((t=i<a?f[i]:e).dataset&&Object.keys(t.dataset).length)for(l=(o=h.getApplicable(t)).length;l--;)s=(r=o[l]).parseParam(t.dataset[r.name]),(u=(c=m[s.tieName][r.name][s.dataPath.join(".")]).indexOf(t))>=0&&(c.splice(u,1),r.changeDOMEventType&&n(t,r.changeDOMEventType))}}function l(e,t,n,o){let i,a,l,s=-1;(i=h.get(t))&&(a=h.get(t).parseParam(n),m[a.tieName]&&m[a.tieName][t]&&((l=m[a.tieName][t][a.dataPath])&&(s=l.indexOf(e)),s>=0&&l.splice(s,1)),a=h.get(t).parseParam(o),m[a.tieName]||(m[a.tieName]={}),m[a.tieName][t]||(m[a.tieName][t]={}),m[a.tieName][t][a.dataPath]||(m[a.tieName][t][a.dataPath]=[]),m[a.tieName][t][a.dataPath].push(e),r(e,t))}function s(e,t){let n,o,i,a,l,s,c,u,f,d,p,g,y,w=m[e];if(w)for(d=t.length;d--;)for(o=(n=t[d]).path?n.path.join("."):null,p=(i=Object.keys(w)).length;p--;)if(a=i[p],u=w[a])for(l=h.get(a),g=(s=Object.keys(u)).length;g--;)if(c=s[g],l.isChangedPathRelevant(o,c))for(y=(f=u[c]).length;y--;)r(f[y],a)}function c(e){g[e.name]&&(g[e.name].forEach(o),delete g[e.name])}function u(e){let t,n=2,o=e.split("-");for(t=o[1];n<o.length;)t+=o[n][0].toUpperCase()+o[n++].substr(1);return t}function f(e){new MutationObserver(function(e){let t,n,o,r,s,c,d,p;for(t=e.length;t--;)if(r=e[t],"attributes"===(s=r.type)){let e=r.target,t=r.attributeName;if(e.nodeType!==Node.DOCUMENT_NODE&&e.nodeType!==Node.ELEMENT_NODE)continue;0===t.indexOf("data-tie")?l(e,u(t),r.oldValue,e.getAttribute(t)):"src"===t&&"IFRAME"===e.nodeName&&a(e.contentDocument)}else if("childList"===s){for(n=(c=r.addedNodes).length;n--;)(p=c[n]).nodeType!==Node.DOCUMENT_NODE&&p.nodeType!==Node.ELEMENT_NODE||("IFRAME"===p.nodeName?(p.contentDocument&&(f(p.contentDocument),i(p.contentDocument)),p.addEventListener("load",function(){f(this.contentDocument),i(this.contentDocument)})):i(p));for(o=(d=r.removedNodes).length;o--;)(p=d[o]).nodeType!==Node.DOCUMENT_NODE&&p.nodeType!==Node.ELEMENT_NODE||a("IFRAME"===p.nodeName?p.contentDocument:p)}}).observe(e,{childList:!0,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!0,characterDataOldValue:!1})}const d=this||window;if(!d.DataTier)throw new Error("data-tier framework was not properly initialized");const p=d.DataTier.ties,h=d.DataTier.controllers,m={},g={};Reflect.defineProperty(d.DataTier,"views",{value:{get processChanges(){return s},get applyController(){return c},get updateView(){return r}}}),f(document),i(document)})(),(()=>{"use strict";const e=(this||window).DataTier.controllers.add;e("tieProperty",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split("=>").shift().trim())},toView:(e,t)=>{t[t.dataset.tieProperty.split("=>").pop().trim()]=e}}),e("tieValue",{toView:function(e,t){"checkbox"===t.type?t.checked=e:t.value=void 0!==e&&null!==e?e:""},changeDOMEventType:"change"}),e("tieInput",{toView:function(e,t){t.value=void 0!==e&&null!==e?e:""},changeDOMEventType:"input"}),e("tieText",{toView:function(e,t){t.textContent=void 0!==e&&null!==e?e:""}}),e("tiePlaceholder",{toView:function(e,t){t.placeholder=void 0!==e&&null!==e?e:""}}),e("tieTooltip",{toView:function(e,t){t.title=void 0!==e&&null!==e?e:""}}),e("tieSrc",{toView:function(e,t){t.src=void 0!==e&&null!==e?e:""}}),e("tieHref",{toView:function(e,t){t.href=void 0!==e&&null!==e?e:""}}),e("tieClasses",{isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},toView:function(e,t){e&&"object"==typeof e&&Object.keys(e).forEach(function(n){e[n]?t.classList.add(n):t.classList.remove(n)})}})})(),(()=>{"use strict";function e(e){let t=e||"textContent";this.format="dd/MM/yyyy hh:mm:ss",this.toView=function(e,o){let r=e;if(e)if(e instanceof Date)r=n(e,this.format);else try{let t=new Date(e);t instanceof Date&&(r=n(t,this.format))}catch(t){console.error('failed to parse "'+e+'" as date',t)}else r="";o[t]=r}}function t(){e.call(this,"value"),this.toData=function(e){console.warn("yet to be implemented, react on "+e)}}function n(e,t){let n="";if(t){let o,i;for(let a=0,l=t.length;a<l;a++)if(o=t.charAt(a),r[o]){for(i=1;a<l-1&&t.charAt(a+1)===o;)i++,a++;n+=r[o](e,i)}else n+=o}else n=e.toLocaleString();return n}const o=(this||window).DataTier.controllers.add;o("tieDateValue",{toView:function(e,t){t.value=void 0!==e&&null!==e?e.toLocaleString():""}}),o("tieDateText",{toView:function(e,t){t.textContent=void 0!==e&&null!==e?e.toLocaleString():""}}),o("tieDatetimeText",new e),o("tieDatetimeValue",new t),(t.prototype=Object.create(e.prototype)).constructor=t;let r={d:function(e,t){return e.getDate().toString().padStart(t,"0")},M:function(e,t){return(e.getMonth()+1).toString().padStart(t,"0")},y:function(e,t){let n=e.getFullYear().toString();return n.length>t?n.substr(n.length-t):n.padStart(t,"0")},h:function(e,t){return e.getHours().toString().padStart(t,"0")},m:function(e,t){return e.getMinutes().toString().padStart(t,"0")},s:function(e,t){return e.getSeconds().toString().padStart(t,"0")},f:function(e,t){return e.getMilliseconds().toString().padStart(t,"0")}}})(),(()=>{"use strict";function e(e,t,n,o,r){let i,a,l,s,c,u,f,d,p,h,m,g=null,y=o,w=n[0]+".";for(a=t.content,f=(i=function(e,t){let n,o,r,i,a,l,s={index:[]},c=e.content.querySelectorAll("*"),u=c.length;for(;u--;)if((n=c[u]).nodeType===Node.DOCUMENT_NODE||n.nodeType===Node.ELEMENT_NODE){for(r=(o=Object.keys(n.dataset)).length,l=[];r--;)i=o[r],a=n.dataset[i],i.startsWith("tie")&&a.startsWith(t)&&l.push([i,a.replace(t,"")]);l.length&&(s[u]=l,s.index.push(u))}return s}(t,n[2])).index;y<r;y++){for(d=(l=a.cloneNode(!0)).querySelectorAll("*"),s=f.length;s--;)for(p=d[u=f[s]],c=(h=i[u]).length;c--;)m=h[c][0],p.dataset[m]=w+y+h[c][1];y===o?g=l:g.appendChild(l)}e.appendChild(g)}const t=this||window,n=t.DataTier.controllers.add,o=t.DataTier.views;n("tieList",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(e,t){if(!e)return!0;let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},toView:function(t,n){if(!Array.isArray(t)||!n)return;let r,i,a,l=n.parentNode,s=t.length;if("TEMPLATE"!==n.nodeName)throw new Error("tieList may be defined on template elements only");if(1!==n.content.childElementCount)throw new Error("tieList's TEMPLATE element MUST HAVE exactly one direct child element");(a=(i=n.content.firstElementChild.dataset).dtListItemAid)||(a=(new Date).getTime(),i.dtListItemAid=a);let c=l.querySelectorAll('[data-dt-list-item-aid="'+a+'"]'),u=c.length;if(u>s)for(;u>s;)l.removeChild(c[--u]);!function(e,t,n){let r,i=e.content.querySelectorAll("*"),a=[];for(r=i.length;r--;)a[r]=Object.keys(i[r].dataset).filter(e=>e.startsWith("tie"));let l,s,c,u,f,d,p=0;for(r=0;p<n;)if((c=t.childNodes[r++])!==e&&(c.nodeType===Node.DOCUMENT_NODE||c.nodeType===Node.ELEMENT_NODE)&&c.dataset.dtListItemAid){for(u=c.querySelectorAll("*"),l=a.length;l--;)for(f=l?u[l-1]:c,s=(d=a[l]).length;s--;)o.updateView(f,d[s]);p++}}(n,l,u),u<s&&e(l,n,r=function(e){let t;if(e&&(!(t=e.trim().split(/\s+/))||3!==t.length||"=>"!==t[1]))throw new Error('invalid parameter for "tieList" rule specified');return t}(n.dataset.tieList),u,s)}})})();