!function(a){"use strict";function b(a,b,c){function d(b){h.views.processChanges(a,b)}var e;Reflect.defineProperty(this,"name",{value:a}),Reflect.defineProperty(this,"data",{get:function(){return e},set:function(a){f(a),e&&e.revoke(),e=a,e.observe(d)}}),this.data=b}function c(a,c,d){if(e(a),f(c),i[a])throw new Error("existing tie ("+a+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return i[a]=new b(a,c,d)}function d(a){a&&i[a]&&(i[a].observable.revoke(),delete i[a])}function e(a){if(!a||"string"!=typeof a)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(a))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}function f(a){if(!a||"object"!=typeof a||"function"!=typeof a.observe||"function"!=typeof a.unobserve||"function"!=typeof a.revoke)throw new Error(a+" is not a valid Observable")}function g(a){h=a,Reflect.defineProperty(this,"get",{value:function(a){return i[a]}}),Reflect.defineProperty(this,"create",{value:c}),Reflect.defineProperty(this,"remove",{value:d})}var h,i={};a.DataTier||Reflect.defineProperty(a,"DataTier",{value:{}}),Reflect.defineProperty(a.DataTier,"TiesService",{value:g})}(this),function(a){"use strict";function b(a,b){if("string"!=typeof a||!a)throw new Error("name MUST be a non-empty string");if(i[a])throw new Error('rule "'+a+'" already exists; you may want to reconfigure the existing rule');if("object"!=typeof b||!b)throw new Error("options MUST be a non-null object");if("function"!=typeof b.dataToView)throw new Error('options MUST have a "dataToView" function defined');Reflect.defineProperty(this,"name",{value:a}),Reflect.defineProperty(this,"dataToView",{value:b.dataToView}),"function"==typeof b.inputToData&&Reflect.defineProperty(this,"inputToData",{value:b.inputToData}),"function"==typeof b.parseValue&&Reflect.defineProperty(this,"parseValue",{value:b.parseValue})}function c(a){if(!(a&&a instanceof b))throw new Error("rule MUST be an object of type Rule");i[a.name]=a}function d(a){return i[a]?i[a]:void console.error('rule "'+a+'" is not defined')}function e(a){if("string"!=typeof a||!a)throw new Error("rule name MUST be a non-empty string");return delete i[a]}function f(a){var b=[];return a&&a.nodeType===Node.ELEMENT_NODE&&Reflect.ownKeys(a.dataset).forEach(function(a){i[a]&&b.push(i[a])}),b}function g(a){h=a,h.rules={},Reflect.defineProperty(this,"Rule",{value:b}),Reflect.defineProperty(this,"get",{value:d}),Reflect.defineProperty(this,"add",{value:c}),Reflect.defineProperty(this,"remove",{value:e}),Reflect.defineProperty(h.rules,"getApplicable",{value:f})}var h,i={};a.DataTier||Reflect.defineProperty(a,"DataTier",{value:{}}),b.prototype.parseParam=function(a){var b,c;return a?(b=a.split("."),c=b[0].split(":")[0],b[0]===c?b=[]:b[0]=b[0].replace(c+":",""),{tieName:c,dataPath:b}):void console.error("valid rule value MUST be a non-empty string, found: "+a)},Reflect.defineProperty(a.DataTier,"RulesService",{value:g})}(this),function(a){"use strict";function b(b){var c=a.DataTier.rules.Rule,d=a.DataTier.rules.add;d(new c("tie",{dataToView:function(a,b){var c=["INPUT","TEXTAREA","SELECT","OPTION","PROGRESS","METER"];b&&b.nodeType===Node.ELEMENT_NODE?c.indexOf(b.tagName)>=0?b.value=a:b.textContent=a:console.error("valid element expected, found: "+b)}})),d(new c("tieValue",{dataToView:function(a,b){b.value=a}})),d(new c("tieText",{dataToView:function(a,b){b.textContent=a}})),d(new c("tiePlaceholder",{dataToView:function(a,b){b.placeholder=a}})),d(new c("tieTooltip",{dataToView:function(a,b){b.title=a}})),d(new c("tieImage",{dataToView:function(a,b){b.src=a}})),d(new c("tieDateValue",{dataToView:function(a,b){b.value=a.toLocaleString()}})),d(new c("tieDateText",{dataToView:function(a,b){b.textContent=a.toLocaleString()}})),d(new c("tieList",{parseValue:function(a){return c.prototype.parseValue(a.split(/\s*=>\s*/)[0])},dataToView:function(a,c){function d(a,b){for(var c=Array.from(l.querySelectorAll('[data-list-item-aid="'+b+'"]'));c.length>a;)l.removeChild(c.pop());return c.length}var e,f,g,h,i,j,k,l=c.parentNode;if("TEMPLATE"!==c.nodeName)throw new Error("tieList may be defined on template elements only");if(c.dataset.listSourceAid||(c.dataset.listSourceAid=(new Date).getTime()),e=d(a.data?a.data.length:0,c.dataset.listSourceAid),a.data&&e<a.data.length)if(g=c.dataset.tieList.trim().split(/\s+/),g&&3===g.length&&"=>"===g[1]){for(h=g[2],j=c.ownerDocument,k=j.createDocumentFragment();e<a.data.length;e++)f=j.importNode(c.content,!0),i=Array.prototype.slice.call(f.querySelectorAll("*"),0),i.forEach(function(a){Object.keys(a.dataset).forEach(function(c){0===a.dataset[c].indexOf(h+".")&&(a.dataset[c]=a.dataset[c].replace(h,g[0]+"."+e),b.views.update(a,c))})}),k.appendChild(f),k.lastElementChild.dataset.listItemAid=c.dataset.listSourceAid;l.appendChild(k)}else console.error('invalid parameter for "tieList" rule specified')}}))}Reflect.defineProperty(a.DataTier,"initVanillaRules",{value:b})}(this),function(a){"use strict";function b(a,b){var c;if(a){for(c=0;c<b.length;c++)if(a=a[b[c]],!a)return;return a}}function c(a){var b,c,d,e=a.target;return(b=e.dataset.tieValue?e.dataset.tieValue:e.dataset.tie)?(b=b.split("."))?(c=b.shift(),(d=p.ties.obtain(c))?void d.viewToDataProcessor({data:d.data,path:b,view:e}):void console.error('tie "'+c+'" not found')):void console.error("path to data is invalid"):void console.error("path to data not available")}function d(a){var b=a.ownerDocument.defaultView;(a instanceof b.HTMLInputElement||a instanceof b.HTMLSelectElement)&&a.addEventListener("change",c)}function e(a){a.removeEventListener("change",c)}function f(b){if("IFRAME"===b.nodeName)m(b.contentDocument),b.addEventListener("load",function(){m(this.contentDocument),h(this.contentDocument)}),h(b.contentDocument);else{p.rules.getApplicable(b).forEach(function(a){var c,e,f,h=a.parseParam(b.dataset[a.name]),i=h.dataPath.join(".");q[h.tieName]||(q[h.tieName]={}),c=q[h.tieName],c[a.name]||(c[a.name]={}),e=c[a.name],e[i]||(e[i]=[]),f=e[i],f.indexOf(b)<0&&(f.push(b),g(b,a.name),d(b),s++)});for(var c in b.dataset)0!==c.indexOf("tie")||a.DataTier.rules.get(c)||(r[c]||(r[c]=[]),r[c].push(b))}}function g(c,d){var e,f,g,h;e=a.DataTier.rules.get(d),f=e.parseParam(c.dataset[d]),g=a.DataTier.ties.get(f.tieName),g&&(h=b(g.data,f.dataPath),e.dataToView(h,c))}function h(a){var b;a&&a.nodeType&&(a.nodeType===Element.DOCUMENT_NODE||a.nodeType===Element.ELEMENT_NODE)&&(b=b="IFRAME"===a.nodeName?Array.prototype.slice.call(a.contentDocument.getElementsByTagName("*"),0):Array.prototype.slice.call(a.getElementsByTagName("*"),0),b.push(a),b.forEach(f),console.info("collected views, current total: "+s))}function i(a){var b,c,d,f;a&&a.getElementsByTagName&&(b=Array.prototype.slice.call(a.getElementsByTagName("*"),0),b.push(a),b.forEach(function(a){p.rules.getApplicable(a).forEach(function(b){c=b.parseParam(a.dataset[b.name]),d=q[c.tieName][b.name][c.dataPath.join(".")],f=d.indexOf(a),f>=0&&(d.splice(f,1),e(a),s--)})}),console.info("discarded views, current total: "+s))}function j(b,c,d,e){var f,h,i=-1;f=a.DataTier.rules.get(c).parseParam(d),q[f.tieName]&&q[f.tieName][c]&&(h=q[f.tieName][c][f.dataPath],h&&(i=h.indexOf(b)),i>=0&&h.splice(i,1)),f=a.DataTier.rules.get(c).parseParam(e),q[f.tieName]||(q[f.tieName]={}),q[f.tieName][c]||(q[f.tieName][c]={}),q[f.tieName][c][f.dataPath]||(q[f.tieName][c][f.dataPath]=[]),q[f.tieName][c][f.dataPath].push(b),g(b,c)}function k(a,b){var c,d,e=q[a];b.forEach(function(a){d=a.path.join("."),Object.keys(e).forEach(function(a){c=e[a],c&&Object.keys(c).forEach(function(b){0===b.indexOf(d)&&c[b].forEach(function(b){g(b,a)})})})})}function l(a){var b,c=2,d=a.split("-");for(b=d[1];c<d.length;)b+=d[c][0].toUpperCase()+d[c++].substr(1);return b}function m(a){function b(a){a.forEach(function(a){var b,c,d=a.type,e=a.target,f=a.attributeName;if("attributes"===d&&0===f.indexOf("data-tie"))j(e,l(f),a.oldValue,e.getAttribute(f));else if("attributes"===d&&"src"===f&&"IFRAME"===e.nodeName)i(e.contentDocument);else if("childList"===d){if(a.addedNodes.length)for(b=0,c=a.addedNodes.length;b<c;b++)"IFRAME"===a.addedNodes[b].nodeName?(a.addedNodes[b].contentDocument&&(m(a.addedNodes[b].contentDocument),h(a.addedNodes[b].contentDocument)),a.addedNodes[b].addEventListener("load",function(){m(this.contentDocument),h(this.contentDocument)})):h(a.addedNodes[b]);if(a.removedNodes.length)for(b=0,c=a.removedNodes.length;b<c;b++)i("IFRAME"===a.removedNodes[b].nodeName?a.removedNodes[b].contentDocument:a.removedNodes[b])}})}var c=new MutationObserver(b);c.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!1,characterDataOldValue:!1})}function n(){m(document),h(document)}function o(a){p=a,p.views={},Reflect.defineProperty(p.views,"init",{value:n}),Reflect.defineProperty(p.views,"processChanges",{value:k})}a.DataTier||Reflect.defineProperty(a,"DataTier",{value:{}});var p,q={},r={},s=0;Reflect.defineProperty(a.DataTier,"ViewsService",{value:o})}(this),function(a){"use strict";var b={};if("object"!=typeof a.DataTier)throw new Error('DataTier initialization faile: "DataTier" namespace not found');if("function"!=typeof a.DataTier.TiesService)throw new Error('DataTier initialization failed: "TiesService" not found');if("function"!=typeof a.DataTier.ViewsService)throw new Error('DataTier initialization failed: "ViewsService" not found');if("function"!=typeof a.DataTier.RulesService)throw new Error('DataTier initialization failed: "RulesService" not found');Reflect.defineProperty(a.DataTier,"ties",{value:new a.DataTier.TiesService(b)}),Reflect.defineProperty(a.DataTier,"rules",{value:new a.DataTier.RulesService(b)}),Reflect.defineProperty(a.DataTier,"views",{value:new a.DataTier.ViewsService(b)}),a.DataTier.initVanillaRules(b),b.views.init()}(this);