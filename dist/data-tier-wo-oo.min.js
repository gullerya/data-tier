(()=>{"use strict";function e(e,r,o){let i;Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"data",{get:function(){return i},set:function(n){let r=i,o=t(n);i&&i.revoke(),(i=o)&&i.observe(function(t){a.DataTier.views.processChanges(e,t)}),a.DataTier.views.processChanges(e,[{type:"update",value:i,oldValue:r,path:[]}])}}),n[e]=this,this.data=r}function t(e){if(void 0===e||null===e)return e;if("object"!=typeof e)throw new Error(e+" is not of type Observable and not an object");if("function"==typeof e.observe&&"function"==typeof e.unobserve&&"function"==typeof e.revoke)return e;if(a.Observable){if("function"==typeof e.observe||"function"==typeof e.unobserve||"function"==typeof e.revoke)throw new Error(e+" is not of type Observable and can not be transformed into Observable (some of its functions already implemented?)");return a.Observable.from(e)}throw new Error(e+" is not of type Observable and no embedded Observable implementation found")}const a=this||window,n={};e.prototype.viewToDataProcessor=function(e){!function(e,t,a){let n;if(e){for(n=0;n<t.length-1;n++)e=t[n]in e?e[t[n]]:{};e[t[n]]=a}}(e.data,e.path,e.view.value)},Reflect.defineProperty(a,"DataTier",{value:{}}),Reflect.defineProperty(a.DataTier,"ties",{value:{get get(){return function(e){return n[e]}},get create(){return function(a,r,o){if(function(e){if(!e||"string"!=typeof e)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(e))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}(a),n[a])throw new Error("existing tie ("+a+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new e(a,t(r),o)}},get remove(){return function(e){e&&n[e]&&(n[e].observable.revoke(),delete n[e])}}}})})(),(()=>{"use strict";function e(e,t){Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"dataToView",{value:t.dataToView}),"function"==typeof t.inputToData&&Reflect.defineProperty(this,"inputToData",{value:t.inputToData}),"function"==typeof t.parseParam&&Reflect.defineProperty(this,"parseParam",{value:t.parseParam}),"function"==typeof t.isChangedPathRelevant&&Reflect.defineProperty(this,"isChangedPathRelevant",{value:t.isChangedPathRelevant})}const t=this||window,a={};if(!t.DataTier)throw new Error("DataTier framework was not properly initialized");e.prototype.parseParam=function(e){let t="",a=[];return e&&(t=(a=e.trim().split(".")).shift()),{tieName:t,dataPath:a}},e.prototype.isChangedPathRelevant=function(e,t){return t.startsWith(e)},Reflect.defineProperty(t.DataTier,"controllers",{value:{get get(){return function(e){return a[e]}},get add(){return function(n,r){if("string"!=typeof n||!n)throw new Error("name MUST be a non-empty string");if(a[n])throw new Error('controller "'+n+'" already exists; you may want to reconfigure the existing controller');if("object"!=typeof r||!r)throw new Error("configuration MUST be a non-null object");if("function"!=typeof r.dataToView)throw new Error('configuration MUST have a "dataToView" function defined');a[n]=new e(n,r),t.DataTier.views.applyController(a[n])}},get remove(){return function(e){if("string"!=typeof e||!e)throw new Error("controller name MUST be a non-empty string");return delete a[e]}},get getApplicable(){return function(e){let t=[];return e&&e.dataset&&Object.keys(e.dataset).filter(e=>e in a).map(e=>a[e]).forEach(e=>t.push(e)),t}}}})})(),(()=>{"use strict";function e(e){l.getApplicable(e.target).forEach(t=>{if("tieValue"===t.name){let a=t.parseParam(e.target.dataset[t.name]),n=s.get(a.tieName);if(!a.dataPath)return void console.error("path to data not available");if(!n)return void console.error('tie "'+a.tieName+'" not found');n.viewToDataProcessor({data:n.data,path:a.dataPath,view:e.target})}})}function t(t){"IFRAME"===t.nodeName?(o(t.contentDocument),t.addEventListener("load",function(){o(this.contentDocument),n(this.contentDocument)}),n(t.contentDocument)):t.dataset&&Object.keys(t.dataset).forEach(n=>{if(n.startsWith("tie")){let r=l.get(n);if(r){let n,o,i,s=r.parseParam(t.dataset[r.name]),l=s.dataPath.join(".");c[s.tieName]||(c[s.tieName]={}),(n=c[s.tieName])[r.name]||(n[r.name]={}),(o=n[r.name])[l]||(o[l]=[]),(i=o[l]).indexOf(t)<0&&(i.push(t),a(t,r.name),function(t){"INPUT"!==t.nodeName&&"SELECT"!==t.nodeName||t.addEventListener("change",e)}(t))}else f[n]||(f[n]=[]),f[n].push(t)}})}function a(e,t){let a,n,r,o;n=(a=l.get(t)).parseParam(e.dataset[t]),(r=s.get(n.tieName))&&(o=function(e,t){let a;if(e){for(a=0;a<t.length;a++){if(!(t[a]in e))return;e=e[t[a]]}return e}}(r.data,n.dataPath),a.dataToView(o,e))}function n(e){if(e&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.ELEMENT_NODE)){let a;(a="IFRAME"===e.nodeName?Array.from(e.contentDocument.getElementsByTagName("*")):Array.from(e.getElementsByTagName("*"))).push(e),a.forEach(t)}}function r(t){let a,n,r,o;t&&t.getElementsByTagName&&((a=Array.from(t.getElementsByTagName("*"))).push(t),a.forEach(t=>{l.getApplicable(t).forEach(a=>{n=a.parseParam(t.dataset[a.name]),r=c[n.tieName][a.name][n.dataPath.join(".")],(o=r.indexOf(t))>=0&&(r.splice(o,1),function(t){t.removeEventListener("change",e)}(t))})}))}function o(e){new MutationObserver(function(e){e.forEach(e=>{if("attributes"===e.type){let t=e.target,n=e.attributeName;0===n.indexOf("data-tie")?function(e,t,n,r){let o,i,s=-1;o=l.get(t).parseParam(n),c[o.tieName]&&c[o.tieName][t]&&((i=c[o.tieName][t][o.dataPath])&&(s=i.indexOf(e)),s>=0&&i.splice(s,1)),o=l.get(t).parseParam(r),c[o.tieName]||(c[o.tieName]={}),c[o.tieName][t]||(c[o.tieName][t]={}),c[o.tieName][t][o.dataPath]||(c[o.tieName][t][o.dataPath]=[]),c[o.tieName][t][o.dataPath].push(e),a(e,t)}(t,function(e){let t,a=2,r=n.split("-");for(t=r[1];a<r.length;)t+=r[a][0].toUpperCase()+r[a++].substr(1);return t}(),e.oldValue,t.getAttribute(n)):"src"===n&&"IFRAME"===t.nodeName&&r(t.contentDocument)}else"childList"===e.type&&(Array.from(e.addedNodes).forEach(e=>{"IFRAME"===e.nodeName?(e.contentDocument&&(o(e.contentDocument),n(e.contentDocument)),e.addEventListener("load",function(){o(this.contentDocument),n(this.contentDocument)})):n(e)}),Array.from(e.removedNodes).forEach(e=>{r("IFRAME"===e.nodeName?e.contentDocument:e)}))})}).observe(e,{childList:!0,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!0,characterDataOldValue:!1})}const i=this||window;if(!i.DataTier)throw new Error("DataTier framework was not properly initialized");const s=i.DataTier.ties,l=i.DataTier.controllers,c={},f={};Reflect.defineProperty(i.DataTier,"views",{value:{get processChanges(){return function(e,t){let n,r,o,i=c[e];i&&t.forEach(e=>{o=e.path.join("."),Object.keys(i).forEach(e=>{(r=i[e])&&(n=l.get(e),Object.keys(r).forEach(t=>{n.isChangedPathRelevant(o,t)&&r[t].forEach(t=>{a(t,e)})}))})})}},get applyController(){return function(e){f[e.name]&&(f[e.name].forEach(t),delete f[e.name])}}}}),o(document),n(document)})(),(()=>{"use strict";const e=this||window,t=e.DataTier.controllers.add;if(!e.DataTier)throw new Error("DataTier framework was not properly initialized");t("tieValue",{dataToView:function(e,t){"checkbox"===t.type?t.checked=e:t.value=void 0!==e&&null!==e?e:""}}),t("tieText",{dataToView:function(e,t){t.textContent=void 0!==e&&null!==e?e:""}}),t("tiePlaceholder",{dataToView:function(e,t){t.placeholder=void 0!==e&&null!==e?e:""}}),t("tieTooltip",{dataToView:function(e,t){t.title=void 0!==e&&null!==e?e:""}}),t("tieSrc",{dataToView:function(e,t){t.src=void 0!==e&&null!==e?e:""}}),t("tieHRef",{dataToView:function(e,t){t.href=void 0!==e&&null!==e?e:""}}),t("tieDateValue",{dataToView:function(e,t){t.value=void 0!==e&&null!==e?e.toLocaleString():""}}),t("tieDateText",{dataToView:function(e,t){t.textContent=void 0!==e&&null!==e?e.toLocaleString():""}}),t("tieClasses",{isChangedPathRelevant:function(e,t){let a=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===a.length||2===a.length&&""===a[0]},dataToView:function(e,t){e&&"object"==typeof e&&Object.keys(e).forEach(function(a){e[a]?t.classList.add(a):t.classList.remove(a)})}}),t("tieList",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(e,t){let a=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===a.length||2===a.length&&""===a[0]},dataToView:function(e,t){let a,n,r,o,i,s,l,c=t.parentNode;if("TEMPLATE"!==t.nodeName)throw new Error("tieList may be defined on template elements only");if(t.dataset.listSourceAid||(t.dataset.listSourceAid=(new Date).getTime()),a=function(e,t){let a=Array.from(c.querySelectorAll('[data-list-item-aid="'+t+'"]'));for(;a.length>e;)c.removeChild(a.pop());return a.length}(e?e.length:0,t.dataset.listSourceAid),e&&a<e.length)if((r=t.dataset.tieList.trim().split(/\s+/))&&3===r.length&&"=>"===r[1]){for(o=r[2],s=(i=t.ownerDocument).createDocumentFragment();a<e.length;a++){for(n=i.importNode(t.content,!0),Array.from(n.querySelectorAll("*")).forEach(e=>{Object.keys(e.dataset).forEach(t=>{let n=e.dataset[t];n.startsWith(o)&&(e.dataset[t]=n.replace(o,r[0]+"."+a))})}),s.appendChild(n),l=s.lastChild;l.nodeType!==Node.ELEMENT_NODE&&null!==l.previousSibling;)l=l.previousSibling;l.dataset.listItemAid=t.dataset.listSourceAid}c.appendChild(s)}else console.error('invalid parameter for "tieList" rule specified')}})})();