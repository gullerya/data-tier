!function(e){"use strict";function t(t,a,n){function i(a){e.DataTier.views.processChanges(t,a)}let o;Reflect.defineProperty(this,"name",{value:t}),Reflect.defineProperty(this,"data",{get:function(){return o},set:function(a){a&&(r(a),o&&o.revoke());let n=o;(o=a)&&o.observe(i),e.DataTier.views.processChanges(t,[{type:"update",value:o,oldValue:n,path:[]}])}}),c[t]=this,this.data=a}function a(e,a,n){if(i(e),a&&r(a),c[e])throw new Error("existing tie ("+e+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new t(e,a,n)}function n(e){e&&c[e]&&(c[e].observable.revoke(),delete c[e])}function i(e){if(!e||"string"!=typeof e)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(e))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}function r(e){if(!e||"object"!=typeof e||"function"!=typeof e.observe||"function"!=typeof e.unobserve||"function"!=typeof e.revoke)throw new Error(e+" is not a valid Observable")}function o(e,t,a){let n;if(e){for(n=0;n<t.length-1;n++)e=e[t[n]]||{};e[t[n]]=a}}const c={};t.prototype.viewToDataProcessor=function(e){o(e.data,e.path,e.view.value)},Reflect.defineProperty(e,"DataTier",{value:{}}),Reflect.defineProperty(e.DataTier,"ties",{value:{}}),Reflect.defineProperty(e.DataTier.ties,"get",{value:function(e){return c[e]}}),Reflect.defineProperty(e.DataTier.ties,"create",{value:a}),Reflect.defineProperty(e.DataTier.ties,"remove",{value:n})}(this),function(e){"use strict";function t(e,t){Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"dataToView",{value:t.dataToView}),"function"==typeof t.inputToData&&Reflect.defineProperty(this,"inputToData",{value:t.inputToData}),"function"==typeof t.parseParam&&Reflect.defineProperty(this,"parseParam",{value:t.parseParam}),"function"==typeof t.isChangedPathRelevant&&Reflect.defineProperty(this,"isChangedPathRelevant",{value:t.isChangedPathRelevant})}function a(a,n){if("string"!=typeof a||!a)throw new Error("name MUST be a non-empty string");if(o[a])throw new Error('rule "'+a+'" already exists; you may want to reconfigure the existing rule');if("object"!=typeof n||!n)throw new Error("configuration MUST be a non-null object");if("function"!=typeof n.dataToView)throw new Error('configuration MUST have a "dataToView" function defined');o[a]=new t(a,n),e.DataTier.views.applyRule(o[a])}function n(e){return o[e]}function i(e){if("string"!=typeof e||!e)throw new Error("rule name MUST be a non-empty string");return delete o[e]}function r(e){let t=[];return e&&e.nodeType===Node.ELEMENT_NODE&&e.dataset&&Object.keys(e.dataset).forEach(function(e){o[e]&&t.push(o[e])}),t}const o={};t.prototype.parseParam=function(e){let t="",a=[];return e&&(t=(a=e.trim().split(".")).shift()),{tieName:t,dataPath:a}},t.prototype.isChangedPathRelevant=function(e,t){return 0===t.indexOf(e)},Reflect.defineProperty(e.DataTier,"rules",{value:{}}),Reflect.defineProperty(e.DataTier.rules,"get",{value:n}),Reflect.defineProperty(e.DataTier.rules,"add",{value:a}),Reflect.defineProperty(e.DataTier.rules,"remove",{value:i}),Reflect.defineProperty(e.DataTier.rules,"getApplicable",{value:r})}(this),function(e){"use strict";function t(e,t){let a;if(e){for(a=0;a<t.length;a++)if(!(e=e[t[a]]))return;return e}}function a(t){e.DataTier.rules.getApplicable(t.target).forEach(function(a){if("tieValue"===a.name){let n=a.parseParam(t.target.dataset[a.name]),i=e.DataTier.ties.get(n.tieName);if(!n.dataPath)return void console.error("path to data not available");if(!i)return void console.error('tie "'+n.tieName+'" not found');i.viewToDataProcessor({data:i.data,path:n.dataPath,view:t.target})}})}function n(e){"INPUT"!==e.nodeName&&"SELECT"!==e.nodeName||e.addEventListener("change",a)}function i(e){e.removeEventListener("change",a)}function r(t){"IFRAME"===t.nodeName?(p(t.contentDocument),t.addEventListener("load",function(){p(this.contentDocument),c(this.contentDocument)}),c(t.contentDocument)):(e.DataTier.rules.getApplicable(t).forEach(function(e){let a,i,r,c=e.parseParam(t.dataset[e.name]),s=c.dataPath.join(".");h[c.tieName]||(h[c.tieName]={}),(a=h[c.tieName])[e.name]||(a[e.name]={}),(i=a[e.name])[s]||(i[s]=[]),(r=i[s]).indexOf(t)<0&&(r.push(t),o(t,e.name),n(t))}),t.dataset&&Object.keys(t.dataset).forEach(function(a){0!==a.indexOf("tie")||e.DataTier.rules.get(a)||(m[a]||(m[a]=[]),m[a].push(t))}))}function o(a,n){let i,r,o,c;r=(i=e.DataTier.rules.get(n)).parseParam(a.dataset[n]),(o=e.DataTier.ties.get(r.tieName))&&(c=t(o.data,r.dataPath),i.dataToView(c,a))}function c(e){let t;e&&e.nodeType&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.ELEMENT_NODE)&&((t=t="IFRAME"===e.nodeName?Array.from(e.contentDocument.getElementsByTagName("*")):Array.from(e.getElementsByTagName("*"))).push(e),t.forEach(r))}function s(t){let a,n,r,o;t&&t.getElementsByTagName&&((a=Array.from(t.getElementsByTagName("*"))).push(t),a.forEach(function(t){e.DataTier.rules.getApplicable(t).forEach(function(e){n=e.parseParam(t.dataset[e.name]),r=h[n.tieName][e.name][n.dataPath.join(".")],(o=r.indexOf(t))>=0&&(r.splice(o,1),i(t))})}))}function u(t,a,n,i){let r,c,s=-1;r=e.DataTier.rules.get(a).parseParam(n),h[r.tieName]&&h[r.tieName][a]&&((c=h[r.tieName][a][r.dataPath])&&(s=c.indexOf(t)),s>=0&&c.splice(s,1)),r=e.DataTier.rules.get(a).parseParam(i),h[r.tieName]||(h[r.tieName]={}),h[r.tieName][a]||(h[r.tieName][a]={}),h[r.tieName][a][r.dataPath]||(h[r.tieName][a][r.dataPath]=[]),h[r.tieName][a][r.dataPath].push(t),o(t,a)}function f(t,a){let n,i,r,c=h[t];c&&a.forEach(function(t){r=t.path.join("."),Object.keys(c).forEach(function(t){(i=c[t])&&(n=e.DataTier.rules.get(t),Object.keys(i).forEach(function(e){n.isChangedPathRelevant(r,e)&&i[e].forEach(function(e){o(e,t)})}))})})}function l(e){m[e.name]&&(m[e.name].forEach(function(e){r(e)}),delete m[e.name])}function d(e){let t,a=2,n=e.split("-");for(t=n[1];a<n.length;)t+=n[a][0].toUpperCase()+n[a++].substr(1);return t}function p(e){function t(e){e.forEach(function(e){let t=e.target,a=e.attributeName;"attributes"===e.type&&0===a.indexOf("data-tie")?u(t,d(a),e.oldValue,t.getAttribute(a)):"attributes"===e.type&&"src"===a&&"IFRAME"===t.nodeName?s(t.contentDocument):"childList"===e.type&&(Array.from(e.addedNodes).forEach(function(e){"IFRAME"===e.nodeName?(e.contentDocument&&(p(e.contentDocument),c(e.contentDocument)),e.addEventListener("load",function(){p(this.contentDocument),c(this.contentDocument)})):c(e)}),Array.from(e.removedNodes).forEach(function(e){s("IFRAME"===e.nodeName?e.contentDocument:e)}))})}new MutationObserver(t).observe(e,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!1,characterDataOldValue:!1})}const h={},m={};Reflect.defineProperty(e.DataTier,"views",{value:{}}),Reflect.defineProperty(e.DataTier.views,"processChanges",{value:f}),Reflect.defineProperty(e.DataTier.views,"applyRule",{value:l}),p(document),c(document)}(this),function(e){"use strict";const t=e.DataTier.rules.add;t("tieValue",{dataToView:function(e,t){"checkbox"===t.type?t.checked=e:t.value=e||""}}),t("tieText",{dataToView:function(e,t){t.textContent=e?e.toString():""}}),t("tiePlaceholder",{dataToView:function(e,t){t.placeholder=e||""}}),t("tieTooltip",{dataToView:function(e,t){t.title=e||""}}),t("tieSrc",{dataToView:function(e,t){t.src=e||""}}),t("tieHRef",{dataToView:function(e,t){t.href=e||""}}),t("tieDateValue",{dataToView:function(e,t){t.value=e?e.toLocaleString():""}}),t("tieDateText",{dataToView:function(e,t){t.textContent=e?e.toLocaleString():""}}),t("tieClasses",{isChangedPathRelevant:function(e,t){let a=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===a.length||2===a.length&&""===a[0]},dataToView:function(e,t){e&&"object"==typeof e&&Object.keys(e).forEach(function(a){e[a]?t.classList.add(a):t.classList.remove(a)})}}),t("tieList",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(e,t){let a=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===a.length||2===a.length&&""===a[0]},dataToView:function(e,t){let a,n,i,r,o,c,s,u,f=t.parentNode;if("TEMPLATE"!==t.nodeName)throw new Error("tieList may be defined on template elements only");if(t.dataset.listSourceAid||(t.dataset.listSourceAid=(new Date).getTime()),a=function(e,t){let a=Array.from(f.querySelectorAll('[data-list-item-aid="'+t+'"]'));for(;a.length>e;)f.removeChild(a.pop());return a.length}(e?e.length:0,t.dataset.listSourceAid),e&&a<e.length)if((i=t.dataset.tieList.trim().split(/\s+/))&&3===i.length&&"=>"===i[1]){for(r=i[2],s=(c=t.ownerDocument).createDocumentFragment();a<e.length;a++){for(n=c.importNode(t.content,!0),(o=Array.prototype.slice.call(n.querySelectorAll("*"),0)).forEach(function(e){Object.keys(e.dataset).forEach(function(t){0===e.dataset[t].indexOf(r)&&(e.dataset[t]=e.dataset[t].replace(r,i[0]+"."+a))})}),s.appendChild(n),u=s.lastChild;u.nodeType!==Node.ELEMENT_NODE&&null!==u.previousSibling;)u=u.previousSibling;u.dataset.listItemAid=t.dataset.listSourceAid}f.appendChild(s)}else console.error('invalid parameter for "tieList" rule specified')}})}(this);