(()=>{"use strict";function e(e,t,n){function a(t){r.DataTier.views.processChanges(e,t)}let i;Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"data",{get:function(){return i},set:function(t){t&&(o(t),i&&i.revoke());let n=i;(i=t)&&i.observe(a),r.DataTier.views.processChanges(e,[{type:"update",value:i,oldValue:n,path:[]}])}}),c[e]=this,this.data=t}function t(t,n,i){if(a(t),n&&o(n),c[t])throw new Error("existing tie ("+t+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new e(t,n,i)}function n(e){e&&c[e]&&(c[e].observable.revoke(),delete c[e])}function a(e){if(!e||"string"!=typeof e)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(e))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}function o(e){if(!e||"object"!=typeof e||"function"!=typeof e.observe||"function"!=typeof e.unobserve||"function"!=typeof e.revoke)throw new Error(e+" is not a valid Observable")}function i(e,t,n){let a;if(e){for(a=0;a<t.length-1;a++)e=e[t[a]]||{};e[t[a]]=n}}const r=this||window,c={};e.prototype.viewToDataProcessor=function(e){i(e.data,e.path,e.view.value)};Reflect.defineProperty(r,"DataTier",{value:{}});Reflect.defineProperty(r.DataTier,"ties",{value:{get get(){return function(e){return c[e]}},get create(){return t},get remove(){return n}}})})(),(()=>{"use strict";function e(e,t){Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"dataToView",{value:t.dataToView}),"function"==typeof t.inputToData&&Reflect.defineProperty(this,"inputToData",{value:t.inputToData}),"function"==typeof t.parseParam&&Reflect.defineProperty(this,"parseParam",{value:t.parseParam}),"function"==typeof t.isChangedPathRelevant&&Reflect.defineProperty(this,"isChangedPathRelevant",{value:t.isChangedPathRelevant})}function t(t,n){if("string"!=typeof t||!t)throw new Error("name MUST be a non-empty string");if(r[t])throw new Error('controller "'+t+'" already exists; you may want to reconfigure the existing controller');if("object"!=typeof n||!n)throw new Error("configuration MUST be a non-null object");if("function"!=typeof n.dataToView)throw new Error('configuration MUST have a "dataToView" function defined');r[t]=new e(t,n),i.DataTier.views.applyController(r[t])}function n(e){return r[e]}function a(e){if("string"!=typeof e||!e)throw new Error("controller name MUST be a non-empty string");return delete r[e]}function o(e){let t=[];return e&&e.dataset&&Object.keys(e.dataset).filter(e=>e in r).map(e=>r[e]).forEach(e=>t.push(e)),t}const i=this||window,r={};if(!i.DataTier)throw new Error("DataTier framework was not properly initialized");e.prototype.parseParam=function(e){let t="",n=[];return e&&(t=(n=e.trim().split(".")).shift()),{tieName:t,dataPath:n}};e.prototype.isChangedPathRelevant=function(e,t){return t.startsWith(e)};Reflect.defineProperty(i.DataTier,"controllers",{value:{get get(){return n},get add(){return t},get remove(){return a},get getApplicable(){return o}}})})(),(()=>{"use strict";function e(e,t){let n;if(e){for(n=0;n<t.length;n++)if(!(e=e[t[n]]))return;return e}}function t(e){m.getApplicable(e.target).forEach(t=>{if("tieValue"===t.name){let n=t.parseParam(e.target.dataset[t.name]),a=p.get(n.tieName);if(!n.dataPath)return void console.error("path to data not available");if(!a)return void console.error('tie "'+n.tieName+'" not found');a.viewToDataProcessor({data:a.data,path:n.dataPath,view:e.target})}})}function n(e){"INPUT"!==e.nodeName&&"SELECT"!==e.nodeName||e.addEventListener("change",t)}function a(e){e.removeEventListener("change",t)}function o(e){"IFRAME"===e.nodeName?(d(e.contentDocument),e.addEventListener("load",function(){d(this.contentDocument),r(this.contentDocument)}),r(e.contentDocument)):e.dataset&&Object.keys(e.dataset).forEach(t=>{if(t.startsWith("tie")){let a=m.get(t);if(a){let t,o,r,c=a.parseParam(e.dataset[a.name]),s=c.dataPath.join(".");g[c.tieName]||(g[c.tieName]={}),(t=g[c.tieName])[a.name]||(t[a.name]={}),(o=t[a.name])[s]||(o[s]=[]),(r=o[s]).indexOf(e)<0&&(r.push(e),i(e,a.name),n(e))}else w[t]||(w[t]=[]),w[t].push(e)}})}function i(t,n){let a,o,i,r;o=(a=m.get(n)).parseParam(t.dataset[n]),(i=p.get(o.tieName))&&(r=e(i.data,o.dataPath),a.dataToView(r,t))}function r(e){if(e&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.ELEMENT_NODE)){let t;(t="IFRAME"===e.nodeName?Array.from(e.contentDocument.getElementsByTagName("*")):Array.from(e.getElementsByTagName("*"))).push(e),t.forEach(o)}}function c(e){let t,n,o,i;e&&e.getElementsByTagName&&((t=Array.from(e.getElementsByTagName("*"))).push(e),t.forEach(e=>{m.getApplicable(e).forEach(t=>{n=t.parseParam(e.dataset[t.name]);o=g[n.tieName][t.name][n.dataPath.join(".")];i=o.indexOf(e);i>=0&&(o.splice(i,1),a(e))})}))}function s(e,t,n,a){let o,r,c=-1;o=m.get(t).parseParam(n),g[o.tieName]&&g[o.tieName][t]&&((r=g[o.tieName][t][o.dataPath])&&(c=r.indexOf(e)),c>=0&&r.splice(c,1)),o=m.get(t).parseParam(a),g[o.tieName]||(g[o.tieName]={}),g[o.tieName][t]||(g[o.tieName][t]={}),g[o.tieName][t][o.dataPath]||(g[o.tieName][t][o.dataPath]=[]),g[o.tieName][t][o.dataPath].push(e),i(e,t)}function f(e,t){let n,a,o,r=g[e];r&&t.forEach(function(e){o=e.path.join("."),Object.keys(r).forEach(e=>{a=r[e];a&&(n=m.get(e),Object.keys(a).forEach(t=>{n.isChangedPathRelevant(o,t)&&a[t].forEach(t=>{i(t,e)})}))})})}function u(e){w[e.name]&&(w[e.name].forEach(o),delete w[e.name])}function l(e){let t,n=2,a=e.split("-");for(t=a[1];n<a.length;)t+=a[n][0].toUpperCase()+a[n++].substr(1);return t}function d(e){function t(e){e.forEach(e=>{if("attributes"===e.type){let t=e.target,n=e.attributeName;0===n.indexOf("data-tie")?s(t,l(n),e.oldValue,t.getAttribute(n)):"src"===n&&"IFRAME"===t.nodeName&&c(t.contentDocument)}else"childList"===e.type&&(Array.from(e.addedNodes).forEach(e=>{"IFRAME"===e.nodeName?(e.contentDocument&&(d(e.contentDocument),r(e.contentDocument)),e.addEventListener("load",function(){d(this.contentDocument),r(this.contentDocument)})):r(e)}),Array.from(e.removedNodes).forEach(e=>{c("IFRAME"===e.nodeName?e.contentDocument:e)}))})}new MutationObserver(t).observe(e,{childList:!0,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!0,characterDataOldValue:!1})}const h=this||window;if(!h.DataTier)throw new Error("DataTier framework was not properly initialized");const p=h.DataTier.ties,m=h.DataTier.controllers,g={},w={};Reflect.defineProperty(h.DataTier,"views",{value:{get processChanges(){return f},get applyController(){return u}}});d(document);r(document)})(),(()=>{"use strict";const e=this||window,t=e.DataTier.controllers.add;if(!e.DataTier)throw new Error("DataTier framework was not properly initialized");t("tieValue",{dataToView:function(e,t){"checkbox"===t.type?t.checked=e:t.value=e||""}});t("tieText",{dataToView:function(e,t){t.textContent=e||""}});t("tiePlaceholder",{dataToView:function(e,t){t.placeholder=e||""}});t("tieTooltip",{dataToView:function(e,t){t.title=e||""}});t("tieSrc",{dataToView:function(e,t){t.src=e||""}});t("tieHRef",{dataToView:function(e,t){t.href=e||""}});t("tieDateValue",{dataToView:function(e,t){t.value=e?e.toLocaleString():""}});t("tieDateText",{dataToView:function(e,t){t.textContent=e?e.toLocaleString():""}});t("tieClasses",{isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},dataToView:function(e,t){e&&"object"==typeof e&&Object.keys(e).forEach(function(n){e[n]?t.classList.add(n):t.classList.remove(n)})}});t("tieList",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},dataToView:function(e,t){let n,a,o,i,r,c,s,f=t.parentNode;if("TEMPLATE"!==t.nodeName)throw new Error("tieList may be defined on template elements only");if(t.dataset.listSourceAid||(t.dataset.listSourceAid=(new Date).getTime()),n=function(e,t){let n=Array.from(f.querySelectorAll('[data-list-item-aid="'+t+'"]'));for(;n.length>e;)f.removeChild(n.pop());return n.length}(e?e.length:0,t.dataset.listSourceAid),e&&n<e.length)if((o=t.dataset.tieList.trim().split(/\s+/))&&3===o.length&&"=>"===o[1]){for(i=o[2],c=(r=t.ownerDocument).createDocumentFragment();n<e.length;n++){for(a=r.importNode(t.content,!0),Array.from(a.querySelectorAll("*")).forEach(e=>{Object.keys(e.dataset).forEach(t=>{let a=e.dataset[t];a.startsWith(i)&&(e.dataset[t]=a.replace(i,o[0]+"."+n))})}),c.appendChild(a),s=c.lastChild;s.nodeType!==Node.ELEMENT_NODE&&null!==s.previousSibling;)s=s.previousSibling;s.dataset.listItemAid=t.dataset.listSourceAid}f.appendChild(c)}else console.error('invalid parameter for "tieList" rule specified')}})})();