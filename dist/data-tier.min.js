!function(a){"use strict";function b(a){var b;return b=Array.isArray(a)?a.slice():Object.assign({},a)}function c(a,b){var c,d=q.get(a),e=r.get(d.root);return c="pop"===b?function(){var c,f,g;return c=a.length-1,f=Reflect.apply(a[b],a,arguments),f&&"object"==typeof f&&(f=p.get(f),q.get(f).revoke()),g=[new l(d.path.concat(c),f)],o(e.callbacks,g),f}:"push"===b?function(){var c,f,g,i=[];return c=Array.from(arguments),g=a.length,c.forEach(function(a,b){a&&"object"==typeof a&&(c[b]=new h(a,g+b,d).proxy),i.push(new j(d.path.concat(g+b),a))}),f=Reflect.apply(a[b],a,c),o(e.callbacks,i),f}:"shift"===b?function(){var c,f,g;return c=Reflect.apply(a[b],a,arguments),c&&"object"==typeof c&&(c=p.get(c),q.get(c).revoke()),a.forEach(function(a,b){a&&"object"==typeof a&&(g=q.get(p.get(a)),g?g.ownKey=b:console.error("failed to resolve proxy -> target -> observed"))}),f=[new l(d.path.concat(0),c)],o(e.callbacks,f),c}:"unshift"===b?function(){var c,f,g,i=[];c=Array.from(arguments),c.forEach(function(a,b){a&&"object"==typeof a&&(c[b]=new h(a,b,d).proxy)}),f=Reflect.apply(a[b],a,c),a.forEach(function(a,b){a&&"object"==typeof a&&(g=q.get(p.get(a)),g?g.ownKey=b:console.error("failed to resolve proxy -> target -> observed"))});for(var k=0;k<c.length;k++)i.push(new j(d.path.concat(k),a[k]));return o(e.callbacks,i),f}:"reverse"===b?function(){var c,d,f=[];return c=Reflect.apply(a[b],a,arguments),a.forEach(function(a,b){a&&"object"==typeof a&&(d=q.get(p.get(a)),d?d.ownKey=b:console.error("failed to resolve proxy -> target -> observed"))}),f.push(new m),o(e.callbacks,f),c}:"sort"===b?function(){var c,d,f=[];return c=Reflect.apply(a[b],a,arguments),a.forEach(function(a,b){a&&"object"==typeof a&&(d=q.get(p.get(a)),d?d.ownKey=b:console.error("failed to resolve proxy -> target -> observed"))}),f.push(new n),o(e.callbacks,f),c}:"fill"===b?function(){var c,f,g,i,l=[];f=arguments.length<2?0:arguments[1]<0?a.length+arguments[1]:arguments[1],g=arguments.length<3?a.length:arguments[2]<0?a.length+arguments[2]:arguments[2],i=a.slice(),c=Reflect.apply(a[b],a,arguments);for(var m=f;m<g;m++)a[m]&&"object"==typeof a[m]&&(a[m]=new h(a[m],m,d).proxy),i.hasOwnProperty(m)?(l.push(new k(d.path.concat(m),a[m],i[m]&&"object"==typeof i[m]?p.get(i[m]):i[m])),i[m]&&"object"==typeof i[m]&&q.get(p.get(i[m])).revoke()):l.push(new j(d.path.concat(m),a[m]));return o(e.callbacks,l),c}:"splice"===b?function(){var c,f,g,i,m,n,r,s=[];for(c=Array.from(arguments),c.forEach(function(a,b){b>1&&a&&"object"==typeof a&&(c[b]=new h(a,b,d).proxy)}),m=0===c.length?0:c[0]<0?a.length+c[0]:c[0],n=c.length<2?a.length-m:c[1],r=Math.max(c.length-2,0),f=Reflect.apply(a[b],a,c),a.forEach(function(a,b){a&&"object"==typeof a&&(g=q.get(p.get(a)),g?g.ownKey=b:console.error("failed to resolve proxy -> target -> observed"))}),f.forEach(function(a,b){a&&"object"==typeof a&&(f[b]=p.get(a),q.get(f[b]).revoke())}),i=0;i<n;i++)i<r?s.push(new k(d.path.concat(m+i),a[m+i],f[i])):s.push(new l(d.path.concat(m+i),f[i]));for(;i<r;i++)s.push(new j(d.path.concat(m+i),a[m+i]));return o(e.callbacks,s),f}:Reflect.get(a,b)}function d(a,b,c){var d,e,f=a.hasOwnProperty(b),g=a[b],i=q.get(a),l=r.get(i.root),m=[];return d=Reflect.set(a,b,c),l.callbacks.length&&d&&c!==g&&(e=i.path.concat(b),g&&"object"==typeof g&&(q.get(p.get(g)).revoke(),p.has(g)&&p.delete(g)),c&&"object"==typeof c&&(a[b]=new h(c,b,i).proxy),f?m.push(new k(e,c,g)):m.push(new j(e,c)),i.preventCallbacks||o(l.callbacks,m)),d}function e(a,b){var c,d,e=a[b],f=q.get(a),g=r.get(f.root),h=[];return c=Reflect.deleteProperty(a,b),g.callbacks.length&&c&&("object"==typeof e&&e&&p.has(e)&&p.delete(e),d=f.path.concat(b),h.push(new l(d,e)),f.preventCallbacks||o(g.callbacks,h)),c}function f(a,b){a.forEach(function(c,d){c&&"object"==typeof c&&(a[d]=new h(c,d,b).proxy)})}function g(a,b){Reflect.ownKeys(a).forEach(function(c){a[c]&&"object"==typeof a[c]&&(a[c]=new h(a[c],c,b).proxy)})}function h(a,i,j){var k,l;if(!a||"object"!=typeof a)throw new Error("Observed MUST be created from a non null object origin");if(j&&("undefined"==typeof i||null===i))throw new Error("any non-root (parent-less) Observed MUST have an own path; now parent is "+j+"; key is "+i);if(j&&!(j instanceof h))throw new Error("parent, when supplied, MUST be an instance of Observed");k=b(a),Array.isArray(k)?(f(k,this),l=Proxy.revocable(k,{set:d,get:c,deleteProperty:e})):(g(k,this),l=Proxy.revocable(k,{set:d,deleteProperty:e})),q.set(k,this),p.set(l.proxy,k),Reflect.defineProperty(this,"revokable",{value:l}),Reflect.defineProperty(this,"proxy",{value:l.proxy}),Reflect.defineProperty(this,"parent",{value:j}),Reflect.defineProperty(this,"ownKey",{value:i,writable:!0})}function i(a){function b(a){if(e)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof a)throw new Error("observer (callback) parameter MUST be a function");f.indexOf(a)<0?f.push(a):console.info("observer (callback) may be bound to an observable only once")}function c(){if(e)throw new TypeError("revoked Observable MAY NOT be unobserved amymore");arguments.length?Array.from(arguments).forEach(function(a){var b=f.indexOf(a);b>=0&&f.splice(b,1)}):f.splice(0,f.length)}function d(){e?console.log("revokation of Observable have an effect only once"):(e=!0,a.revoke())}var e=!1,f=[];Reflect.defineProperty(a.proxy,"observe",{value:b}),Reflect.defineProperty(a.proxy,"unobserve",{value:c}),Reflect.defineProperty(a.proxy,"revoke",{value:d}),Reflect.defineProperty(this,"callbacks",{value:f})}function j(a,b){Reflect.defineProperty(this,"type",{value:"insert"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"value",{value:b})}function k(a,b,c){Reflect.defineProperty(this,"type",{value:"update"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"value",{value:b}),Reflect.defineProperty(this,"oldValue",{value:c})}function l(a,b){Reflect.defineProperty(this,"type",{value:"delete"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"oldValue",{value:b})}function m(){Reflect.defineProperty(this,"type",{value:"reverse"})}function n(){Reflect.defineProperty(this,"type",{value:"shuffle"})}function o(a,b){for(var c=0;c<a.length;c++)try{a[c](b)}catch(a){console.error(a)}}var p=new WeakMap,q=new WeakMap,r=new WeakMap;Reflect.defineProperty(h.prototype,"root",{get:function(){for(var a=this;a.parent;)a=a.parent;return a}}),Reflect.defineProperty(h.prototype,"path",{get:function(){for(var a=[],b=this;"undefined"!=typeof b.ownKey;)a.push(b.ownKey),b=b.parent;return a.reverse()}}),Reflect.defineProperty(h.prototype,"revoke",{value:function(){var a=this.proxy;Reflect.ownKeys(a).forEach(function(b){var c=a[b];c&&"object"==typeof c&&(q.get(p.get(c)).revoke(),p.get(a)[b]=p.get(c))}),this.revokable.revoke()}}),Reflect.defineProperty(i,"from",{value:function(a){if(!a||"object"!=typeof a)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in a||"unobserve"in a||"revoke"in a)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');var b=new h(a),c=new i(b);return r.set(b,c),b.proxy}}),Reflect.defineProperty(a,"Observable",{value:i})}(this),function(a){"use strict";function b(a,b,c){function d(b){h.views.processChanges(a,b)}var e;Reflect.defineProperty(this,"name",{value:a}),Reflect.defineProperty(this,"data",{get:function(){return e},set:function(a){f(a),e&&e.revoke(),e=a,e.observe(d)}}),this.data=b}function c(a,c,d){if(e(a),f(c),i[a])throw new Error("existing tie ("+a+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return i[a]=new b(a,c,d)}function d(a){a&&i[a]&&(i[a].observable.revoke(),delete i[a])}function e(a){if(!a||"string"!=typeof a)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(a))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}function f(a){if(!a||"object"!=typeof a||"function"!=typeof a.observe||"function"!=typeof a.unobserve||"function"!=typeof a.revoke)throw new Error(a+" is not a valid Observable")}function g(a){h=a,Reflect.defineProperty(this,"get",{value:function(a){return i[a]}}),Reflect.defineProperty(this,"create",{value:c}),Reflect.defineProperty(this,"remove",{value:d})}var h,i={};a.DataTier||Reflect.defineProperty(a,"DataTier",{value:{}}),Reflect.defineProperty(a.DataTier,"TiesService",{value:g})}(this),function(a){"use strict";function b(a,b,c){var d,e=b.split(".");for(d=0;d<e.length-1;d++)if("object"==typeof a[e[d]])a=a[e[d]];else{if(e[d]in a)throw new Error("the path is unavailable");a=a[e[d]]={}}a[e[d]]=c}function c(a,b){var c,d;if(a){for(c=b.split("."),d=0;d<c.length;d++)if(a=a[c[d]],!a)return;return a}}function d(a){var b,c,d,e=a.target;return(b=e.dataset.tieValue?e.dataset.tieValue:e.dataset.tie)?(b=b.split("."))?(c=b.shift(),(d=p.ties.obtain(c))?void d.viewToDataProcessor({data:d.data,path:b,view:e}):void console.error('tie "'+c+'" not found')):void console.error("path to data is invalid"):void console.error("path to data not available")}function e(a){var b=a.ownerDocument.defaultView;(a instanceof b.HTMLInputElement||a instanceof b.HTMLSelectElement)&&a.addEventListener("change",d)}function f(a){a.removeEventListener("change",d)}function g(a){var d;"IFRAME"===a.nodeName?(initDocumentObserver(a.contentDocument),a.addEventListener("load",function(){initDocumentObserver(this.contentDocument),j(this.contentDocument)}),j(a.contentDocument)):p.rules.getApplicable(a).forEach(function(f){var g=f.parseValue(a).dataPath;g.push(q),d=c(r,g),d||b(r,g,d=[]),d.indexOf(a)<0&&(d.push(a),g.pop(),i(a,f.name),e(a),t++)})}function h(a){var b,d=Array.isArray(d)?d:d.split("."),e=[];return b=c(r,d),b&&Object.keys(b).forEach(function(c){c===q?Array.prototype.push.apply(e,b[c]):Array.prototype.push.apply(e,h(a+"."+c))}),e}function i(b,d){var e,f,g,h;e=a.DataTier.rules.get(d),f=e.parseValue(b).dataPath,g=a.DataTier.ties.get(f.shift()),g&&e&&(h=c(g.data,f),e.dataToView(h,b))}function j(a){var b;a&&a.nodeType&&(a.nodeType===Element.DOCUMENT_NODE||a.nodeType===Element.ELEMENT_NODE)&&(b=b="IFRAME"===a.nodeName?Array.prototype.slice.call(a.contentDocument.getElementsByTagName("*"),0):Array.prototype.slice.call(a.getElementsByTagName("*"),0),b.push(a),b.forEach(g),console.info("collected views, current total: "+t))}function k(a){s[a.id]&&s[a.id].forEach(g),console.info("relocated views, current total: "+t)}function l(b){var d,e,g,h,i,j;b&&b.getElementsByTagName&&(d=Array.prototype.slice.call(b.getElementsByTagName("*"),0),d.push(b),d.forEach(function(b){for(e in b.dataset)j=-1,0===e.indexOf("tie")&&(g=a.DataTier.rules.get(e),h=g.parseValue(b).dataPath,h.push(q),i=c(r,h),j=i&&i.indexOf(b),j>=0&&(i.splice(j,1),f(b),t--))}),console.info("discarded views, current total: "+t))}function m(a,d,e,f){var g,h,j,k=-1;e&&(h=e.split("."),h.push(q),g=c(r,h),g&&(k=g.indexOf(a)),k>=0&&g.splice(k,1)),j=f.split("."),j.push(q),c(r,j)||b(r,j,[]),c(r,j).push(a),j.pop(),i(a,d)}function n(a,b){console.log(a,b),b.forEach(function(a){})}function o(a){p=a,p.views={},Reflect.defineProperty(p.views,"collect",{value:j}),Reflect.defineProperty(p.views,"processChanges",{value:n}),Reflect.defineProperty(p.views,"relocateByRule",{value:k}),Reflect.defineProperty(p.views,"discard",{value:l}),Reflect.defineProperty(p.views,"move",{value:m}),Reflect.defineProperty(p.views,"get",{value:h})}a.DataTier||Reflect.defineProperty(a,"DataTier",{value:{}});var p,q="___vs___",r={},s={},t=0;Reflect.defineProperty(a.DataTier,"ViewsService",{value:o})}(this),function(a){"use strict";function b(a,b){if("string"!=typeof a||!a)throw new Error("name MUST be a non-empty string");if(i[a])throw new Error('rule "'+a+'" already exists; you may want to reconfigure the existing rule');if("object"!=typeof b||!b)throw new Error("options MUST be a non-null object");if("function"!=typeof b.dataToView)throw new Error('options MUST have a "dataToView" function defined');Reflect.defineProperty(this,"name",{value:a}),Reflect.defineProperty(this,"dataToView",{value:b.dataToView}),"function"==typeof b.inputToData&&Reflect.defineProperty(this,"inputToData",{value:b.inputToData}),"function"==typeof b.parseValue&&Reflect.defineProperty(this,"parseValue",{value:b.parseValue})}function c(a){if(!(a&&a instanceof b))throw new Error("rule MUST be an object of type Rule");i[a.name]=a}function d(a){return i[a]?i[a]:void console.error('rule "'+a+'" is not defined')}function e(a){if("string"!=typeof a||!a)throw new Error("rule name MUST be a non-empty string");return delete i[a]}function f(a){var b=[];return a&&a.nodeType===Node.ELEMENT_NODE&&Reflect.ownKeys(a.dataset).forEach(function(a){i[a]&&b.push(i[a])}),b}function g(a){h=a,h.rules={},Reflect.defineProperty(this,"Rule",{value:b}),Reflect.defineProperty(this,"get",{value:d}),Reflect.defineProperty(this,"add",{value:c}),Reflect.defineProperty(this,"remove",{value:e}),Reflect.defineProperty(h.rules,"getApplicable",{value:f})}var h,i={};a.DataTier||Reflect.defineProperty(a,"DataTier",{value:{}}),b.prototype.parseValue=function(a){if(a&&a.nodeType===Node.ELEMENT_NODE){var b,c,d=a.dataset[this.name];if(d)return b=d.split("."),c=b[0].split(":")[0],b[0]=b[0].replace(c+":",""),{tieName:c,dataPath:b};console.error("valid rule value MUST be non-empty string, found: "+d)}else console.error("valid DOM Element expected, received: "+a)},Reflect.defineProperty(a.DataTier,"RulesService",{value:g})}(this),function(a){"use strict";function b(b){var c=a.DataTier.rules.Rule,d=a.DataTier.rules.add;d(new c("tie",{dataToView:function(a,b){var c=["INPUT","TEXTAREA","SELECT","OPTION","PROGRESS","METER"];b&&b.nodeType===Node.ELEMENT_NODE?c.indexOf(b.tagName)>=0?b.value=a:b.textContent=a:console.error("valid element expected, found: "+b)}})),d(new c("tieValue",{dataToView:function(a,b){b.value=a}})),d(new c("tieText",{dataToView:function(a,b){b.textContent=a}})),d(new c("tiePlaceholder",{dataToView:function(a,b){b.placeholder=a}})),d(new c("tieTooltip",{dataToView:function(a,b){b.title=a}})),d(new c("tieImage",{dataToView:function(a,b){b.src=a}})),d(new c("tieDateValue",{dataToView:function(a,b){b.value=a.toLocaleString()}})),d(new c("tieDateText",{dataToView:function(a,b){b.textContent=a.toLocaleString()}})),d(new c("tieList",{parseValue:function(a){return a&&a.nodeType===Node.ELEMENT_NODE?c.prototype.parseValue(a.dataset[this.name]):void console.error("valid DOM Element expected, received: "+a)},dataToView:function(a,c){function d(a,b){for(var c=Array.from(m.querySelectorAll('[data-list-item-aid="'+b+'"]'));c.length>a;)m.removeChild(c.pop());return c.length}var e,f,g,h,i,j,k,l,m=c.parentNode;if("TEMPLATE"!==c.nodeName)throw new Error("tieList may be defined on template elements only");if(c.dataset.listSourceAid||(c.dataset.listSourceAid=(new Date).getTime()),e=d(a.data?a.data.length:0,c.dataset.listSourceAid),a.data&&e<a.data.length)if(g=c.dataset.tieList.trim().split(/\s+/),g&&3===g.length&&"=>"===g[1]){for(i=g[0],h=g[2],k=c.ownerDocument,l=k.createDocumentFragment();e<a.data.length;e++)f=k.importNode(c.content,!0),j=Array.prototype.slice.call(f.querySelectorAll("*"),0),j.forEach(function(a){Object.keys(a.dataset).forEach(function(c){0===a.dataset[c].indexOf(h+".")&&(a.dataset[c]=a.dataset[c].replace(h,i+"["+e+"]"),b.views.update(a,c))})}),l.appendChild(f),l.lastElementChild.dataset.listItemAid=c.dataset.listSourceAid;m.appendChild(l)}else console.error("invalid parameter for TieList rule specified")}}))}Reflect.defineProperty(a.DataTier,"initVanillaRules",{value:b})}(this),function(a){"use strict";function b(a){var b,c=2,d=a.split("-");for(b=d[1];c<d.length;)b+=d[c][0].toUpperCase()+d[c++].substr(1);return b}function c(a){function e(a){a.forEach(function(a){var e,f,g=a.type,h=a.target,i=a.attributeName;if("attributes"===g&&0===i.indexOf("data-tie"))d.views.move(h,b(i),a.oldValue,h.getAttribute(i));else if("attributes"===g&&"src"===i&&"IFRAME"===h.nodeName)d.views.discard(h.contentDocument);else if("childList"===g){if(a.addedNodes.length)for(e=0,f=a.addedNodes.length;e<f;e++)"IFRAME"===a.addedNodes[e].nodeName?(a.addedNodes[e].contentDocument&&(c(a.addedNodes[e].contentDocument),d.views.collect(a.addedNodes[e].contentDocument)),a.addedNodes[e].addEventListener("load",function(){c(this.contentDocument),d.views.collect(this.contentDocument)})):d.views.collect(a.addedNodes[e]);if(a.removedNodes.length)for(e=0,f=a.removedNodes.length;e<f;e++)"IFRAME"===a.removedNodes[e].nodeName?d.views.discard(a.removedNodes[e].contentDocument):d.views.discard(a.removedNodes[e])}})}var f=new MutationObserver(e);f.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!1,characterDataOldValue:!1})}var d={};if("object"!=typeof a.DataTier)throw new Error('DataTier initialization faile: "DataTier" namespace not found');if("function"!=typeof a.DataTier.TiesService)throw new Error('DataTier initialization failed: "TiesService" not found');if("function"!=typeof a.DataTier.ViewsService)throw new Error('DataTier initialization failed: "ViewsService" not found');if("function"!=typeof a.DataTier.RulesService)throw new Error('DataTier initialization failed: "RulesService" not found');Reflect.defineProperty(a.DataTier,"ties",{value:new a.DataTier.TiesService(d)}),Reflect.defineProperty(a.DataTier,"views",{value:new a.DataTier.ViewsService(d)}),Reflect.defineProperty(a.DataTier,"rules",{value:new a.DataTier.RulesService(d)}),c(document),a.DataTier.initVanillaRules(d),d.views.collect(document)}(this);