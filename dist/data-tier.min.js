!function(a){"use strict";function b(a){var b,c=2,d=a.split("-");for(b=d[1];c<d.length;)b+=d[c][0].toUpperCase()+d[c++].substr(1);return b}function c(a){if(Array.isArray(a))return a;for(var b=0,c=!1,d="",e=[];b<a.length;){if("."===a[b])d.length&&e.push(d),d="";else if("["===a[b]){if(c)throw new Error('bad path: "'+a+'", at: '+b);d.length&&e.push(d),d="",c=!0}else if("]"===a[b]){if(!c)throw new Error('bad path: "'+a+'", at: '+b);d.length&&e.push(d),d="",c=!1}else d+=a[b];b++}return d.length&&e.push(d),e}function d(a){var b,c;if("object"!=typeof a)throw new Error("object parameter expected");if(null===a)return null;if(Array.isArray(a))for(b=[],c=0;c<a.length;c++)"object"==typeof a[c]?b[c]=d(a[c]):"function"!=typeof a[c]&&(b[c]=a[c]);else b={},Object.getOwnPropertyNames(a).forEach(function(c){"object"==typeof a[c]?b[c]=d(a[c]):"function"!=typeof a[c]&&(b[c]=a[c])});return b}function e(a,b,d){var e,f=c(b);for(e=0;e<f.length-1;e++)if("object"==typeof a[f[e]])a=a[f[e]];else{if(f[e]in a)throw new Error("the path is unavailable");a=a[f[e]]={}}a[f[e]]=d}function f(a,b){var d,e;if(a){for(d=c(b),e=0;e<d.length;e++)if(a=a[d[e]],!a)return;return a}}function g(a,b){for(var d,e=c(b),f=0;f<e.length-1;f++){if(!(e[f]in a))return;a=a[e[f]]}return d=a[e[f-1]],delete a[e[f-1]],d}function h(a,b){var d,e;for(a=c(a),b=c(b),e=Math.min(a.length,b.length),d=0;e>d;d++)if(a[d]!==b[d])return!1;return!0}function i(a){var b,d,e,f=a.target;return(b=f.dataset.tieValue?f.dataset.tieValue:f.dataset.tie)?(b=c(b))?(d=b.shift(),(e=v.obtain(d))?void e.viewToDataProcessor({data:e.data,path:b,view:f}):void y.error('tie "'+d+'" not found')):void y.error("path to data is invalid"):void y.error("path to data not available")}function j(a){var b=a.ownerDocument.defaultView;(a instanceof b.HTMLInputElement||a instanceof b.HTMLSelectElement)&&a.addEventListener("change",i)}function k(a){a.removeEventListener("change",i)}function l(a){function c(a){a.forEach(function(a){var c,d,e=a.type,f=a.target,g=a.attributeName;if("attributes"===e&&0==g.indexOf("data-tie"))w.move(f,b(g),a.oldValue,f.getAttribute(g));else if("attributes"===e&&"src"===g&&"IFRAME"===f.nodeName)w.discard(f.contentDocument);else if("childList"===e){if(a.addedNodes.length)for(c=0,d=a.addedNodes.length;d>c;c++)"IFRAME"===a.addedNodes[c].nodeName?(a.addedNodes[c].contentDocument&&(l(a.addedNodes[c].contentDocument),w.collect(a.addedNodes[c].contentDocument)),a.addedNodes[c].addEventListener("load",function(){l(this.contentDocument),w.collect(this.contentDocument)})):w.collect(a.addedNodes[c]);if(a.removedNodes.length)for(c=0,d=a.removedNodes.length;d>c;c++)"IFRAME"===a.removedNodes[c].nodeName?w.discard(a.removedNodes[c].contentDocument):w.discard(a.removedNodes[c])}})}var d=new MutationObserver(c);d.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!1,characterDataOldValue:!1}),z.push(d)}function m(){z.forEach(function(a){a.disconnect()}),w.discard(document),v=null,x=null,w=null}const n="modules",o="dataTier",p="viewupdate",q="error",r="debug",s="info";var t,u,v,w,x,y;if("object"!=typeof a&&(a={}),y=new function(){function a(a){var b=[];return a=Array.from(a),a.forEach(function(a){"object"==typeof a?b.push(JSON.stringify(a)):b.push(a)}),b.join(" ")}var b=q;Object.defineProperties(this,{mode:{get:function(){return b},set:function(a){a===q||a===r||a===s?b=a:console.error('DTLogger: mode "'+a+'" is not supported')}},info:{value:function(){b!==s&&b!==q||console.info("DT: "+a(arguments))}},debug:{value:function(){b!==s&&b!==q&&b!==r||console.debug("DT: "+a(arguments))}},error:{value:function(){console.error("DT: "+a(arguments))}}})},x=new function(){function a(a){return c(a)}function b(b,c){var d,f,g;"string"==typeof c?(d=a,f=function(a,b){var d;b&&(d=b.data,d="undefined"==typeof d||null===d?"":d,e(a,c,d))},g=function(){throw new Error("not yet implemented")}):"function"==typeof c?(d=a,f=c,g=function(){throw new Error('no "inputToData" functionality defined in this rule')}):"object"==typeof c&&(d=c.resolvePath||a,f=c.dataToView,g=c.inputToData),Object.defineProperties(this,{id:{value:b},resolvePath:{value:d},dataToView:{value:f,writable:!0},inputToData:{value:g}})}var d={};Object.defineProperties(this,{add:{value:function(a,c){if(!a||!c)throw new Error("bad parameters; f(string, string|function) expected");if(0!==a.indexOf("tie"))throw new Error('rule id MUST begin with "tie"');if(a in d)throw new Error('rule with id "'+a+'" already exists');return d[a]=new b(a,c),w.relocateByRule(d[a]),d[a]}},get:{value:function(a,b){var c,e;if(0!==a.indexOf("tie"))y.error("invalid tie id supplied");else if(a in d)c=d[a];else if("tie"===a){if(e=b.ownerDocument.defaultView,!b||!b.nodeName)throw new Error('rule "'+a+'" not found, therefore valid DOM element MUST be supplied to grasp the default rule');return b instanceof e.HTMLInputElement||b instanceof e.HTMLSelectElement?d.tieValue:b instanceof e.HTMLImageElement?d.tieImage:d.tieText}return c}},del:{value:function(a){return delete d[a]}}}),Object.seal(this)},"function"!=typeof DataObserver)throw new Error("no DataObserver implementation available");t=new DataObserver,u=t.getObserved({},function(a){a&&a.forEach(function(a){var b,c,d,e,f=w.get(a.path);for(b=0,c=f.length;c>b;b++)for(d in f[b].dataset)0===d.indexOf("tie")&&(e=x.get(d,f[b]).resolvePath(f[b].dataset[d]),h(a.path,e)&&w.update(f[b],d))})}),y.info("DataObserver details: ",t.details),v=new function(){function a(a){e(a.data,a.path,a.view.value)}function b(b){var c;Object.defineProperties(this,{namespace:{get:function(){return b}},setModel:{value:function(a){if("object"!=typeof a)throw new TypeError("model MUST be an object");return u[b]=a,u[b]}},getObservedModel:{value:function(){return u[b]}},viewToDataProcessor:{get:function(){return"function"==typeof c?c:a},set:function(a){"function"==typeof a&&(c=a)}}})}function c(a){if(!a||"string"!=typeof a)throw new Error("namespace (first param) MUST be a non empty string");if(/\W/.test(a))throw new Error("namespace (first param) MUST consist of alphanumeric non uppercase characters only");return f[a]||(f[a]=new b(a)),f[a]}function d(a){f[a]&&delete f[a]}var f={};Object.defineProperties(this,{obtain:{value:c},remove:{value:d}}),Object.seal(this)},w=new function(){function a(a){var b,c,d,i;if("IFRAME"===a.nodeName)l(a.contentDocument),a.addEventListener("load",function(){l(this.contentDocument),h(this.contentDocument)}),h(a.contentDocument);else for(b in a.dataset)0===b.indexOf("tie")&&(i=x.get(b,a),i?(c=i.resolvePath(a.dataset[b]),c.push(o),d=f(q,c),d||e(q,c,d=[]),d.indexOf(a)<0&&(d.push(a),c.pop(),g(a,b),j(a),s++)):(r[b]||(r[b]=[]),r[b].push(a)))}function b(a){var d,e=c(a),g=[];return d=f(q,e),d&&Object.keys(d).forEach(function(c){c===o?Array.prototype.push.apply(g,d[c]):Array.prototype.push.apply(g,b(a+"."+c))}),g}function d(a,b){var c=new a.ownerDocument.defaultView.CustomEvent(p,{detail:b});a.dispatchEvent(c)}function g(a,b){var c,e,g,h;c=x.get(b,a),e=c.resolvePath(a.dataset[b]),g=v.obtain(e.shift()),g&&c&&(h=f(g.getObservedModel(),e),c.dataToView(a,{data:h}),d(a,{ruleId:b}))}function h(b){var c;b&&b.nodeType&&(b.nodeType===Element.DOCUMENT_NODE||b.nodeType===Element.ELEMENT_NODE)&&(c=c="IFRAME"===b.nodeName?Array.prototype.slice.call(b.contentDocument.getElementsByTagName("*"),0):Array.prototype.slice.call(b.getElementsByTagName("*"),0),c.push(b),c.forEach(a),y.info("collected views, current total: "+s))}function i(b){r[b.id]&&r[b.id].forEach(a),y.info("relocated views, current total: "+s)}function m(a){var b,c,d,e,g,h;a&&a.getElementsByTagName&&(b=Array.prototype.slice.call(a.getElementsByTagName("*"),0),b.push(a),b.forEach(function(a){for(c in a.dataset)h=-1,0===c.indexOf("tie")&&(d=x.get(c,a),e=d.resolvePath(a.dataset[c]),e.push(o),g=f(q,e),h=g&&g.indexOf(a),h>=0&&(g.splice(h,1),k(a),s--))}),y.info("discarded views, current total: "+s))}function n(a,b,d,h){var i,j,k,l=-1;d&&(j=c(d),j.push(o),i=f(q,j),i&&(l=i.indexOf(a)),l>=0&&i.splice(l,1)),k=c(h),k.push(o),f(q,k)||e(q,k,[]),f(q,k).push(a),k.pop(),g(a,b)}var o="___vs___",q={},r={},s=0;Object.defineProperties(this,{collect:{value:h},update:{value:g},relocateByRule:{value:i},discard:{value:m},move:{value:n},get:{value:b}}),Object.seal(this)};var z=[];l(document),x.add("tieValue","value"),x.add("tieText","textContent"),x.add("tiePlaceholder","placeholder"),x.add("tieTooltip","title"),x.add("tieImage","src"),x.add("tieDateValue",{dataToView:function(a,b){a.value=b.data.toLocaleString()}}),x.add("tieDateText",{dataToView:function(a,b){a.textContent=b.data.toLocaleString()}}),x.add("tieList",{resolvePath:function(a){var b=a.split(" ");return c(b[0])},dataToView:function(a,b){function c(a,b){for(var c=Array.prototype.slice.call(l.querySelectorAll('[data-list-item-aid="'+b+'"]'),0);c.length>a;)l.removeChild(c.pop());return c.length}var d,e,f,g,h,i,j,k,l=a.parentNode;if("TEMPLATE"!==a.nodeName)throw new Error("tieList may be defined on template elements only");if(a.dataset.listSourceAid||(a.dataset.listSourceAid=(new Date).getTime()),d=c(b.data?b.data.length:0,a.dataset.listSourceAid),b.data&&d<b.data.length)if(f=a.dataset.tieList.trim().split(/\s+/),f&&3===f.length&&"=>"===f[1]){for(h=f[0],g=f[2],j=a.ownerDocument,k=j.createDocumentFragment();d<b.data.length;d++)e=j.importNode(a.content,!0),i=Array.prototype.slice.call(e.querySelectorAll("*"),0),i.forEach(function(a){Object.keys(a.dataset).forEach(function(b){0===a.dataset[b].indexOf(g+".")&&(a.dataset[b]=a.dataset[b].replace(g,h+"["+d+"]"),w.update(a,b))})}),k.appendChild(e),k.lastElementChild.dataset.listItemAid=a.dataset.listSourceAid;l.appendChild(k)}else y.error("invalid parameter for TieList rule specified")}}),w.collect(document),"object"!=typeof window[n]&&Object.defineProperty(window,n,{value:{}}),Object.defineProperty(window[n],o,{value:{}}),Object.defineProperties(window[n][o],{dispose:{value:m},Ties:{value:v},Rules:{value:x},Utils:{value:{get logger(){return y},get copyObject(){return d},get setPath(){return e},get getPath(){return f},get cutPath(){return g}}},About:{value:{get version(){return"0.5.3"},get author(){return{get name(){return"Guller Yuri"},get email(){return"gullerya@gmail.com"}}}}}})}("object"==typeof arguments?arguments[0]:void 0);