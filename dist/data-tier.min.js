!function(a){"use strict";function b(a){var b;return b=Array.isArray(a)?a.slice():Object.assign({},a)}function c(a,c,d){var f,g;a.forEach(function(h,i){h&&"object"==typeof h&&(f=d.concat(i),g=b(h),a[i]=e(g,c,f))})}function d(a,c,d){var f,g;Reflect.ownKeys(a).forEach(function(h){a[h]&&"object"==typeof a[h]&&(f=d.concat(h),g=b(a[h]),a[h]=e(g,c,f))})}function e(a,b,f){function m(a,d){var m;return m="pop"===d?function(){var c,e,g;return c=a.length-1,b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),b.preventCallbacks=!1,g=[new i(f.concat(c),e)],l(b.callbacks,g),e}:"push"===d?function(){var e,h=[];b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1;for(var i=arguments.length;i>0;i--)h.push(new g(f.concat(e-i),a[e-i]));return l(b.callbacks,h),e}:"shift"===d?function(){var e,g;return b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1,g=[new i(f.concat(0),e)],l(b.callbacks,g),e}:"unshift"===d?function(){var h,i=[],j=[];return Array.from(arguments).forEach(function(a,c){var d;d=a&&"object"==typeof a?e(a,b,f.concat(c)):a,i.push(d)}),i.forEach(function(a,b){j.push(new g(f.concat(b),a))}),h=Reflect.apply(a[d],a,i),c(a,b,f),l(b.callbacks,j),h}:"reverse"===d?function(){var e,g=[];return b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1,g.push(new j),l(b.callbacks,g),e}:"sort"===d?function(){var e,g=[];return b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1,g.push(new k),l(b.callbacks,g),e}:"fill"===d?function(){var e,i,j,k,m=[];i=arguments.length<2?0:arguments[1]<0?a.length+arguments[1]:arguments[1],j=arguments.length<3?a.length:arguments[2]<0?a.length+arguments[2]:arguments[2],k=a.slice(i,j),b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1;for(var n=i;j>n;n++)a.hasOwnProperty(n-i)?m.push(new h(f.concat(n),a[n],k[n-i])):m.push(new g(f.concat(n),a[n]));return l(b.callbacks,m),e}:"splice"===d?function(){var e,j,k,m,n,o=[];for(b.preventCallbacks=!0,j=0===arguments.length?0:arguments[0]<0?a.length+arguments[0]:arguments[0],k=arguments.length<2?a.length-j:arguments[1],m=Math.max(arguments.length-2,0),n=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1,e=0;k>e;e++)m>e?o.push(new h(f.concat(j+e),a[j+e],n[e])):o.push(new i(f.concat(j+e),n[e]));for(;m>e;e++)o.push(new g(f.concat(j+e),a[j+e]));return l(b.callbacks,o),n}:Reflect.get(a,d)}function o(a,c,d){var i,j,k=a.hasOwnProperty(c),m=a[c],o=Array.isArray(b.eventsCollector)?b.eventsCollector:[];return i=Reflect.set(a,c,d),b.callbacks.length&&i&&d!==m&&(j=f.concat(c),"object"==typeof m&&m&&n.has(m)&&n.delete(m),"object"==typeof d&&d&&(a[c]=e(d,b,j)),k?o.push(new h(j,d,m)):o.push(new g(j,d)),b.preventCallbacks||l(b.callbacks,o)),i}function p(a,c){var d,e,g=a[c],h=Array.isArray(b.eventsCollector)?b.eventsCollector:[];return d=Reflect.deleteProperty(a,c),b.callbacks.length&&d&&("object"==typeof g&&g&&n.has(g)&&n.delete(g),e=f.concat(c),h.push(new i(e,g)),b.preventCallbacks||l(b.callbacks,h)),d}var q;if(n.has(a)){var r=a;a=n.get(a),n.delete(r)}return Array.isArray(a)?(c(a,b,f),q=new Proxy(a,{get:m,set:o,deleteProperty:p})):(d(a,b,f),q=new Proxy(a,{set:o,deleteProperty:p})),n.set(q,a),q}function f(a){function c(a){if("function"!=typeof a)throw new Error("callback parameter MUST be a function");h.indexOf(a)<0?h.push(a):console.info("observer callback may be bound only once for an observable")}function d(){arguments.length?Array.from(arguments).forEach(function(a){var b=h.indexOf(a);b&&h.splice(b,1)}):h.splice(0,h.length)}var f,g,h=[],i=!1;f=e(b(a),this,[]),Reflect.defineProperty(f,"observe",{value:c}),Reflect.defineProperty(f,"unobserve",{value:d}),Reflect.defineProperty(this,"callbacks",{get:function(){return h.slice()}}),Reflect.defineProperty(this,"eventsCollector",{value:g,writable:!0}),Reflect.defineProperty(this,"preventCallbacks",{value:i,writable:!0}),Reflect.defineProperty(this,"proxy",{value:f})}function g(a,b){Reflect.defineProperty(this,"type",{value:"insert"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"value",{value:b})}function h(a,b,c){Reflect.defineProperty(this,"type",{value:"update"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"value",{value:b}),Reflect.defineProperty(this,"oldValue",{value:c})}function i(a,b){Reflect.defineProperty(this,"type",{value:"delete"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"oldValue",{value:b})}function j(){Reflect.defineProperty(this,"type",{value:"reverse"})}function k(){Reflect.defineProperty(this,"type",{value:"shuffle"})}function l(a,b){for(var c=0;c<a.length;c++)try{a[c](b)}catch(a){console.error(a)}}var m,n=new WeakMap;m={},Reflect.defineProperty(m,"from",{value:function(a){if(!a||"object"!=typeof a)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in a||"unobserve"in a)throw new Error('target object MUST NOT have not own nor inherited properties "observe" and/or "unobserve"');var b=new f(a);return b.proxy}}),Reflect.defineProperty(a,"Observable",{value:m})}(this),function(a){"use strict";function b(a){}Reflect.defineProperty(a,"ViewObserver",{value:b})}(this),function(a,b){"use strict";function c(a){var b,c=2,d=a.split("-");for(b=d[1];c<d.length;)b+=d[c][0].toUpperCase()+d[c++].substr(1);return b}function d(a){if(Array.isArray(a))return a;for(var b=0,c=!1,d="",e=[];b<a.length;){if("."===a[b])d.length&&e.push(d),d="";else if("["===a[b]){if(c)throw new Error('bad path: "'+a+'", at: '+b);d.length&&e.push(d),d="",c=!0}else if("]"===a[b]){if(!c)throw new Error('bad path: "'+a+'", at: '+b);d.length&&e.push(d),d="",c=!1}else d+=a[b];b++}return d.length&&e.push(d),e}function e(a,b,c){var e,f=d(b);for(e=0;e<f.length-1;e++)if("object"==typeof a[f[e]])a=a[f[e]];else{if(f[e]in a)throw new Error("the path is unavailable");a=a[f[e]]={}}a[f[e]]=c}function f(a,b){var c,e;if(a){for(c=d(b),e=0;e<c.length;e++)if(a=a[c[e]],!a)return;return a}}function g(a){var b,c,e,f=a.target;return(b=f.dataset.tieValue?f.dataset.tieValue:f.dataset.tie)?(b=d(b))?(c=b.shift(),(e=m.obtain(c))?void e.viewToDataProcessor({data:e.data,path:b,view:f}):void console.error('tie "'+c+'" not found')):void console.error("path to data is invalid"):void console.error("path to data not available")}function h(a){var b=a.ownerDocument.defaultView;(a instanceof b.HTMLInputElement||a instanceof b.HTMLSelectElement)&&a.addEventListener("change",g)}function i(a){a.removeEventListener("change",g)}function j(a){function b(a){a.forEach(function(a){var b,d,e=a.type,f=a.target,g=a.attributeName;if("attributes"===e&&0===g.indexOf("data-tie"))n.move(f,c(g),a.oldValue,f.getAttribute(g));else if("attributes"===e&&"src"===g&&"IFRAME"===f.nodeName)n.discard(f.contentDocument);else if("childList"===e){if(a.addedNodes.length)for(b=0,d=a.addedNodes.length;d>b;b++)"IFRAME"===a.addedNodes[b].nodeName?(a.addedNodes[b].contentDocument&&(j(a.addedNodes[b].contentDocument),n.collect(a.addedNodes[b].contentDocument)),a.addedNodes[b].addEventListener("load",function(){j(this.contentDocument),n.collect(this.contentDocument)})):n.collect(a.addedNodes[b]);if(a.removedNodes.length)for(b=0,d=a.removedNodes.length;d>b;b++)"IFRAME"===a.removedNodes[b].nodeName?n.discard(a.removedNodes[b].contentDocument):n.discard(a.removedNodes[b])}})}var d=new MutationObserver(b);d.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!1,characterDataOldValue:!1}),p.push(d)}var k,l,m,n,o;if("object"==typeof a.Observable&&a.Observable||console.warn('DataTier initialization lacks of OOTB "Observable" implementation'),"function"!=typeof a.ViewObserver)throw new Error('DataTier initialization failed: "ViewObserver" not found');"object"==typeof b&&b||(b={}),o=new function(){function a(a){return d(a)}function b(b,c){var d,f,g;"string"==typeof c?(d=a,f=function(a,b){var d;b&&(d=b.data,d="undefined"==typeof d||null===d?"":d,e(a,c,d))},g=function(){throw new Error("not yet implemented")}):"function"==typeof c?(d=a,f=c,g=function(){throw new Error('no "inputToData" functionality defined in this rule')}):"object"==typeof c&&(d=c.resolvePath||a,f=c.dataToView,g=c.inputToData),Object.defineProperties(this,{id:{value:b},resolvePath:{value:d},dataToView:{value:f,writable:!0},inputToData:{value:g}})}var c={};Object.defineProperties(this,{add:{value:function(a,d){if(!a||!d)throw new Error("bad parameters; f(string, string|function) expected");if(0!==a.indexOf("tie"))throw new Error('rule id MUST begin with "tie"');if(a in c)throw new Error('rule with id "'+a+'" already exists');return c[a]=new b(a,d),n.relocateByRule(c[a]),c[a]}},get:{value:function(a,b){var d,e;if(0!==a.indexOf("tie"))console.error("invalid tie id supplied");else if(a in c)d=c[a];else if("tie"===a){if(e=b.ownerDocument.defaultView,!b||!b.nodeName)throw new Error('rule "'+a+'" not found, therefore valid DOM element MUST be supplied to grasp the default rule');return b instanceof e.HTMLInputElement||b instanceof e.HTMLSelectElement?c.tieValue:b instanceof e.HTMLImageElement?c.tieImage:c.tieText}return d}},del:{value:function(a){return delete c[a]}}}),Object.seal(this)},m=new function(){function a(a){e(a.data,a.path,a.view.value)}function b(b){var c;Object.defineProperties(this,{namespace:{get:function(){return b}},setModel:{value:function(a){if("object"!=typeof a)throw new TypeError("model MUST be an object");return l[b]=a,l[b]}},getObservedModel:{value:function(){return l[b]}},viewToDataProcessor:{get:function(){return"function"==typeof c?c:a},set:function(a){"function"==typeof a&&(c=a)}}})}function c(a){if(!a||"string"!=typeof a)throw new Error("namespace (first param) MUST be a non empty string");if(/\W/.test(a))throw new Error("namespace (first param) MUST consist of alphanumeric non uppercase characters only");return f[a]||(f[a]=new b(a)),f[a]}function d(a){f[a]&&delete f[a]}var f={};Object.defineProperties(this,{obtain:{value:c},remove:{value:d}}),Object.seal(this)},n=new function(){function a(a){var b,d,i,k;if("IFRAME"===a.nodeName)j(a.contentDocument),a.addEventListener("load",function(){j(this.contentDocument),g(this.contentDocument)}),g(a.contentDocument);else for(b in a.dataset)0===b.indexOf("tie")&&(k=o.get(b,a),k?(d=k.resolvePath(a.dataset[b]),d.push(p),i=f(q,d),i||e(q,d,i=[]),i.indexOf(a)<0&&(i.push(a),d.pop(),c(a,b),h(a),s++)):(r[b]||(r[b]=[]),r[b].push(a)))}function b(a){var c,e=d(a),g=[];return c=f(q,e),c&&Object.keys(c).forEach(function(d){d===p?Array.prototype.push.apply(g,c[d]):Array.prototype.push.apply(g,b(a+"."+d))}),g}function c(a,b){var c,d,e,g;c=o.get(b,a),d=c.resolvePath(a.dataset[b]),e=m.obtain(d.shift()),e&&c&&(g=f(e.getObservedModel(),d),c.dataToView(a,{data:g}))}function g(b){var c;b&&b.nodeType&&(b.nodeType===Element.DOCUMENT_NODE||b.nodeType===Element.ELEMENT_NODE)&&(c=c="IFRAME"===b.nodeName?Array.prototype.slice.call(b.contentDocument.getElementsByTagName("*"),0):Array.prototype.slice.call(b.getElementsByTagName("*"),0),c.push(b),c.forEach(a),console.info("collected views, current total: "+s))}function k(b){r[b.id]&&r[b.id].forEach(a),console.info("relocated views, current total: "+s)}function l(a){var b,c,d,e,g,h;a&&a.getElementsByTagName&&(b=Array.prototype.slice.call(a.getElementsByTagName("*"),0),b.push(a),b.forEach(function(a){for(c in a.dataset)h=-1,0===c.indexOf("tie")&&(d=o.get(c,a),e=d.resolvePath(a.dataset[c]),e.push(p),g=f(q,e),h=g&&g.indexOf(a),h>=0&&(g.splice(h,1),i(a),s--))}),console.info("discarded views, current total: "+s))}function n(a,b,g,h){var i,j,k,l=-1;g&&(j=d(g),j.push(p),i=f(q,j),i&&(l=i.indexOf(a)),l>=0&&i.splice(l,1)),k=d(h),k.push(p),f(q,k)||e(q,k,[]),f(q,k).push(a),k.pop(),c(a,b)}var p="___vs___",q={},r={},s=0;Object.defineProperties(this,{collect:{value:g},update:{value:c},relocateByRule:{value:k},discard:{value:l},move:{value:n},get:{value:b}}),Object.seal(this)};var p=[];j(document),n.collect(document),k={},Reflect.defineProperty(k,"",{}),Reflect.defineProperty(a,"DataTier",{value:k})}(this,"object"==typeof arguments?arguments[0]:void 0),function(a){"use strict";var b;if("object"!=typeof a.DataTier||!a.DataTier)throw new Error("Vanilla rules appliance failed: DataTier library not found");b=a.DataTier.Rules,b.add("tieValue","value"),b.add("tieText","textContent"),b.add("tiePlaceholder","placeholder"),b.add("tieTooltip","title"),b.add("tieImage","src"),b.add("tieDateValue",{dataToView:function(a,b){a.value=b.data.toLocaleString()}}),b.add("tieDateText",{dataToView:function(a,b){a.textContent=b.data.toLocaleString()}}),b.add("tieList",{resolvePath:function(a){var b=a.split(" ");return pathToNodes(b[0])},dataToView:function(a,b){function c(a,b){for(var c=Array.prototype.slice.call(l.querySelectorAll('[data-list-item-aid="'+b+'"]'),0);c.length>a;)l.removeChild(c.pop());return c.length}var d,e,f,g,h,i,j,k,l=a.parentNode;if("TEMPLATE"!==a.nodeName)throw new Error("tieList may be defined on template elements only");if(a.dataset.listSourceAid||(a.dataset.listSourceAid=(new Date).getTime()),d=c(b.data?b.data.length:0,a.dataset.listSourceAid),b.data&&d<b.data.length)if(f=a.dataset.tieList.trim().split(/\s+/),f&&3===f.length&&"=>"===f[1]){for(h=f[0],g=f[2],j=a.ownerDocument,k=j.createDocumentFragment();d<b.data.length;d++)e=j.importNode(a.content,!0),i=Array.prototype.slice.call(e.querySelectorAll("*"),0),i.forEach(function(a){Object.keys(a.dataset).forEach(function(b){0===a.dataset[b].indexOf(g+".")&&(a.dataset[b]=a.dataset[b].replace(g,h+"["+d+"]"),viewsService.update(a,b))})}),k.appendChild(e),k.lastElementChild.dataset.listItemAid=a.dataset.listSourceAid;l.appendChild(k)}else logger.error("invalid parameter for TieList rule specified")}})}(this);