!function(a){"use strict";function b(a){var b;return b=Array.isArray(a)?a.slice():Object.assign({},a)}function c(a,c,d){var f,g;a.forEach(function(h,i){h&&"object"==typeof h&&(f=d.concat(i),g=b(h),a[i]=e(g,c,f))})}function d(a,c,d){var f,g;Reflect.ownKeys(a).forEach(function(h){a[h]&&"object"==typeof a[h]&&(f=d.concat(h),g=b(a[h]),a[h]=e(g,c,f))})}function e(a,b,f){function m(a,d){var m;return m="pop"===d?function(){var c,e,g;return c=a.length-1,b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),b.preventCallbacks=!1,g=[new i(f.concat(c),e)],l(b.callbacks,g),e}:"push"===d?function(){var e,h=[];b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1;for(var i=arguments.length;i>0;i--)h.push(new g(f.concat(e-i),a[e-i]));return l(b.callbacks,h),e}:"shift"===d?function(){var e,g;return b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1,g=[new i(f.concat(0),e)],l(b.callbacks,g),e}:"unshift"===d?function(){var h,i=[],j=[];return Array.from(arguments).forEach(function(a,c){var d;d=a&&"object"==typeof a?e(a,b,f.concat(c)):a,i.push(d)}),i.forEach(function(a,b){j.push(new g(f.concat(b),a))}),h=Reflect.apply(a[d],a,i),c(a,b,f),l(b.callbacks,j),h}:"reverse"===d?function(){var e,g=[];return b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1,g.push(new j),l(b.callbacks,g),e}:"sort"===d?function(){var e,g=[];return b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1,g.push(new k),l(b.callbacks,g),e}:"fill"===d?function(){var e,i,j,k,m=[];i=arguments.length<2?0:arguments[1]<0?a.length+arguments[1]:arguments[1],j=arguments.length<3?a.length:arguments[2]<0?a.length+arguments[2]:arguments[2],k=a.slice(i,j),b.preventCallbacks=!0,e=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1;for(var n=i;n<j;n++)a.hasOwnProperty(n-i)?m.push(new h(f.concat(n),a[n],k[n-i])):m.push(new g(f.concat(n),a[n]));return l(b.callbacks,m),e}:"splice"===d?function(){var e,j,k,m,n,o=[];for(b.preventCallbacks=!0,j=0===arguments.length?0:arguments[0]<0?a.length+arguments[0]:arguments[0],k=arguments.length<2?a.length-j:arguments[1],m=Math.max(arguments.length-2,0),n=Reflect.apply(a[d],a,arguments),c(a,b,f),b.preventCallbacks=!1,e=0;e<k;e++)e<m?o.push(new h(f.concat(j+e),a[j+e],n[e])):o.push(new i(f.concat(j+e),n[e]));for(;e<m;e++)o.push(new g(f.concat(j+e),a[j+e]));return l(b.callbacks,o),n}:Reflect.get(a,d)}function o(a,c,d){var i,j,k=a.hasOwnProperty(c),m=a[c],o=Array.isArray(b.eventsCollector)?b.eventsCollector:[];return i=Reflect.set(a,c,d),b.callbacks.length&&i&&d!==m&&(j=f.concat(c),"object"==typeof m&&m&&n.has(m)&&n.delete(m),"object"==typeof d&&d&&(a[c]=e(d,b,j)),k?o.push(new h(j,d,m)):o.push(new g(j,d)),b.preventCallbacks||l(b.callbacks,o)),i}function p(a,c){var d,e,g=a[c],h=Array.isArray(b.eventsCollector)?b.eventsCollector:[];return d=Reflect.deleteProperty(a,c),b.callbacks.length&&d&&("object"==typeof g&&g&&n.has(g)&&n.delete(g),e=f.concat(c),h.push(new i(e,g)),b.preventCallbacks||l(b.callbacks,h)),d}var q;if(n.has(a)){var r=a;a=n.get(a),n.delete(r)}return Array.isArray(a)?(c(a,b,f),q=new Proxy(a,{get:m,set:o,deleteProperty:p})):(d(a,b,f),q=new Proxy(a,{set:o,deleteProperty:p})),n.set(q,a),q}function f(a){function c(a){if("function"!=typeof a)throw new Error("callback parameter MUST be a function");h.indexOf(a)<0?h.push(a):console.info("observer callback may be bound only once for an observable")}function d(){arguments.length?Array.from(arguments).forEach(function(a){var b=h.indexOf(a);b&&h.splice(b,1)}):h.splice(0,h.length)}var f,g,h=[],i=!1;f=e(b(a),this,[]),Reflect.defineProperty(f,"observe",{value:c}),Reflect.defineProperty(f,"unobserve",{value:d}),Reflect.defineProperty(this,"callbacks",{get:function(){return h.slice()}}),Reflect.defineProperty(this,"eventsCollector",{value:g,writable:!0}),Reflect.defineProperty(this,"preventCallbacks",{value:i,writable:!0}),Reflect.defineProperty(this,"proxy",{value:f})}function g(a,b){Reflect.defineProperty(this,"type",{value:"insert"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"value",{value:b})}function h(a,b,c){Reflect.defineProperty(this,"type",{value:"update"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"value",{value:b}),Reflect.defineProperty(this,"oldValue",{value:c})}function i(a,b){Reflect.defineProperty(this,"type",{value:"delete"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"oldValue",{value:b})}function j(){Reflect.defineProperty(this,"type",{value:"reverse"})}function k(){Reflect.defineProperty(this,"type",{value:"shuffle"})}function l(a,b){for(var c=0;c<a.length;c++)try{a[c](b)}catch(a){console.error(a)}}var m,n=new WeakMap;m={},Reflect.defineProperty(m,"from",{value:function(a){if(!a||"object"!=typeof a)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in a||"unobserve"in a)throw new Error('target object MUST NOT have not own nor inherited properties "observe" and/or "unobserve"');var b=new f(a);return b.proxy}}),Reflect.defineProperty(a,"Observable",{value:m})}(this),function(a){"use strict";function b(a,b,c){function d(a){if("object"!=typeof a)throw new Error("observable MUST be an object; it MAY be null");null!==a&&g(a),f&&f.unobserve(observer),f=a,f&&a.observe(j.viewService.update)}function e(){return f}var f;d(b),Reflect.defineProperty(this,"name",{value:a}),Reflect.defineProperty(this,"data",{get:e,set:d})}function c(a){return f(a),i[a]}function d(a,c,d){if(f(a),i[a])throw new Error("existing Tie MAY NOT be re-created, use the tie's own APIs to reconfigure it");return i[a]=new b(a,c,d)}function e(a){f(a),i[a]&&delete i[a]}function f(a){if(!a||"string"!=typeof a)throw new Error("name MUST be a non-empty string");if(/\W/.test(a))throw new Error("name MUST consist of alphanumeric non uppercase characters only")}function g(a){if("object"!=typeof a)throw new Error("observable MUST be an object");if(a&&("function"!=typeof a.observe||"function"!=typeof a.unobserve))throw new Error('observable MUST have "observe" and "unobserve" functions defined')}function h(a){j=a,Reflect.defineProperty(this,"getTie",{value:c}),Reflect.defineProperty(this,"createTie",{value:d}),Reflect.defineProperty(this,"removeTie",{value:e})}const i={};var j;a.DataTier||Reflect.defineProperty(a,"DataTier",{value:{}}),Reflect.defineProperty(a.DataTier,"TiesService",{value:h})}(this),function(a){"use strict";function b(a){if(Array.isArray(a))return a;for(var b=0,c=!1,d="",e=[];b<a.length;){if("."===a[b])d.length&&e.push(d),d="";else if("["===a[b]){if(c)throw new Error('bad path: "'+a+'", at: '+b);d.length&&e.push(d),d="",c=!0}else if("]"===a[b]){if(!c)throw new Error('bad path: "'+a+'", at: '+b);d.length&&e.push(d),d="",c=!1}else d+=a[b];b++}return d.length&&e.push(d),e}function c(a,c,d){var e,f=b(c);for(e=0;e<f.length-1;e++)if("object"==typeof a[f[e]])a=a[f[e]];else{if(f[e]in a)throw new Error("the path is unavailable");a=a[f[e]]={}}a[f[e]]=d}function d(a,c){var d,e;if(a){for(d=b(c),e=0;e<d.length;e++)if(a=a[d[e]],!a)return;return a}}function e(a){var c,d,e,f=a.target;return(c=f.dataset.tieValue?f.dataset.tieValue:f.dataset.tie)?(c=b(c))?(d=c.shift(),(e=tiesService.obtain(d))?void e.viewToDataProcessor({data:e.data,path:c,view:f}):void console.error('tie "'+d+'" not found')):void console.error("path to data is invalid"):void console.error("path to data not available")}function f(a){var b=a.ownerDocument.defaultView;(a instanceof b.HTMLInputElement||a instanceof b.HTMLSelectElement)&&a.addEventListener("change",e)}function g(a){a.removeEventListener("change",e)}function h(a){var b;"IFRAME"===a.nodeName?(initDocumentObserver(a.contentDocument),a.addEventListener("load",function(){initDocumentObserver(this.contentDocument),k(this.contentDocument)}),k(a.contentDocument)):p.rulesService.getApplicableRules(a).forEach(function(e){var g=e.parseValue(a).dataPath;g.push(q),b=d(r,g),b||c(r,g,b=[]),b.indexOf(a)<0&&(b.push(a),g.pop(),j(a,e.name),f(a),t++)})}function i(a){var c,e=b(a),f=[];return c=d(r,e),c&&Object.keys(c).forEach(function(b){b===q?Array.prototype.push.apply(f,c[b]):Array.prototype.push.apply(f,i(a+"."+b))}),f}function j(a,b){var c,e,f,g;c=p.rulesService.getRule(b),e=c.parseValue(a).dataPath,f=p.tiesService.getTie(e.shift()),f&&c&&(g=d(f.data,e),c.dataToView(g,a))}function k(a){var b;a&&a.nodeType&&(a.nodeType===Element.DOCUMENT_NODE||a.nodeType===Element.ELEMENT_NODE)&&(b=b="IFRAME"===a.nodeName?Array.prototype.slice.call(a.contentDocument.getElementsByTagName("*"),0):Array.prototype.slice.call(a.getElementsByTagName("*"),0),b.push(a),b.forEach(h),console.info("collected views, current total: "+t))}function l(a){s[a.id]&&s[a.id].forEach(h),console.info("relocated views, current total: "+t)}function m(a){var b,c,e,f,h,i;a&&a.getElementsByTagName&&(b=Array.prototype.slice.call(a.getElementsByTagName("*"),0),b.push(a),b.forEach(function(a){for(c in a.dataset)i=-1,0===c.indexOf("tie")&&(e=p.rulesService.getRule(c),f=e.parseValue(a).dataPath,f.push(q),h=d(r,f),i=h&&h.indexOf(a),i>=0&&(h.splice(i,1),g(a),t--))}),console.info("discarded views, current total: "+t))}function n(a,e,f,g){var h,i,k,l=-1;f&&(i=b(f),i.push(q),h=d(r,i),h&&(l=h.indexOf(a)),l>=0&&h.splice(l,1)),k=b(g),k.push(q),d(r,k)||c(r,k,[]),d(r,k).push(a),k.pop(),j(a,e)}function o(a){p=a,Reflect.defineProperty(this,"collect",{value:k}),Reflect.defineProperty(this,"update",{value:j}),Reflect.defineProperty(this,"relocateByRule",{value:l}),Reflect.defineProperty(this,"discard",{value:m}),Reflect.defineProperty(this,"move",{value:n}),Reflect.defineProperty(this,"get",{value:i})}a.DataTier||Reflect.defineProperty(a,"DataTier",{value:{}});var p,q="___vs___",r={},s={},t=0;Reflect.defineProperty(a.DataTier,"ViewsService",{value:o})}(this),function(a){"use strict";function b(a,b){if("string"!=typeof a||!a)throw new Error("name MUST be a non-empty string");if(h[a])throw new Error('rule "'+a+'" already exists; you may want to reconfigure the existing rule');if("object"!=typeof b||!b)throw new Error("options MUST be a non-null object");if("function"!=typeof b.dataToView)throw new Error('options MUST have a "dataToView" function defined');Reflect.defineProperty(this,"name",{value:a}),Reflect.defineProperty(this,"dataToView",{value:b.dataToView}),"function"==typeof b.inputToData&&Reflect.defineProperty(this,"inputToData",{value:b.inputToData}),"function"==typeof b.parseValue&&Reflect.defineProperty(this,"parseValue",{value:b.parseValue})}function c(a){if(!(a&&a instanceof b))throw new Error("rule MUST be an object of type Rule");h[a.name]=a}function d(a){return h[a]?h[a]:void console.error('rule "'+a+'" is not defined')}function e(a){if("string"!=typeof a||!a)throw new Error("rule name MUST be a non-empty string");return delete h[a]}function f(a){var b=[];return a&&a.nodeType===Node.ELEMENT_NODE&&Reflect.ownKeys(a.dataset).forEach(function(a){h[a]&&b.push(h[a])}),b}function g(a){i=a,Reflect.defineProperty(this,"Rule",{value:b}),Reflect.defineProperty(this,"addRule",{value:c}),Reflect.defineProperty(this,"getRule",{value:d}),Reflect.defineProperty(this,"removeRule",{value:e}),Reflect.defineProperty(this,"getApplicableRules",{value:f})}const h={};var i;a.DataTier||Reflect.defineProperty(a,"DataTier",{value:{}}),b.prototype.parseValue=function(a){if(a&&a.nodeType===Node.ELEMENT_NODE){var b=a.dataset[this.name];return{dataPath:i.utils.pathToNodes(b.split(" ")[0])}}console.error("valid DOM Element expected, received: "+a)},Reflect.defineProperty(a.DataTier,"RulesService",{value:g})}(this),function(a){"use strict";function b(a){var b,c=2,d=a.split("-");for(b=d[1];c<d.length;)b+=d[c][0].toUpperCase()+d[c++].substr(1);return b}function c(a){if(Array.isArray(a))return a;for(var b=0,c=!1,d="",e=[];b<a.length;){if("."===a[b])d.length&&e.push(d),d="";else if("["===a[b]){if(c)throw new Error('bad path: "'+a+'", at: '+b);d.length&&e.push(d),d="",c=!0}else if("]"===a[b]){if(!c)throw new Error('bad path: "'+a+'", at: '+b);d.length&&e.push(d),d="",c=!1}else d+=a[b];b++}return d.length&&e.push(d),e}function d(a){function c(a){a.forEach(function(a){var c,f,g=a.type,h=a.target,i=a.attributeName;if("attributes"===g&&0===i.indexOf("data-tie"))e.viewsService.move(h,b(i),a.oldValue,h.getAttribute(i));else if("attributes"===g&&"src"===i&&"IFRAME"===h.nodeName)e.viewsService.discard(h.contentDocument);else if("childList"===g){if(a.addedNodes.length)for(c=0,f=a.addedNodes.length;c<f;c++)"IFRAME"===a.addedNodes[c].nodeName?(a.addedNodes[c].contentDocument&&(d(a.addedNodes[c].contentDocument),e.viewsService.collect(a.addedNodes[c].contentDocument)),a.addedNodes[c].addEventListener("load",function(){d(this.contentDocument),e.viewsService.collect(this.contentDocument)})):e.viewsService.collect(a.addedNodes[c]);if(a.removedNodes.length)for(c=0,f=a.removedNodes.length;c<f;c++)"IFRAME"===a.removedNodes[c].nodeName?e.viewsService.discard(a.removedNodes[c].contentDocument):e.viewsService.discard(a.removedNodes[c])}})}var f=new MutationObserver(c);f.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!1,characterDataOldValue:!1}),g.push(f)}const e={},f={};if("function"!=typeof a.DataTier.TiesService)throw new Error('DataTier initialization failed: "TiesService" not found');if("function"!=typeof a.DataTier.ViewsService)throw new Error('DataTier initialization failed: "ViewsService" not found');if("function"!=typeof a.DataTier.RulesService)throw new Error('DataTier initialization failed: "RulesService" not found');Reflect.defineProperty(e,"utils",{value:f}),Reflect.defineProperty(e,"tiesService",{value:new a.DataTier.TiesService(e)}),Reflect.defineProperty(e,"viewsService",{value:new a.DataTier.ViewsService(e)}),Reflect.defineProperty(e,"rulesService",{value:new a.DataTier.RulesService(e)}),f.pathToNodes=c;var g=[];d(document),e.viewsService.collect(document),Reflect.defineProperty(a.DataTier,"getTie",{value:e.tiesService.getTie}),Reflect.defineProperty(a.DataTier,"createTie",{value:e.tiesService.createTie}),Reflect.defineProperty(a.DataTier,"removeTie",{value:e.tiesService.removeTie}),Reflect.defineProperty(a.DataTier,"Rule",{value:e.rulesService.Rule}),Reflect.defineProperty(a.DataTier,"addRule",{value:e.rulesService.addRule}),Reflect.defineProperty(a.DataTier,"getRule",{value:e.rulesService.getRule}),Reflect.defineProperty(a.DataTier,"removeRule",{value:e.rulesService.removeRule})}(this),function(a){"use strict";const b=a.DataTier;if("object"!=typeof b||!b)throw new Error("Vanilla rules appliance failed: DataTier library not found");b.addRule(new b.Rule("tie",{dataToView:function(a,b){var c=["INPUT","TEXTAREA","SELECT","OPTION","PROGRESS","METER"];b&&b.nodeType===Node.ELEMENT_NODE?c.indexOf(b.tagName)>=0?b.value=a:b.textContent=a:console.error("valid element expected, found: "+b)}})),b.addRule(new b.Rule("tieValue",{dataToView:function(a,b){b.value=a}})),b.addRule(new b.Rule("tieText",{dataToView:function(a,b){b.textContent=a}})),b.addRule(new b.Rule("tiePlaceholder",{dataToView:function(a,b){b.placeholder=a}})),b.addRule(new b.Rule("tieTooltip",{dataToView:function(a,b){b.title=a}})),b.addRule(new b.Rule("tieImage",{dataToView:function(a,b){b.src=a}})),b.addRule(new b.Rule("tieDateValue",{dataToView:function(a,b){b.value=a.toLocaleString()}})),b.addRule(new b.Rule("tieDateText",{dataToView:function(a,b){b.textContent=a.toLocaleString()}})),b.addRule(new b.Rule("tieList",{parseValue:function(a){if(a&&a.nodeType===Node.ELEMENT_NODE){var b=a.dataset.tieList;return{dataPath:apis.utils.pathToNodes(b.split(" ")[0])}}console.error("valid DOM Element expected, received: "+a)},dataToView:function(a,b){function c(a,b){for(var c=Array.from(l.querySelectorAll('[data-list-item-aid="'+b+'"]'));c.length>a;)l.removeChild(c.pop());return c.length}var d,e,f,g,h,i,j,k,l=b.parentNode;if("TEMPLATE"!==b.nodeName)throw new Error("tieList may be defined on template elements only");if(b.dataset.listSourceAid||(b.dataset.listSourceAid=(new Date).getTime()),d=c(a.data?a.data.length:0,b.dataset.listSourceAid),a.data&&d<a.data.length)if(f=b.dataset.tieList.trim().split(/\s+/),f&&3===f.length&&"=>"===f[1]){for(h=f[0],g=f[2],j=b.ownerDocument,k=j.createDocumentFragment();d<a.data.length;d++)e=j.importNode(b.content,!0),i=Array.prototype.slice.call(e.querySelectorAll("*"),0),i.forEach(function(a){Object.keys(a.dataset).forEach(function(b){0===a.dataset[b].indexOf(g+".")&&(a.dataset[b]=a.dataset[b].replace(g,h+"["+d+"]"),viewsService.update(a,b))})}),k.appendChild(e),k.lastElementChild.dataset.listItemAid=b.dataset.listSourceAid;l.appendChild(k)}else logger.error("invalid parameter for TieList rule specified")}}))}(this);