!function(e){"use strict";function t(e){return Array.isArray(e)?e.slice():Object.assign(new e.constructor,e)}function n(e){return m.indexOf(e.constructor.name)>=0}function r(e,t){var n=v.get(e),r=g.get(n.root);return"pop"===t?function(){var o,a,i;return o=e.length-1,(a=Reflect.apply(e[t],e,arguments))&&"object"==typeof a&&(a=y.get(a),v.get(a).revoke()),i=[new p(n.path.concat(o),a)],r.notify(i),a}:"push"===t?function(){var o,a,i,c=[];return o=Array.from(arguments),i=e.length,o.forEach(function(e,t){e&&"object"==typeof e&&(o[t]=new f(e,i+t,n).proxy),c.push(new l(n.path.concat(i+t),e))}),a=Reflect.apply(e[t],e,o),r.notify(c),a}:"shift"===t?function(){var o,a,i;return(o=Reflect.apply(e[t],e,arguments))&&"object"==typeof o&&(o=y.get(o),v.get(o).revoke()),e.forEach(function(e,t){e&&"object"==typeof e&&((i=v.get(y.get(e)))?i.ownKey=t:console.error("failed to resolve proxy -> target -> observed"))}),a=[new p(n.path.concat(0),o)],r.notify(a),o}:"unshift"===t?function(){var o,a,i,c=[];(o=Array.from(arguments)).forEach(function(e,t){e&&"object"==typeof e&&(o[t]=new f(e,t,n).proxy)}),a=Reflect.apply(e[t],e,o),e.forEach(function(e,t){e&&"object"==typeof e&&((i=v.get(y.get(e)))?i.ownKey=t:console.error("failed to resolve proxy -> target -> observed"))});for(var s=0;s<o.length;s++)c.push(new l(n.path.concat(s),e[s]));return r.notify(c),a}:"reverse"===t?function(){var n,o=[];return Reflect.apply(e[t],e,arguments),e.forEach(function(e,t){e&&"object"==typeof e&&((n=v.get(y.get(e)))?n.ownKey=t:console.error("failed to resolve proxy -> target -> observed"))}),o.push(new h),r.notify(o),this}:"sort"===t?function(){var n,o=[];return Reflect.apply(e[t],e,arguments),e.forEach(function(e,t){e&&"object"==typeof e&&((n=v.get(y.get(e)))?n.ownKey=t:console.error("failed to resolve proxy -> target -> observed"))}),o.push(new d),r.notify(o),this}:"fill"===t?function(){var o,a,i,c=[];o=arguments.length<2?0:arguments[1]<0?e.length+arguments[1]:arguments[1],a=arguments.length<3?e.length:arguments[2]<0?e.length+arguments[2]:arguments[2],i=e.slice(),Reflect.apply(e[t],e,arguments);for(var s=o;s<a;s++)e[s]&&"object"==typeof e[s]&&(e[s]=new f(e[s],s,n).proxy),i.hasOwnProperty(s)?(c.push(new u(n.path.concat(s),e[s],i[s]&&"object"==typeof i[s]?y.get(i[s]):i[s])),i[s]&&"object"==typeof i[s]&&v.get(y.get(i[s])).revoke()):c.push(new l(n.path.concat(s),e[s]));return r.notify(c),this}:"splice"===t?function(){var o,a,i,c,s,h,d,g=[];for((o=Array.from(arguments)).forEach(function(e,t){t>1&&e&&"object"==typeof e&&(o[t]=new f(e,t,n).proxy)}),s=0===o.length?0:o[0]<0?e.length+o[0]:o[0],h=o.length<2?e.length-s:o[1],d=Math.max(o.length-2,0),a=Reflect.apply(e[t],e,o),e.forEach(function(e,t){e&&"object"==typeof e&&((i=v.get(y.get(e)))?i.ownKey=t:console.error("failed to resolve proxy -> target -> observed"))}),a.forEach(function(e,t){e&&"object"==typeof e&&(a[t]=y.get(e),v.get(a[t]).revoke())}),c=0;c<h;c++)c<d?g.push(new u(n.path.concat(s+c),e[s+c],a[c])):g.push(new p(n.path.concat(s+c),a[c]));for(;c<d;c++)g.push(new l(n.path.concat(s+c),e[s+c]));return r.notify(g),a}:Reflect.get(e,t)}function o(e,t,r){var o,a=e.hasOwnProperty(t),i=e[t],c=v.get(e),s=g.get(c.root);if((o=r&&"object"==typeof r&&!n(r)?Reflect.set(e,t,new f(r,t,c).proxy):Reflect.set(e,t,r))&&(y.has(i)&&(v.get(y.get(i)).revoke(),y.delete(i)),s.hasListeners)){var p=c.path.concat(t),h=[];h.push(a?new u(p,r,i):new l(p,r)),c.preventCallbacks||s.notify(h)}return o}function a(e,t){var n,r=e[t],o=v.get(e),a=g.get(o.root);if((n=Reflect.deleteProperty(e,t))&&(y.has(r)&&(v.get(y.get(r)).revoke(),y.delete(r)),a.hasListeners)){var i=o.path.concat(t),c=[];c.push(new p(i,r)),o.preventCallbacks||a.notify(c)}return n}function i(e,t){e.forEach(function(r,o){r&&"object"==typeof r&&!n(r)&&(e[o]=new f(r,o,t).proxy)})}function c(e,t){Reflect.ownKeys(e).forEach(function(r){e[r]&&"object"==typeof e[r]&&!n(e[r])&&(e[r]=new f(e[r],r,t).proxy)})}function f(e,n,s){var l,u;if(!e||"object"!=typeof e)throw new Error("Observed MUST be created from a non null object origin");if(s&&(void 0===n||null===n))throw new Error("any non-root (parent-less) Observed MUST have an own path; now parent is "+s+"; key is "+n);if(s&&!(s instanceof f))throw new Error("parent, when supplied, MUST be an instance of Observed");l=t(e),Array.isArray(l)?(i(l,this),u=Proxy.revocable(l,{set:o,get:r,deleteProperty:a})):(c(l,this),u=Proxy.revocable(l,{set:o,deleteProperty:a})),v.set(l,this),y.set(u.proxy,l),Reflect.defineProperty(this,"revokable",{value:u}),Reflect.defineProperty(this,"proxy",{value:u.proxy}),Reflect.defineProperty(this,"parent",{value:s}),Reflect.defineProperty(this,"ownKey",{value:n,writable:!0})}function s(e){function t(e){if(a)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof e)throw new Error("observer (callback) parameter MUST be a function");i.indexOf(e)<0?i.push(e):console.info("observer (callback) may be bound to an observable only once")}function n(){if(a)throw new TypeError("revoked Observable MAY NOT be unobserved amymore");arguments.length?Array.from(arguments).forEach(function(e){var t=i.indexOf(e);t>=0&&i.splice(t,1)}):i.splice(0,i.length)}function r(){a?console.log("revokation of Observable have an effect only once"):(a=!0,e.revoke())}function o(e){i.forEach(function(t){try{t(e)}catch(e){console.error(e)}})}var a=!1,i=[];Reflect.defineProperty(e.proxy,"observe",{value:t}),Reflect.defineProperty(e.proxy,"unobserve",{value:n}),Reflect.defineProperty(e.proxy,"revoke",{value:r}),Reflect.defineProperty(this,"hasListeners",{get:function(){return i.length>0}}),Reflect.defineProperty(this,"notify",{value:o})}function l(e,t){Reflect.defineProperty(this,"type",{value:"insert"}),Reflect.defineProperty(this,"path",{value:e}),Reflect.defineProperty(this,"value",{value:t})}function u(e,t,n){Reflect.defineProperty(this,"type",{value:"update"}),Reflect.defineProperty(this,"path",{value:e}),Reflect.defineProperty(this,"value",{value:t}),Reflect.defineProperty(this,"oldValue",{value:n})}function p(e,t){Reflect.defineProperty(this,"type",{value:"delete"}),Reflect.defineProperty(this,"path",{value:e}),Reflect.defineProperty(this,"oldValue",{value:t})}function h(){Reflect.defineProperty(this,"type",{value:"reverse"})}function d(){Reflect.defineProperty(this,"type",{value:"shuffle"})}var y=new Map,v=new Map,g=new Map,m=["Date","Blob","Number","String","Boolean","Error","SyntaxError","TypeError","URIError","Function","Promise","RegExp"];Reflect.defineProperty(f.prototype,"root",{get:function(){for(var e=this;e.parent;)e=e.parent;return e}}),Reflect.defineProperty(f.prototype,"path",{get:function(){for(var e=[],t=this;void 0!==t.ownKey;)e.push(t.ownKey),t=t.parent;return e.reverse()}}),Reflect.defineProperty(f.prototype,"revoke",{value:function(){var e=this.proxy;Reflect.ownKeys(e).forEach(function(t){var n=e[t];y.has(n)&&(v.get(y.get(n)).revoke(),y.get(e)[t]=y.get(n))}),this.revokable.revoke()}}),Reflect.defineProperty(s,"from",{value:function(e){if(!e||"object"!=typeof e)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in e||"unobserve"in e||"revoke"in e)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(n(e))throw new Error(e+" found to be one of non-observable object types: "+m);var t=new f(e),r=new s(t);return g.set(t,r),t.proxy}}),Reflect.defineProperty(e,"Observable",{value:s})}(this),function(e){"use strict";function t(t,n,r){function o(n){e.DataTier.views.processChanges(t,n)}let i;Reflect.defineProperty(this,"name",{value:t}),Reflect.defineProperty(this,"data",{get:function(){return i},set:function(n){n&&(a(n),i&&i.revoke());let r=i;(i=n)&&i.observe(o),e.DataTier.views.processChanges(t,[{type:"update",value:i,oldValue:r,path:[]}])}}),c[t]=this,this.data=n}function n(e,n,r){if(o(e),n&&a(n),c[e])throw new Error("existing tie ("+e+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new t(e,n,r)}function r(e){e&&c[e]&&(c[e].observable.revoke(),delete c[e])}function o(e){if(!e||"string"!=typeof e)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(e))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}function a(e){if(!e||"object"!=typeof e||"function"!=typeof e.observe||"function"!=typeof e.unobserve||"function"!=typeof e.revoke)throw new Error(e+" is not a valid Observable")}function i(e,t,n){let r;if(e){for(r=0;r<t.length-1;r++)e=e[t[r]]||{};e[t[r]]=n}}const c={};t.prototype.viewToDataProcessor=function(e){i(e.data,e.path,e.view.value)},Reflect.defineProperty(e,"DataTier",{value:{}}),Reflect.defineProperty(e.DataTier,"ties",{value:{}}),Reflect.defineProperty(e.DataTier.ties,"get",{value:function(e){return c[e]}}),Reflect.defineProperty(e.DataTier.ties,"create",{value:n}),Reflect.defineProperty(e.DataTier.ties,"remove",{value:r})}(this),function(e){"use strict";function t(e,t){Reflect.defineProperty(this,"name",{value:e}),Reflect.defineProperty(this,"dataToView",{value:t.dataToView}),"function"==typeof t.inputToData&&Reflect.defineProperty(this,"inputToData",{value:t.inputToData}),"function"==typeof t.parseParam&&Reflect.defineProperty(this,"parseParam",{value:t.parseParam}),"function"==typeof t.isChangedPathRelevant&&Reflect.defineProperty(this,"isChangedPathRelevant",{value:t.isChangedPathRelevant})}function n(n,r){if("string"!=typeof n||!n)throw new Error("name MUST be a non-empty string");if(i[n])throw new Error('rule "'+n+'" already exists; you may want to reconfigure the existing rule');if("object"!=typeof r||!r)throw new Error("configuration MUST be a non-null object");if("function"!=typeof r.dataToView)throw new Error('configuration MUST have a "dataToView" function defined');i[n]=new t(n,r),e.DataTier.views.applyRule(i[n])}function r(e){return i[e]}function o(e){if("string"!=typeof e||!e)throw new Error("rule name MUST be a non-empty string");return delete i[e]}function a(e){let t=[];return e&&e.nodeType===Node.ELEMENT_NODE&&e.dataset&&Object.keys(e.dataset).forEach(function(e){i[e]&&t.push(i[e])}),t}const i={};t.prototype.parseParam=function(e){let t="",n=[];return e&&(t=(n=e.trim().split(".")).shift()),{tieName:t,dataPath:n}},t.prototype.isChangedPathRelevant=function(e,t){return 0===t.indexOf(e)},Reflect.defineProperty(e.DataTier,"rules",{value:{}}),Reflect.defineProperty(e.DataTier.rules,"get",{value:r}),Reflect.defineProperty(e.DataTier.rules,"add",{value:n}),Reflect.defineProperty(e.DataTier.rules,"remove",{value:o}),Reflect.defineProperty(e.DataTier.rules,"getApplicable",{value:a})}(this),function(e){"use strict";function t(e,t){let n;if(e){for(n=0;n<t.length;n++)if(!(e=e[t[n]]))return;return e}}function n(t){e.DataTier.rules.getApplicable(t.target).forEach(function(n){if("tieValue"===n.name){let r=n.parseParam(t.target.dataset[n.name]),o=e.DataTier.ties.get(r.tieName);if(!r.dataPath)return void console.error("path to data not available");if(!o)return void console.error('tie "'+r.tieName+'" not found');o.viewToDataProcessor({data:o.data,path:r.dataPath,view:t.target})}})}function r(e){"INPUT"!==e.nodeName&&"SELECT"!==e.nodeName||e.addEventListener("change",n)}function o(e){e.removeEventListener("change",n)}function a(t){"IFRAME"===t.nodeName?(h(t.contentDocument),t.addEventListener("load",function(){h(this.contentDocument),c(this.contentDocument)}),c(t.contentDocument)):(e.DataTier.rules.getApplicable(t).forEach(function(e){let n,o,a,c=e.parseParam(t.dataset[e.name]),f=c.dataPath.join(".");d[c.tieName]||(d[c.tieName]={}),(n=d[c.tieName])[e.name]||(n[e.name]={}),(o=n[e.name])[f]||(o[f]=[]),(a=o[f]).indexOf(t)<0&&(a.push(t),i(t,e.name),r(t))}),t.dataset&&Object.keys(t.dataset).forEach(function(n){0!==n.indexOf("tie")||e.DataTier.rules.get(n)||(y[n]||(y[n]=[]),y[n].push(t))}))}function i(n,r){let o,a,i,c;a=(o=e.DataTier.rules.get(r)).parseParam(n.dataset[r]),(i=e.DataTier.ties.get(a.tieName))&&(c=t(i.data,a.dataPath),o.dataToView(c,n))}function c(e){let t;e&&e.nodeType&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.ELEMENT_NODE)&&((t=t="IFRAME"===e.nodeName?Array.from(e.contentDocument.getElementsByTagName("*")):Array.from(e.getElementsByTagName("*"))).push(e),t.forEach(a))}function f(t){let n,r,a,i;t&&t.getElementsByTagName&&((n=Array.from(t.getElementsByTagName("*"))).push(t),n.forEach(function(t){e.DataTier.rules.getApplicable(t).forEach(function(e){r=e.parseParam(t.dataset[e.name]),a=d[r.tieName][e.name][r.dataPath.join(".")],(i=a.indexOf(t))>=0&&(a.splice(i,1),o(t))})}))}function s(t,n,r,o){let a,c,f=-1;a=e.DataTier.rules.get(n).parseParam(r),d[a.tieName]&&d[a.tieName][n]&&((c=d[a.tieName][n][a.dataPath])&&(f=c.indexOf(t)),f>=0&&c.splice(f,1)),a=e.DataTier.rules.get(n).parseParam(o),d[a.tieName]||(d[a.tieName]={}),d[a.tieName][n]||(d[a.tieName][n]={}),d[a.tieName][n][a.dataPath]||(d[a.tieName][n][a.dataPath]=[]),d[a.tieName][n][a.dataPath].push(t),i(t,n)}function l(t,n){let r,o,a,c=d[t];c&&n.forEach(function(t){a=t.path.join("."),Object.keys(c).forEach(function(t){(o=c[t])&&(r=e.DataTier.rules.get(t),Object.keys(o).forEach(function(e){r.isChangedPathRelevant(a,e)&&o[e].forEach(function(e){i(e,t)})}))})})}function u(e){y[e.name]&&(y[e.name].forEach(function(e){a(e)}),delete y[e.name])}function p(e){let t,n=2,r=e.split("-");for(t=r[1];n<r.length;)t+=r[n][0].toUpperCase()+r[n++].substr(1);return t}function h(e){function t(e){e.forEach(function(e){let t=e.target,n=e.attributeName;"attributes"===e.type&&0===n.indexOf("data-tie")?s(t,p(n),e.oldValue,t.getAttribute(n)):"attributes"===e.type&&"src"===n&&"IFRAME"===t.nodeName?f(t.contentDocument):"childList"===e.type&&(Array.from(e.addedNodes).forEach(function(e){"IFRAME"===e.nodeName?(e.contentDocument&&(h(e.contentDocument),c(e.contentDocument)),e.addEventListener("load",function(){h(this.contentDocument),c(this.contentDocument)})):c(e)}),Array.from(e.removedNodes).forEach(function(e){f("IFRAME"===e.nodeName?e.contentDocument:e)}))})}new MutationObserver(t).observe(e,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!1,characterDataOldValue:!1})}const d={},y={};Reflect.defineProperty(e.DataTier,"views",{value:{}}),Reflect.defineProperty(e.DataTier.views,"processChanges",{value:l}),Reflect.defineProperty(e.DataTier.views,"applyRule",{value:u}),h(document),c(document)}(this),function(e){"use strict";const t=e.DataTier.rules.add;t("tieValue",{dataToView:function(e,t){"checkbox"===t.type?t.checked=e:t.value=e||""}}),t("tieText",{dataToView:function(e,t){t.textContent=e?e.toString():""}}),t("tiePlaceholder",{dataToView:function(e,t){t.placeholder=e||""}}),t("tieTooltip",{dataToView:function(e,t){t.title=e||""}}),t("tieSrc",{dataToView:function(e,t){t.src=e||""}}),t("tieHRef",{dataToView:function(e,t){t.href=e||""}}),t("tieDateValue",{dataToView:function(e,t){t.value=e?e.toLocaleString():""}}),t("tieDateText",{dataToView:function(e,t){t.textContent=e?e.toLocaleString():""}}),t("tieClasses",{isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},dataToView:function(e,t){e&&"object"==typeof e&&Object.keys(e).forEach(function(n){e[n]?t.classList.add(n):t.classList.remove(n)})}}),t("tieList",{parseParam:function(e){return this.constructor.prototype.parseParam(e.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(e,t){let n=e.replace(t,"").split(".");return this.constructor.prototype.isChangedPathRelevant(e,t)||1===n.length||2===n.length&&""===n[0]},dataToView:function(e,t){let n,r,o,a,i,c,f,s,l=t.parentNode;if("TEMPLATE"!==t.nodeName)throw new Error("tieList may be defined on template elements only");if(t.dataset.listSourceAid||(t.dataset.listSourceAid=(new Date).getTime()),n=function(e,t){let n=Array.from(l.querySelectorAll('[data-list-item-aid="'+t+'"]'));for(;n.length>e;)l.removeChild(n.pop());return n.length}(e?e.length:0,t.dataset.listSourceAid),e&&n<e.length)if((o=t.dataset.tieList.trim().split(/\s+/))&&3===o.length&&"=>"===o[1]){for(a=o[2],f=(c=t.ownerDocument).createDocumentFragment();n<e.length;n++){for(r=c.importNode(t.content,!0),(i=Array.prototype.slice.call(r.querySelectorAll("*"),0)).forEach(function(e){Object.keys(e.dataset).forEach(function(t){0===e.dataset[t].indexOf(a)&&(e.dataset[t]=e.dataset[t].replace(a,o[0]+"."+n))})}),f.appendChild(r),s=f.lastChild;s.nodeType!==Node.ELEMENT_NODE&&null!==s.previousSibling;)s=s.previousSibling;s.dataset.listItemAid=t.dataset.listSourceAid}l.appendChild(f)}else console.error('invalid parameter for "tieList" rule specified')}})}(this);