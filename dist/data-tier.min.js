!function(a){"use strict";function b(a){var b;return b=Array.isArray(a)?a.slice():Object.assign(new a.constructor,a)}function c(a){return s.indexOf(a.constructor.name)>=0}function d(a,b){var c,d=q.get(a),e=r.get(d.root);return c="pop"===b?function(){var c,f,g;return c=a.length-1,f=Reflect.apply(a[b],a,arguments),f&&"object"==typeof f&&(f=p.get(f),q.get(f).revoke()),g=[new m(d.path.concat(c),f)],e.notify(g),f}:"push"===b?function(){var c,f,g,h=[];return c=Array.from(arguments),g=a.length,c.forEach(function(a,b){a&&"object"==typeof a&&(c[b]=new i(a,g+b,d).proxy),h.push(new k(d.path.concat(g+b),a))}),f=Reflect.apply(a[b],a,c),e.notify(h),f}:"shift"===b?function(){var c,f,g;return c=Reflect.apply(a[b],a,arguments),c&&"object"==typeof c&&(c=p.get(c),q.get(c).revoke()),a.forEach(function(a,b){a&&"object"==typeof a&&(g=q.get(p.get(a)),g?g.ownKey=b:console.error("failed to resolve proxy -> target -> observed"))}),f=[new m(d.path.concat(0),c)],e.notify(f),c}:"unshift"===b?function(){var c,f,g,h=[];c=Array.from(arguments),c.forEach(function(a,b){a&&"object"==typeof a&&(c[b]=new i(a,b,d).proxy)}),f=Reflect.apply(a[b],a,c),a.forEach(function(a,b){a&&"object"==typeof a&&(g=q.get(p.get(a)),g?g.ownKey=b:console.error("failed to resolve proxy -> target -> observed"))});for(var j=0;j<c.length;j++)h.push(new k(d.path.concat(j),a[j]));return e.notify(h),f}:"reverse"===b?function(){var c,d=[];return Reflect.apply(a[b],a,arguments),a.forEach(function(a,b){a&&"object"==typeof a&&(c=q.get(p.get(a)),c?c.ownKey=b:console.error("failed to resolve proxy -> target -> observed"))}),d.push(new n),e.notify(d),this}:"sort"===b?function(){var c,d=[];return Reflect.apply(a[b],a,arguments),a.forEach(function(a,b){a&&"object"==typeof a&&(c=q.get(p.get(a)),c?c.ownKey=b:console.error("failed to resolve proxy -> target -> observed"))}),d.push(new o),e.notify(d),this}:"fill"===b?function(){var c,f,g,h=[];c=arguments.length<2?0:arguments[1]<0?a.length+arguments[1]:arguments[1],f=arguments.length<3?a.length:arguments[2]<0?a.length+arguments[2]:arguments[2],g=a.slice(),Reflect.apply(a[b],a,arguments);for(var j=c;j<f;j++)a[j]&&"object"==typeof a[j]&&(a[j]=new i(a[j],j,d).proxy),g.hasOwnProperty(j)?(h.push(new l(d.path.concat(j),a[j],g[j]&&"object"==typeof g[j]?p.get(g[j]):g[j])),g[j]&&"object"==typeof g[j]&&q.get(p.get(g[j])).revoke()):h.push(new k(d.path.concat(j),a[j]));return e.notify(h),this}:"splice"===b?function(){var c,f,g,h,j,n,o,r=[];for(c=Array.from(arguments),c.forEach(function(a,b){b>1&&a&&"object"==typeof a&&(c[b]=new i(a,b,d).proxy)}),j=0===c.length?0:c[0]<0?a.length+c[0]:c[0],n=c.length<2?a.length-j:c[1],o=Math.max(c.length-2,0),f=Reflect.apply(a[b],a,c),a.forEach(function(a,b){a&&"object"==typeof a&&(g=q.get(p.get(a)),g?g.ownKey=b:console.error("failed to resolve proxy -> target -> observed"))}),f.forEach(function(a,b){a&&"object"==typeof a&&(f[b]=p.get(a),q.get(f[b]).revoke())}),h=0;h<n;h++)h<o?r.push(new l(d.path.concat(j+h),a[j+h],f[h])):r.push(new m(d.path.concat(j+h),f[h]));for(;h<o;h++)r.push(new k(d.path.concat(j+h),a[j+h]));return e.notify(r),f}:Reflect.get(a,b)}function e(a,b,d){var e,f=a.hasOwnProperty(b),g=a[b],h=q.get(a),j=r.get(h.root);if(e=d&&"object"==typeof d&&!c(d)?Reflect.set(a,b,new i(d,b,h).proxy):Reflect.set(a,b,d),e&&(p.has(g)&&(q.get(p.get(g)).revoke(),p.delete(g)),j.hasListeners)){var m=h.path.concat(b),n=[];n.push(f?new l(m,d,g):new k(m,d)),h.preventCallbacks||j.notify(n)}return e}function f(a,b){var c,d=a[b],e=q.get(a),f=r.get(e.root);if(c=Reflect.deleteProperty(a,b),c&&(p.has(d)&&(q.get(p.get(d)).revoke(),p.delete(d)),f.hasListeners)){var g=e.path.concat(b),h=[];h.push(new m(g,d)),e.preventCallbacks||f.notify(h)}return c}function g(a,b){a.forEach(function(d,e){d&&"object"==typeof d&&!c(d)&&(a[e]=new i(d,e,b).proxy)})}function h(a,b){Reflect.ownKeys(a).forEach(function(d){a[d]&&"object"==typeof a[d]&&!c(a[d])&&(a[d]=new i(a[d],d,b).proxy)})}function i(a,c,j){var k,l;if(!a||"object"!=typeof a)throw new Error("Observed MUST be created from a non null object origin");if(j&&("undefined"==typeof c||null===c))throw new Error("any non-root (parent-less) Observed MUST have an own path; now parent is "+j+"; key is "+c);if(j&&!(j instanceof i))throw new Error("parent, when supplied, MUST be an instance of Observed");k=b(a),Array.isArray(k)?(g(k,this),l=Proxy.revocable(k,{set:e,get:d,deleteProperty:f})):(h(k,this),l=Proxy.revocable(k,{set:e,deleteProperty:f})),q.set(k,this),p.set(l.proxy,k),Reflect.defineProperty(this,"revokable",{value:l}),Reflect.defineProperty(this,"proxy",{value:l.proxy}),Reflect.defineProperty(this,"parent",{value:j}),Reflect.defineProperty(this,"ownKey",{value:c,writable:!0})}function j(a){function b(a){if(f)throw new TypeError("revoked Observable MAY NOT be observed anymore");if("function"!=typeof a)throw new Error("observer (callback) parameter MUST be a function");g.indexOf(a)<0?g.push(a):console.info("observer (callback) may be bound to an observable only once")}function c(){if(f)throw new TypeError("revoked Observable MAY NOT be unobserved amymore");arguments.length?Array.from(arguments).forEach(function(a){var b=g.indexOf(a);b>=0&&g.splice(b,1)}):g.splice(0,g.length)}function d(){f?console.log("revokation of Observable have an effect only once"):(f=!0,a.revoke())}function e(a){g.forEach(function(b){try{b(a)}catch(a){console.error(a)}})}var f=!1,g=[];Reflect.defineProperty(a.proxy,"observe",{value:b}),Reflect.defineProperty(a.proxy,"unobserve",{value:c}),Reflect.defineProperty(a.proxy,"revoke",{value:d}),Reflect.defineProperty(this,"hasListeners",{get:function(){return g.length>0}}),Reflect.defineProperty(this,"notify",{value:e})}function k(a,b){Reflect.defineProperty(this,"type",{value:"insert"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"value",{value:b})}function l(a,b,c){Reflect.defineProperty(this,"type",{value:"update"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"value",{value:b}),Reflect.defineProperty(this,"oldValue",{value:c})}function m(a,b){Reflect.defineProperty(this,"type",{value:"delete"}),Reflect.defineProperty(this,"path",{value:a}),Reflect.defineProperty(this,"oldValue",{value:b})}function n(){Reflect.defineProperty(this,"type",{value:"reverse"})}function o(){Reflect.defineProperty(this,"type",{value:"shuffle"})}var p=new Map,q=new Map,r=new Map,s=["Date","Blob","Number","String","Boolean","Error","SyntaxError","TypeError","URIError","Function","Promise","RegExp"];Reflect.defineProperty(i.prototype,"root",{get:function(){for(var a=this;a.parent;)a=a.parent;return a}}),Reflect.defineProperty(i.prototype,"path",{get:function(){for(var a=[],b=this;"undefined"!=typeof b.ownKey;)a.push(b.ownKey),b=b.parent;return a.reverse()}}),Reflect.defineProperty(i.prototype,"revoke",{value:function(){var a=this.proxy;Reflect.ownKeys(a).forEach(function(b){var c=a[b];p.has(c)&&(q.get(p.get(c)).revoke(),p.get(a)[b]=p.get(c))}),this.revokable.revoke()}}),Reflect.defineProperty(j,"from",{value:function(a){if(!a||"object"!=typeof a)throw new Error("observable MAY ONLY be created from non-null object only");if("observe"in a||"unobserve"in a||"revoke"in a)throw new Error('target object MUST NOT have nor own neither inherited properties from the following list: "observe", "unobserve", "revoke"');if(c(a))throw new Error(a+" found to be one of non-observable object types: "+s);var b=new i(a),d=new j(b);return r.set(b,d),b.proxy}}),Reflect.defineProperty(a,"Observable",{value:j})}(this),function(a){"use strict";function b(b,c,d){function e(c){a.DataTier.views.processChanges(b,c)}var g;Reflect.defineProperty(this,"name",{value:b}),Reflect.defineProperty(this,"data",{get:function(){return g},set:function(c){c&&(f(c),g&&g.revoke());var d=g;g=c,g&&g.observe(e),a.DataTier.views.processChanges(b,[{type:"update",value:g,oldValue:d,path:[]}])}}),h[b]=this,this.data=c}function c(a,c,d){if(e(a),c&&f(c),h[a])throw new Error("existing tie ("+a+") MAY NOT be re-created, use the tie's own APIs to reconfigure it");return new b(a,c,d)}function d(a){a&&h[a]&&(h[a].observable.revoke(),delete h[a])}function e(a){if(!a||"string"!=typeof a)throw new Error("tie name MUST be a non-empty string");if(/\W/.test(a))throw new Error("tie name MUST consist of alphanumerics or underlines ([a-zA-Z0-9_]) ONLY")}function f(a){if(!a||"object"!=typeof a||"function"!=typeof a.observe||"function"!=typeof a.unobserve||"function"!=typeof a.revoke)throw new Error(a+" is not a valid Observable")}function g(a,b,c){var d;if(a){for(d=0;d<b.length-1;d++)a=a[b[d]]||{};a[b[d]]=c}}var h={};b.prototype.viewToDataProcessor=function(a){g(a.data,a.path,a.view.value)},Reflect.defineProperty(a,"DataTier",{value:{}}),Reflect.defineProperty(a.DataTier,"ties",{value:{}}),Reflect.defineProperty(a.DataTier.ties,"get",{value:function(a){return h[a]}}),Reflect.defineProperty(a.DataTier.ties,"create",{value:c}),Reflect.defineProperty(a.DataTier.ties,"remove",{value:d})}(this),function(a){"use strict";function b(a,b){Reflect.defineProperty(this,"name",{value:a}),Reflect.defineProperty(this,"dataToView",{value:b.dataToView}),"function"==typeof b.inputToData&&Reflect.defineProperty(this,"inputToData",{value:b.inputToData}),"function"==typeof b.parseParam&&Reflect.defineProperty(this,"parseParam",{value:b.parseParam}),"function"==typeof b.isChangedPathRelevant&&Reflect.defineProperty(this,"isChangedPathRelevant",{value:b.isChangedPathRelevant})}function c(c,d){if("string"!=typeof c||!c)throw new Error("name MUST be a non-empty string");if(g[c])throw new Error('rule "'+c+'" already exists; you may want to reconfigure the existing rule');if("object"!=typeof d||!d)throw new Error("configuration MUST be a non-null object");if("function"!=typeof d.dataToView)throw new Error('configuration MUST have a "dataToView" function defined');g[c]=new b(c,d),a.DataTier.views.applyRule(g[c])}function d(a){return g[a]}function e(a){if("string"!=typeof a||!a)throw new Error("rule name MUST be a non-empty string");return delete g[a]}function f(a){var b=[];return a&&a.nodeType===Node.ELEMENT_NODE&&a.dataset&&Object.keys(a.dataset).forEach(function(a){g[a]&&b.push(g[a])}),b}const g={};b.prototype.parseParam=function(a){var b,c;return a?(b=a.trim().split("."),c=b.shift(),{tieName:c,dataPath:b}):void console.error("valid rule value MUST be a non-empty string, found: "+a)},b.prototype.isChangedPathRelevant=function(a,b){return 0===b.indexOf(a)},Reflect.defineProperty(a.DataTier,"rules",{value:{}}),Reflect.defineProperty(a.DataTier.rules,"get",{value:d}),Reflect.defineProperty(a.DataTier.rules,"add",{value:c}),Reflect.defineProperty(a.DataTier.rules,"remove",{value:e}),Reflect.defineProperty(a.DataTier.rules,"getApplicable",{value:f})}(this),function(a){"use strict";function b(a,b){var c;if(a){for(c=0;c<b.length;c++)if(a=a[b[c]],!a)return;return a}}function c(b){a.DataTier.rules.getApplicable(b.target).forEach(function(c){if("tieValue"===c.name){var d=c.parseParam(b.target.dataset[c.name]),e=a.DataTier.ties.get(d.tieName);if(!d.dataPath)return void console.error("path to data not available");if(!e)return void console.error('tie "'+d.tieName+'" not found');e.viewToDataProcessor({data:e.data,path:d.dataPath,view:b.target})}})}function d(a){"INPUT"!==a.nodeName&&"SELECT"!==a.nodeName||a.addEventListener("change",c)}function e(a){a.removeEventListener("change",c)}function f(b){"IFRAME"===b.nodeName?(n(b.contentDocument),b.addEventListener("load",function(){n(this.contentDocument),h(this.contentDocument)}),h(b.contentDocument)):(a.DataTier.rules.getApplicable(b).forEach(function(a){var c,e,f,h=a.parseParam(b.dataset[a.name]),i=h.dataPath.join(".");o[h.tieName]||(o[h.tieName]={}),c=o[h.tieName],c[a.name]||(c[a.name]={}),e=c[a.name],e[i]||(e[i]=[]),f=e[i],f.indexOf(b)<0&&(f.push(b),g(b,a.name),d(b))}),b.dataset&&Object.keys(b.dataset).forEach(function(c){0!==c.indexOf("tie")||a.DataTier.rules.get(c)||(console.warn('non-registerd rule "'+c+'" used, it may still be defined later in code and post-tied'),p[c]||(p[c]=[]),p[c].push(b))}))}function g(c,d){var e,f,g,h;e=a.DataTier.rules.get(d),f=e.parseParam(c.dataset[d]),g=a.DataTier.ties.get(f.tieName),g&&(h=b(g.data,f.dataPath),e.dataToView(h,c))}function h(a){var b;a&&a.nodeType&&(a.nodeType===Node.DOCUMENT_NODE||a.nodeType===Node.ELEMENT_NODE)&&(b=b="IFRAME"===a.nodeName?Array.from(a.contentDocument.getElementsByTagName("*")):Array.from(a.getElementsByTagName("*")),b.push(a),b.forEach(f))}function i(b){var c,d,f,g;b&&b.getElementsByTagName&&(c=Array.from(b.getElementsByTagName("*")),c.push(b),c.forEach(function(b){a.DataTier.rules.getApplicable(b).forEach(function(a){d=a.parseParam(b.dataset[a.name]),f=o[d.tieName][a.name][d.dataPath.join(".")],g=f.indexOf(b),g>=0&&(f.splice(g,1),e(b))})}))}function j(b,c,d,e){var f,h,i=-1;f=a.DataTier.rules.get(c).parseParam(d),o[f.tieName]&&o[f.tieName][c]&&(h=o[f.tieName][c][f.dataPath],h&&(i=h.indexOf(b)),i>=0&&h.splice(i,1)),f=a.DataTier.rules.get(c).parseParam(e),o[f.tieName]||(o[f.tieName]={}),o[f.tieName][c]||(o[f.tieName][c]={}),o[f.tieName][c][f.dataPath]||(o[f.tieName][c][f.dataPath]=[]),o[f.tieName][c][f.dataPath].push(b),g(b,c)}function k(b,c){var d,e,f,h=o[b];h&&c.forEach(function(b){f=b.path.join("."),Object.keys(h).forEach(function(b){e=h[b],e&&(d=a.DataTier.rules.get(b),Object.keys(e).forEach(function(a){d.isChangedPathRelevant(f,a)&&e[a].forEach(function(a){g(a,b)})}))})})}function l(a){p[a.name]&&(p[a.name].forEach(function(a){f(a)}),delete p[a.name])}function m(a){var b,c=2,d=a.split("-");for(b=d[1];c<d.length;)b+=d[c][0].toUpperCase()+d[c++].substr(1);return b}function n(a){function b(a){a.forEach(function(a){var b=a.target,c=a.attributeName;"attributes"===a.type&&0===c.indexOf("data-tie")?j(b,m(c),a.oldValue,b.getAttribute(c)):"attributes"===a.type&&"src"===c&&"IFRAME"===b.nodeName?i(b.contentDocument):"childList"===a.type&&(Array.from(a.addedNodes).forEach(function(a){"IFRAME"===a.nodeName?(a.contentDocument&&(n(a.contentDocument),h(a.contentDocument)),a.addEventListener("load",function(){n(this.contentDocument),h(this.contentDocument)})):h(a)}),Array.from(a.removedNodes).forEach(function(a){i("IFRAME"===a.nodeName?a.contentDocument:a)}))})}var c=new MutationObserver(b);c.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!1,characterDataOldValue:!1})}const o={},p={};Reflect.defineProperty(a.DataTier,"views",{value:{}}),Reflect.defineProperty(a.DataTier.views,"processChanges",{value:k}),Reflect.defineProperty(a.DataTier.views,"applyRule",{value:l}),n(document),h(document)}(this),function(a){"use strict";var b=a.DataTier.rules.add;b("tieValue",{dataToView:function(a,b){b.value=a?a:""}}),b("tieText",{dataToView:function(a,b){b.textContent=a?a.toString():""}}),b("tiePlaceholder",{dataToView:function(a,b){b.placeholder=a?a:""}}),b("tieTooltip",{dataToView:function(a,b){b.title=a?a:""}}),b("tieSrc",{dataToView:function(a,b){b.src=a?a:""}}),b("tieHRef",{dataToView:function(a,b){b.href=a?a:""}}),b("tieDateValue",{dataToView:function(a,b){b.value=a?a.toLocaleString():""}}),b("tieDateText",{dataToView:function(a,b){b.textContent=a?a.toLocaleString():""}}),b("tieClasses",{isChangedPathRelevant:function(a,b){var c=a.replace(b,"").split(".");return this.constructor.prototype.isChangedPathRelevant(a,b)||1===c.length||2===c.length&&""===c[0]},dataToView:function(a,b){var c=a&&Array.isArray(a)?a:[];Array.from(b.classList).forEach(function(a){b.classList.remove(a)}),c.length&&b.classList.add.apply(b.classList,c)}}),b("tieList",{parseParam:function(a){return this.constructor.prototype.parseParam(a.split(/\s*=>\s*/)[0])},isChangedPathRelevant:function(a,b){var c=a.replace(b,"").split(".");return this.constructor.prototype.isChangedPathRelevant(a,b)||1===c.length||2===c.length&&""===c[0]},dataToView:function(a,b){function c(a,b){for(var c=Array.from(l.querySelectorAll('[data-list-item-aid="'+b+'"]'));c.length>a;)l.removeChild(c.pop());return c.length}var d,e,f,g,h,i,j,k,l=b.parentNode;if("TEMPLATE"!==b.nodeName)throw new Error("tieList may be defined on template elements only");if(b.dataset.listSourceAid||(b.dataset.listSourceAid=(new Date).getTime()),d=c(a?a.length:0,b.dataset.listSourceAid),a&&d<a.length)if(f=b.dataset.tieList.trim().split(/\s+/),f&&3===f.length&&"=>"===f[1]){for(g=f[2],i=b.ownerDocument,j=i.createDocumentFragment();d<a.length;d++){for(e=i.importNode(b.content,!0),h=Array.prototype.slice.call(e.querySelectorAll("*"),0),h.forEach(function(a){Object.keys(a.dataset).forEach(function(b){0===a.dataset[b].indexOf(g)&&(a.dataset[b]=a.dataset[b].replace(g,f[0]+"."+d))})}),j.appendChild(e),k=j.lastChild;k.nodeType!==Node.ELEMENT_NODE&&null!==k.previousSibling;)k=k.previousSibling;k.dataset.listItemAid=b.dataset.listSourceAid}l.appendChild(j)}else console.error('invalid parameter for "tieList" rule specified')}})}(this);