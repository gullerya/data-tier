import{Observable}from"./object-observer.min.js";const DEFAULT_TIE_TARGET_PROVIDER="defaultTieTarget",CHANGE_EVENT_NAME_PROVIDER="changeEventName",PARAM_SPLITTER=/\s*=>\s*/,MULTI_PARAMS_SPLITTER=/\s*[,;]\s*/,DEFAULT_VALUE_ELEMENTS={INPUT:1,SELECT:1,TEXTAREA:1},DEFAULT_SRC_ELEMENTS={IMG:1,IFRAME:1,SOURCE:1},DEFAULT_CHANGE_ELEMENTS={INPUT:1,SELECT:1,TEXTAREA:1};export{ensureObservable,DEFAULT_TIE_TARGET_PROVIDER,getTargetProperty,extractViewParams,CHANGE_EVENT_NAME_PROVIDER,addChangeListener,delChangeListener,getPath,setPath};function ensureObservable(e){return e?Observable.isObservable(e)?e:Observable.from(e):Observable.from({})}function getTargetProperty(e){let t=e[DEFAULT_TIE_TARGET_PROVIDER];if(!t){const r=e.nodeName;t="INPUT"===r&&"checkbox"===e.type?"checked":r in DEFAULT_VALUE_ELEMENTS?"value":r in DEFAULT_SRC_ELEMENTS?"src":"textContent"}return t}function extractViewParams(e){let t,r=[];return e&&e.dataset&&(t=e.dataset.tie)&&(r=parseViewParams(t,e)),r}function parseViewParams(e,t){const r=[],n={},a=e.split(MULTI_PARAMS_SPLITTER),E=a.length;let o,s,i=0;for(;i<E;i++)if(o=a[i])try{(s=parseTieParam(o,t)).targetProperty in n?console.error("elements's property \""+s.targetProperty+'" tied more than once; all but first dismissed'):(r.push(s),n[s.targetProperty]=!0)}catch(e){console.error("failed to parse one of a multi param parts ("+o+"), skipping it",e)}return r}function parseTieParam(e,t){const r=e.split(PARAM_SPLITTER);1===r.length&&r.push(getTargetProperty(t));const n=r[0].split(":");if(!n.length||n.length>2||!n[0])throw new Error('invalid tie value; found: "'+e+'"; expected (example of multi param, one with default target): "orders:0.address.street, orders:0.address.apt => title"');const a=n.length>1?n[1]:"";return{tieKey:n[0],rawPath:a,path:a.split(".").filter(e=>e),targetProperty:r[1]}}function addChangeListener(e,t){const r=obtainChangeEventName(e);r&&e.addEventListener(r,t)}function delChangeListener(e,t){const r=obtainChangeEventName(e);r&&e.removeEventListener(r,t)}function obtainChangeEventName(e){let t=e[CHANGE_EVENT_NAME_PROVIDER];return t||e.nodeName in DEFAULT_CHANGE_ELEMENTS&&(t="change"),t}function getPath(e,t){if(!e)return null;const r=t.length;if(!r)return e;let n,a=0;for(;a<r-1;a++)if(null===(e=e[n=t[a]])||void 0===e)return null;return e[t[a]]}function setPath(e,t,r){if(!e)return;const n=t.length;let a,E,o=0;for(;o<n-1;o++)if((E=e[a=t[o]])&&"object"==typeof E)e=E;else if(void 0===E||null===E)e[a]={},e=e[a];else if("object"!=typeof E)throw new Error("setting deep path MAY NOT override primitives along the way");e[t[o]]=r}